/*!
 * @license
 * TradingView Lightweight Charts v3.8.0-dev+202211241619
 * Copyright (c) 2020 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
import{bindToDevicePixelRatio as t}from"fancy-canvas/coordinate-space";var i,n;function s(t,i){var n,s=((n={})[0]=[],n[1]=[t.lineWidth,t.lineWidth],n[2]=[2*t.lineWidth,2*t.lineWidth],n[3]=[6*t.lineWidth,6*t.lineWidth],n[4]=[t.lineWidth,4*t.lineWidth],n)[i];t.setLineDash(s)}function h(t,i,n,s){t.beginPath();var h=t.lineWidth%2?.5:0;t.moveTo(n,i+h),t.lineTo(s,i+h),t.stroke()}function r(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function e(t){if(void 0===t)throw new Error("Value is undefined");return t}function u(t){if(null===t)throw new Error("Value is null");return t}function o(t){return u(e(t))}!function(t){t[t.Simple=0]="Simple",t[t.WithSteps=1]="WithSteps"}(i||(i={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(n||(n={}));var a={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function l(t){return t<0?0:t>255?255:Math.round(t)||0}function f(t){return t<=0||t>0?t<0?0:t>1?1:Math.round(1e4*t)/1e4:0}var c=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,v=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,d=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,_=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function w(t){var i;if((t=t.toLowerCase())in a&&(t=a[t]),i=_.exec(t)||d.exec(t))return[l(parseInt(i[1],10)),l(parseInt(i[2],10)),l(parseInt(i[3],10)),f(i.length<5?1:parseFloat(i[4]))];if(i=v.exec(t))return[l(parseInt(i[1],16)),l(parseInt(i[2],16)),l(parseInt(i[3],16)),1];if(i=c.exec(t))return[l(17*parseInt(i[1],16)),l(17*parseInt(i[2],16)),l(17*parseInt(i[3],16)),1];throw new Error("Cannot parse color: ".concat(t))}function M(t){var i,n=w(t);return{t:"rgb(".concat(n[0],", ").concat(n[1],", ").concat(n[2],")"),i:(i=n,.199*i[0]+.687*i[1]+.114*i[2]>160?"black":"white")}}var b=function(t,i){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},b(t,i)};function m(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}b(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var p=function(){return p=Object.assign||function(t){for(var i,n=1,s=arguments.length;n<s;n++)for(var h in i=arguments[n])Object.prototype.hasOwnProperty.call(i,h)&&(t[h]=i[h]);return t},p.apply(this,arguments)};function g(t,i,n){if(n||2===arguments.length)for(var s,h=0,r=i.length;h<r;h++)!s&&h in i||(s||(s=Array.prototype.slice.call(i,0,h)),s[h]=i[h]);return t.concat(s||Array.prototype.slice.call(i))}var y=function(){function t(){this.h=[]}return t.prototype.subscribe=function(t,i,n){var s={u:t,o:i,l:!0===n};this.h.push(s)},t.prototype.unsubscribe=function(t){var i=this.h.findIndex((function(i){return t===i.u}));i>-1&&this.h.splice(i,1)},t.prototype.unsubscribeAll=function(t){this.h=this.h.filter((function(i){return i.o!==t}))},t.prototype.v=function(t,i){var n=g([],this.h,!0);this.h=this.h.filter((function(t){return!t.l})),n.forEach((function(n){return n.u(t,i)}))},t.prototype._=function(){return this.h.length>0},t.prototype.M=function(){this.h=[]},t}();function k(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];for(var s=0,h=i;s<h.length;s++){var r=h[s];for(var e in r)void 0!==r[e]&&("object"!=typeof r[e]||void 0===t[e]?t[e]=r[e]:k(t[e],r[e]))}return t}function x(t){return"number"==typeof t&&isFinite(t)}function N(t){return"number"==typeof t&&t%1==0}function C(t){return"string"==typeof t}function S(t){return"boolean"==typeof t}function T(t){var i,n,s,h=t;if(!h||"object"!=typeof h)return h;for(n in i=Array.isArray(h)?[]:{},h)h.hasOwnProperty(n)&&(s=h[n],i[n]=s&&"object"==typeof s?T(s):s);return i}function D(t){return null!==t}function A(t){return null===t?void 0:t}var B="'Trebuchet MS', Roboto, Ubuntu, sans-serif";function L(t,i,n){return n=void 0!==n?"".concat(n," "):"",void 0===i&&(i=B),"".concat(n).concat(t,"px ").concat(i)}var E=function(){function t(t){this.m={borderSize:1,tickLength:4,fontSize:NaN,font:"",fontFamily:"",color:"",paddingBottom:0,paddingInner:0,paddingOuter:0,paddingTop:0,baselineOffset:0},this.p=t}return t.prototype.options=function(){var t=this.m,i=this.g(),n=this.k();return t.fontSize===i&&t.fontFamily===n||(t.fontSize=i,t.fontFamily=n,t.font=L(i,n),t.paddingTop=Math.floor(i/3.5),t.paddingBottom=t.paddingTop,t.paddingInner=Math.max(Math.ceil(i/2-t.tickLength/2),0),t.paddingOuter=Math.ceil(i/2+t.tickLength/2),t.baselineOffset=Math.round(i/10)),t.color=this.N(),this.m},t.prototype.N=function(){return this.p.options().layout.textColor},t.prototype.g=function(){return this.p.options().layout.fontSize},t.prototype.k=function(){return this.p.options().layout.fontFamily},t}(),F=function(){function t(){this.C=[]}return t.prototype.S=function(t){this.C=t},t.prototype.draw=function(t,i,n,s){this.C.forEach((function(h){t.save(),h.draw(t,i,n,s),t.restore()}))},t}(),O=function(){function t(){}return t.prototype.draw=function(t,i,n,s){t.save(),t.scale(i,i),this.T(t,n,s),t.restore()},t.prototype.drawBackground=function(t,i,n,s){t.save(),t.scale(i,i),this.D(t,n,s),t.restore()},t.prototype.D=function(t,i,n){},t}(),V=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.A=null,i}return m(i,t),i.prototype.B=function(t){this.A=t},i.prototype.T=function(t){if(null!==this.A&&null!==this.A.L){var i=this.A.L,n=this.A,s=function(s){t.beginPath();for(var h=i.to-1;h>=i.from;--h){var r=n.F[h];t.moveTo(r.x,r.y),t.arc(r.x,r.y,s,0,2*Math.PI)}t.fill()};t.fillStyle=n.O,s(n.V+2),t.fillStyle=n.P,s(n.V)}},i}(O);function P(){return{F:[{x:0,y:0,time:0,price:0}],P:"",O:"",V:0,L:null}}var W={from:0,to:1},z=function(){function t(t,i){this.W=new F,this.R=[],this.I=[],this.j=!0,this.p=t,this.q=i,this.W.S(this.R)}return t.prototype.update=function(t){var i=this.p.serieses();i.length!==this.R.length&&(this.I=i.map(P),this.R=this.I.map((function(t){var i=new V;return i.B(t),i})),this.W.S(this.R)),this.j=!0},t.prototype.renderer=function(t,i,n){return this.j&&(this.U(t),this.j=!1),this.W},t.prototype.U=function(t){var i=this,n=this.p.serieses(),s=this.q.appliedIndex(),h=this.p.timeScale();n.forEach((function(n,r){var e,o=i.I[r],a=n.markerDataAtIndex(s);if(null!==a&&n.visible()){var l=u(n.firstValue());o.P=a.backgroundColor,o.V=a.radius,o.F[0].price=a.price,o.F[0].y=n.priceScale().priceToCoordinate(a.price,l.value),o.O=null!==(e=a.borderColor)&&void 0!==e?e:i.p.backgroundColorAtYPercentFromTop(o.F[0].y/t),o.F[0].time=s,o.F[0].x=h.indexToCoordinate(s),o.L=W}else o.L=null}))},t}(),R=function(){function t(t){this.H=t}return t.prototype.draw=function(t,i,n,r){if(null!==this.H){var e=this.H.$.Y,u=this.H.K.Y;if(e||u){t.save();var o=Math.round(this.H.X*i),a=Math.round(this.H.Z*i),l=Math.ceil(this.H.J*i),f=Math.ceil(this.H.G*i);t.lineCap="butt",e&&o>=0&&(t.lineWidth=Math.floor(this.H.$.tt*i),t.strokeStyle=this.H.$.it,t.fillStyle=this.H.$.it,s(t,this.H.$.nt),function(t,i,n,s){t.beginPath();var h=t.lineWidth%2?.5:0;t.moveTo(i+h,n),t.lineTo(i+h,s),t.stroke()}(t,o,0,f)),u&&a>=0&&(t.lineWidth=Math.floor(this.H.K.tt*i),t.strokeStyle=this.H.K.it,t.fillStyle=this.H.K.it,s(t,this.H.K.nt),h(t,a,0,l)),t.restore()}}},t}(),I=function(){function t(t){this.j=!0,this.st={$:{tt:1,nt:0,it:"",Y:!1},K:{tt:1,nt:0,it:"",Y:!1},J:0,G:0,X:0,Z:0},this.ht=new R(this.st),this.rt=t}return t.prototype.et=function(){this.j=!0},t.prototype.renderer=function(t,i){return this.j&&(this.U(),this.j=!1),this.ht},t.prototype.U=function(){var t=this.rt.visible(),i=u(this.rt.pane()),n=i.model().options().crosshair,s=this.st;s.K.Y=t&&this.rt.horzLineVisible(i),s.$.Y=t&&this.rt.vertLineVisible(),s.K.tt=n.horzLine.width,s.K.nt=n.horzLine.style,s.K.it=n.horzLine.color,s.$.tt=n.vertLine.width,s.$.nt=n.vertLine.style,s.$.it=n.vertLine.color,s.J=i.width(),s.G=i.height(),s.X=this.rt.appliedX(),s.Z=this.rt.appliedY()},t}();function j(t,i,n,s,h,r){t.fillRect(i+r,n,s-2*r,r),t.fillRect(i+r,n+h-r,s-2*r,r),t.fillRect(i,n,r,h),t.fillRect(i+s-r,n,r,h)}function q(t,i,n){t.save(),t.scale(i,i),n(),t.restore()}function U(t,i,n,s,h,r){t.save(),t.globalCompositeOperation="copy",t.fillStyle=r,t.fillRect(i,n,s,h),t.restore()}function H(t,i,n,s,h,r,e){t.save(),t.globalCompositeOperation="copy";var u=t.createLinearGradient(0,0,0,h);u.addColorStop(0,r),u.addColorStop(1,e),t.fillStyle=u,t.fillRect(i,n,s,h),t.restore()}var Y,$=function(){function t(t,i){this.setData(t,i)}return t.prototype.setData=function(t,i){this.H=t,this.ut=i},t.prototype.draw=function(t,i,n,s,h,r){if(this.H.visible){t.font=i.font;var e=this.H.tickVisible||!this.H.moveTextToInvisibleTick?i.tickLength:0,u=i.borderSize,o=i.paddingTop,a=i.paddingBottom,l=i.paddingInner,f=i.paddingOuter,c=this.H.text,v=Math.ceil(n.measureText(t,c)),d=i.baselineOffset,_=i.fontSize+o+a,w=Math.ceil(.5*_),M=u+v+l+f+e,b=this.ut.coordinate;this.ut.fixedCoordinate&&(b=this.ut.fixedCoordinate);var m,p,g=(b=Math.round(b))-w,y=g+_,k="right"===h,x=k?s:0,N=Math.ceil(s*r),C=x;if(t.fillStyle=this.ut.background,t.lineWidth=1,t.lineCap="butt",c){k?(m=x-e,p=(C=x-M)+f):(C=x+M,m=x+e,p=x+u+e+l);var S=Math.max(1,Math.floor(r)),T=Math.max(1,Math.floor(u*r)),D=k?N:0,A=Math.round(g*r),B=Math.round(C*r),L=Math.round(b*r)-Math.floor(.5*r),E=L+S+(L-A),F=Math.round(m*r);t.save(),t.beginPath(),t.moveTo(D,A),t.lineTo(B,A),t.lineTo(B,E),t.lineTo(D,E),t.fill(),t.fillStyle=this.H.borderColor,t.fillRect(k?N-T:0,A,T,E-A),this.H.tickVisible&&(t.fillStyle=this.ut.color,t.fillRect(D,L,F-D,S)),t.textAlign="left",t.fillStyle=this.ut.color,q(t,r,(function(){t.fillText(c,p,y-a-d)})),t.restore()}}},t.prototype.height=function(t,i){return this.H.visible?t.fontSize+t.paddingTop+t.paddingBottom:0},t}(),K=function(){function t(t){this.ot={coordinate:0,color:"#FFF",background:"#000"},this.lt={text:"",visible:!1,tickVisible:!0,moveTextToInvisibleTick:!1,borderColor:""},this.ft={text:"",visible:!1,tickVisible:!1,moveTextToInvisibleTick:!0,borderColor:""},this.j=!0,this.ct=new(t||$)(this.lt,this.ot),this.vt=new(t||$)(this.ft,this.ot)}return t.prototype.text=function(){return this.dt(),this.lt.text},t.prototype.coordinate=function(){return this.dt(),this.ot.coordinate},t.prototype.update=function(){this.j=!0},t.prototype.height=function(t,i){return void 0===i&&(i=!1),Math.max(this.ct.height(t,i),this.vt.height(t,i))},t.prototype.getFixedCoordinate=function(){return this.ot.fixedCoordinate||0},t.prototype.setFixedCoordinate=function(t){this.ot.fixedCoordinate=t},t.prototype.isVisible=function(){return this.dt(),this.lt.visible||this.ft.visible},t.prototype.isAxisLabelVisible=function(){return this.dt(),this.lt.visible},t.prototype.renderer=function(t){return this.dt(),this.lt.tickVisible=this.lt.tickVisible&&t.options().drawTicks,this.ft.tickVisible=this.ft.tickVisible&&t.options().drawTicks,this.ct.setData(this.lt,this.ot),this.vt.setData(this.ft,this.ot),this.ct},t.prototype.paneRenderer=function(){return this.dt(),this.ct.setData(this.lt,this.ot),this.vt.setData(this.ft,this.ot),this.vt},t.prototype.dt=function(){this.j&&(this.lt.tickVisible=!0,this.ft.tickVisible=!1,this._t(this.lt,this.ft,this.ot))},t}(),X=function(t){function i(i,n,s){var h=t.call(this)||this;return h.rt=i,h.wt=n,h.Mt=s,h}return m(i,t),i.prototype._t=function(t,i,n){t.visible=!1;var s=this.rt.options().horzLine;if(s.labelVisible){var h=this.wt.firstValue();if(this.rt.visible()&&!this.wt.isEmpty()&&null!==h){var r=M(s.labelBackgroundColor);n.background=r.t,n.color=r.i;var e=this.Mt(this.wt);n.coordinate=e.bt,t.text=this.wt.formatPrice(e.gt,h),t.visible=!0}}},i}(K),Z=/[1-9]/g,J=function(){function t(){this.H=null}return t.prototype.setData=function(t){this.H=t},t.prototype.draw=function(t,i,n){var s=this;if(null!==this.H&&!1!==this.H.visible&&0!==this.H.text.length){t.font=i.font;var h=Math.round(i.widthCache.measureText(t,this.H.text,Z));if(!(h<=0)){t.save();var r=i.paddingHorizontal,e=h+2*r,o=e/2,a=this.H.width,l=this.H.coordinate,f=Math.floor(l-o)+.5;f<0?(l+=Math.abs(0-f),f=Math.floor(l-o)+.5):f+e>a&&(l-=Math.abs(a-(f+e)),f=Math.floor(l-o)+.5);var c=f+e,v=0+i.borderSize+i.paddingTop+i.fontSize+i.paddingBottom;t.fillStyle=this.H.background;var d=Math.round(f*n),_=Math.round(0*n),w=Math.round(c*n),M=Math.round(v*n);t.fillRect(d,_,w-d,M-_);var b=Math.round(this.H.coordinate*n),m=_,p=Math.round((m+i.borderSize+i.tickLength)*n);t.fillStyle=this.H.color;var g=Math.max(1,Math.floor(n)),y=Math.floor(.5*n);t.fillRect(b-y,m,g,p-m);var k=v-i.baselineOffset-i.paddingBottom;t.textAlign="left",t.fillStyle=this.H.color,q(t,n,(function(){t.fillText(u(s.H).text,f+r,k)})),t.restore()}}},t}(),G=function(){function t(t,i,n){this.j=!0,this.ht=new J,this.st={visible:!1,background:"#4c525e",color:"white",text:"",width:0,coordinate:NaN},this.q=t,this.yt=i,this.Mt=n}return t.prototype.et=function(){this.j=!0},t.prototype.renderer=function(){return this.j&&(this.U(),this.j=!1),this.ht.setData(this.st),this.ht},t.prototype.U=function(){var t=this.st;t.visible=!1;var i=this.q.options().vertLine;if(i.labelVisible){var n=this.yt.timeScale();if(!n.isEmpty()){var s=n.indexToTime(this.q.appliedIndex());t.width=n.width();var h=this.Mt();if(h.kt){t.coordinate=h.bt,t.text=n.formatDateTime(u(s)),t.visible=!0;var r=M(i.labelBackgroundColor);t.background=r.t,t.color=r.i}}}},t}(),Q=function(){function t(){this._priceScale=null,this.xt=0}return t.prototype.zorder=function(){return this.xt},t.prototype.setZorder=function(t){this.xt=t},t.prototype.priceScale=function(){return this._priceScale},t.prototype.setPriceScale=function(t){this._priceScale=t},t.prototype.timeAxisViews=function(){return[]},t.prototype.visible=function(){return!0},t}();!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(Y||(Y={}));var tt=function(t){function i(i,n){var s=t.call(this)||this;s.Nt=null,s.Ct=NaN,s.St=0,s.Tt=!0,s.Dt=new Map,s.At=!1,s.Bt=NaN,s.Lt=NaN,s.Et=NaN,s.Ft=NaN,s.yt=i,s.Ot=n,s.Vt=new z(i,s);var h,r;s.Pt=(h=function(){return s.Ct},r=function(){return s.Lt},function(t){var i=r(),n=h();if(t===u(s.Nt).defaultPriceScale())return{gt:n,bt:i};var e=u(t.firstValue());return{gt:t.coordinateToPrice(i,e),bt:i}});var e=function(t,i){return function(){return{kt:s.yt.timeScale().indexToTime(t()),bt:i()}}}((function(){return s.St}),(function(){return s.appliedX()}));return s.Wt=new G(s,i,e),s.zt=new I(s),s}return m(i,t),i.prototype.options=function(){return this.Ot},i.prototype.saveOriginCoord=function(t,i){this.Et=t,this.Ft=i},i.prototype.clearOriginCoord=function(){this.Et=NaN,this.Ft=NaN},i.prototype.originCoordX=function(){return this.Et},i.prototype.originCoordY=function(){return this.Ft},i.prototype.setPosition=function(t,i,n){this.At||(this.At=!0),this.Tt=!0,this.Rt(t,i,n)},i.prototype.appliedIndex=function(){return this.St},i.prototype.appliedX=function(){return this.Bt},i.prototype.appliedY=function(){return this.Lt},i.prototype.visible=function(){return this.Tt},i.prototype.clearPosition=function(){this.Tt=!1,this.It(),this.Ct=NaN,this.Bt=NaN,this.Lt=NaN,this.Nt=null,this.clearOriginCoord()},i.prototype.paneViews=function(t){return null!==this.Nt?[this.zt,this.Vt]:[]},i.prototype.horzLineVisible=function(t){return t===this.Nt&&this.Ot.horzLine.visible},i.prototype.vertLineVisible=function(){return this.Ot.vertLine.visible},i.prototype.priceAxisViews=function(t,i){this.Tt&&this.Nt===t||this.Dt.clear();var n=[];return this.Nt===t&&n.push(this.jt(this.Dt,i,this.Pt)),n},i.prototype.timeAxisViews=function(){return this.Tt?[this.Wt]:[]},i.prototype.pane=function(){return this.Nt},i.prototype.updateAllViews=function(){this.zt.et(),this.Dt.forEach((function(t){return t.update()})),this.Wt.et(),this.Vt.update()},i.prototype.qt=function(t){return t&&!t.defaultPriceScale().isEmpty()?t.defaultPriceScale():null},i.prototype.Rt=function(t,i,n){this.Ut(t,i,n)&&this.updateAllViews()},i.prototype.Ut=function(t,i,n){var s=this.Bt,h=this.Lt,r=this.Ct,e=this.St,u=this.Nt,o=this.qt(n);this.St=t,this.Bt=isNaN(t)?NaN:this.yt.timeScale().indexToCoordinate(t),this.Nt=n;var a=null!==o?o.firstValue():null;return null!==o&&null!==a?(this.Ct=i,this.Lt=o.priceToCoordinate(i,a)):(this.Ct=NaN,this.Lt=NaN),s!==this.Bt||h!==this.Lt||e!==this.St||r!==this.Ct||u!==this.Nt},i.prototype.It=function(){var t=this.yt.serieses().map((function(t){return t.bars().lastIndex()})).filter(D),i=0===t.length?null:Math.max.apply(Math,t);this.St=null!==i?i:NaN},i.prototype.jt=function(t,i,n){var s=t.get(i);return void 0===s&&(s=new X(this,i,n),t.set(i,s)),s},i}(Q);function it(t){return"left"===t||"right"===t}var nt=function(){function t(t){this.Ht=new Map,this.Yt=[],this.$t=t}return t.prototype.invalidatePane=function(t,i){var n=function(t,i){return void 0===t?i:{level:Math.max(t.level,i.level),autoScale:t.autoScale||i.autoScale}}(this.Ht.get(t),i);this.Ht.set(t,n)},t.prototype.fullInvalidation=function(){return this.$t},t.prototype.invalidateForPane=function(t){var i=this.Ht.get(t);return void 0===i?{level:this.$t}:{level:Math.max(this.$t,i.level),autoScale:i.autoScale}},t.prototype.setFitContent=function(){this.Yt=[{type:0}]},t.prototype.applyRange=function(t){this.Yt=[{type:1,value:t}]},t.prototype.resetTimeScale=function(){this.Yt=[{type:4}]},t.prototype.setBarSpacing=function(t){this.Yt.push({type:2,value:t})},t.prototype.setRightOffset=function(t){this.Yt.push({type:3,value:t})},t.prototype.timeScaleInvalidations=function(){return this.Yt},t.prototype.merge=function(t){for(var i=this,n=0,s=t.Yt;n<s.length;n++){var h=s[n];this.Kt(h)}this.$t=Math.max(this.$t,t.$t),t.Ht.forEach((function(t,n){i.invalidatePane(n,t)}))},t.prototype.Kt=function(t){switch(t.type){case 0:this.setFitContent();break;case 1:this.applyRange(t.value);break;case 2:this.setBarSpacing(t.value);break;case 3:this.setRightOffset(t.value);break;case 4:this.resetTimeScale()}},t}(),st=".";function ht(t,i){if(!x(t))return"n/a";if(!N(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");if(0===i)return t.toString();return("0000000000000000"+t.toString()).slice(-i)}var rt=function(){function t(t,i){if(i||(i=1),x(t)&&N(t)||(t=100),t<0)throw new TypeError("invalid base");this.wt=t,this.Xt=i,this.Zt()}return t.prototype.format=function(t){var i=t<0?"âˆ’":"";return t=Math.abs(t),i+this.Jt(t)},t.prototype.Zt=function(){if(this.Gt=0,this.wt>0&&this.Xt>0)for(var t=this.wt;t>1;)t/=10,this.Gt++},t.prototype.Jt=function(t){var i=this.wt/this.Xt,n=Math.floor(t),s="",h=void 0!==this.Gt?this.Gt:NaN;if(i>1){var r=+(Math.round(t*i)-n*i).toFixed(this.Gt);r>=i&&(r-=i,n+=1),s=st+ht(+r.toFixed(this.Gt)*this.Xt,h)}else n=Math.round(n*i)/i,h>0&&(s=st+ht(0,h));return n.toFixed(0)+s},t}(),et=function(t){function i(i){return void 0===i&&(i=100),t.call(this,i)||this}return m(i,t),i.prototype.format=function(i){return"".concat(t.prototype.format.call(this,i),"%")},i}(rt),ut=function(){function t(t){this.Qt=t}return t.prototype.format=function(t){var i="";return t<0&&(i="-",t=-t),t<995?i+this.ti(t):t<999995?i+this.ti(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this.ti(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this.ti(t/1e9)+"B")},t.prototype.ti=function(t){var i=Math.pow(10,this.Qt);return((t=Math.round(t*i)/i)>=1e-15&&t<1?t.toFixed(this.Qt).replace(/\.?0+$/,""):String(t)).replace(/(\.[1-9]*)0+$/,(function(t,i){return i}))},t}();function ot(t,i,n,s){if(0!==i.length){var h=i[s.from].X,r=i[s.from].Z;t.moveTo(h,r);for(var e=s.from+1;e<s.to;++e){var u=i[e];if(1===n){var o=i[e-1].Z,a=u.X;t.lineTo(a,o)}t.lineTo(u.X,u.Z)}}}var at=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.A=null,i}return m(i,t),i.prototype.B=function(t){this.A=t},i.prototype.T=function(t){if(null!==this.A&&0!==this.A.F.length&&null!==this.A.L){if(t.lineCap="butt",t.lineJoin="round",t.lineWidth=this.A.tt,s(t,this.A.nt),t.lineWidth=1,t.beginPath(),1===this.A.F.length){var i=this.A.F[0],n=this.A.ii/2;t.moveTo(i.x-n,this.A.ni),t.lineTo(i.x-n,i.y),t.lineTo(i.x+n,i.y),t.lineTo(i.x+n,this.A.ni)}else t.moveTo(this.A.F[this.A.L.from].x,this.A.ni),t.lineTo(this.A.F[this.A.L.from].x,this.A.F[this.A.L.from].y),ot(t,this.A.F,this.A.si,this.A.L),this.A.L.to>this.A.L.from&&(t.lineTo(this.A.F[this.A.L.to-1].x,this.A.ni),t.lineTo(this.A.F[this.A.L.from].x,this.A.ni));t.closePath(),t.fillStyle=this.hi(t),t.fill()}},i}(O),lt=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return m(i,t),i.prototype.hi=function(t){var i=this.A,n=t.createLinearGradient(0,0,0,i.ri);return n.addColorStop(0,i.ei),n.addColorStop(1,i.ui),n},i}(at),ft=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.A=null,i}return m(i,t),i.prototype.B=function(t){this.A=t},i.prototype.T=function(t){if(null!==this.A&&0!==this.A.F.length&&null!==this.A.L)if(t.lineCap="butt",t.lineWidth=this.A.tt,s(t,this.A.nt),t.strokeStyle=this.oi(t),t.lineJoin="round",1===this.A.F.length){t.beginPath();var i=this.A.F[0];t.moveTo(i.x-this.A.ii/2,i.y),t.lineTo(i.x+this.A.ii/2,i.y),void 0!==i.it&&(t.strokeStyle=i.it),t.stroke()}else this.ai(t,this.A)},i.prototype.ai=function(t,i){t.beginPath(),ot(t,i.F,i.si,i.L),t.stroke()},i}(O),ct=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return m(i,t),i.prototype.ai=function(t,i){var n,s,h=i.F,r=i.L,e=i.si,u=i.P;if(0!==h.length&&null!==r){t.beginPath();var o=h[r.from];t.moveTo(o.x,o.y);var a=null!==(n=o.it)&&void 0!==n?n:u;t.strokeStyle=a;for(var l=function(i){t.stroke(),t.beginPath(),t.strokeStyle=i,a=i},f=r.from+1;f<r.to;++f){var c=h[f],v=h[f-1],d=null!==(s=c.it)&&void 0!==s?s:u;1===e&&(t.lineTo(c.x,v.y),d!==a&&(l(d),t.moveTo(c.x,v.y))),t.lineTo(c.x,c.y),1!==e&&d!==a&&(l(d),t.moveTo(c.x,c.y))}t.stroke()}},i.prototype.oi=function(){return this.A.P},i}(ft);function vt(t,i,n,s,h){void 0===s&&(s=0),void 0===h&&(h=t.length);for(var r=h-s;0<r;){var e=r>>1,u=s+e;n(t[u],i)?(s=u+1,r-=e+1):r=e}return s}function dt(t,i,n,s,h){void 0===s&&(s=0),void 0===h&&(h=t.length);for(var r=h-s;0<r;){var e=r>>1,u=s+e;n(i,t[u])?r=e:(s=u+1,r-=e+1)}return s}function _t(t,i){return t.time<i}function wt(t,i){return t<i.time}function Mt(t,i,n){var s=i.left(),h=i.right(),r=vt(t,s,_t),e=dt(t,h,wt);if(!n)return{from:r,to:e};var u=r,o=e;return r>0&&r<t.length&&t[r].time>=s&&(u=r-1),e>0&&e<t.length&&t[e-1].time<=h&&(o=e+1),{from:u,to:o}}var bt=function(){function t(t,i,n){this.li=!0,this.fi=!0,this.ci=!0,this.vi=[],this.di=null,this._i=t,this.wi=i,this.Mi=n}return t.prototype.update=function(t){this.li=!0,"data"===t&&(this.fi=!0),"options"===t&&(this.ci=!0)},t.prototype.bi=function(){this.fi&&(this.mi(),this.fi=!1),this.li&&(this.pi(),this.li=!1),this.ci&&(this.gi(),this.ci=!1)},t.prototype.yi=function(){this.di=null},t.prototype.pi=function(){var t=this._i.priceScale(),i=this.wi.timeScale();if(this.yi(),!i.isEmpty()&&!t.isEmpty()){var n=i.visibleStrictRange();if(null!==n&&0!==this._i.bars().size()){var s=this._i.firstValue();null!==s&&(this.di=Mt(this.vi,n,this.Mi),this.ki(t,i,s.value))}}},t}(),mt=function(t){function i(i,n){return t.call(this,i,n,!0)||this}return m(i,t),i.prototype.ki=function(t,i,n){i.indexesToCoordinates(this.vi,A(this.di)),t.pointsArrayToCoordinates(this.vi,n,A(this.di))},i.prototype.xi=function(t,i){return{time:t,price:i,x:NaN,y:NaN}},i.prototype.gi=function(){},i.prototype.mi=function(){var t=this,i=this._i.barColorer();this.vi=this._i.bars().rows().map((function(n){var s=n.value[3];return t.Ni(n.index,s,i)}))},i}(bt),pt=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.ht=new F,s.Ci=new lt,s.Si=new ct,s.ht.S([s.Ci,s.Si]),s}return m(i,t),i.prototype.renderer=function(t,i){if(!this._i.visible())return null;var n=this._i.options();return this.bi(),this.Ci.B({si:n.lineType,F:this.vi,nt:n.lineStyle,tt:n.lineWidth,ei:n.topColor,ui:n.bottomColor,ni:t,ri:t,L:this.di,ii:this.wi.timeScale().barSpacing()}),this.Si.B({si:n.lineType,F:this.vi,P:n.lineColor,nt:n.lineStyle,tt:n.lineWidth,L:this.di,ii:this.wi.timeScale().barSpacing()}),this.ht},i.prototype.Ni=function(t,i){return this.xi(t,i)},i}(mt);var gt=function(){function t(){this.H=null,this.Ti=0,this.Di=0}return t.prototype.B=function(t){this.H=t},t.prototype.draw=function(t,i,n,s){if(null!==this.H&&0!==this.H.Ai.length&&null!==this.H.L){if(this.Ti=this.Bi(i),this.Ti>=2)Math.max(1,Math.floor(i))%2!=this.Ti%2&&this.Ti--;this.Di=this.H.Li?Math.min(this.Ti,Math.floor(i)):this.Ti;for(var h=null,r=this.Di<=this.Ti&&this.H.Ei>=Math.floor(1.5*i),e=this.H.L.from;e<this.H.L.to;++e){var u=this.H.Ai[e];h!==u.it&&(t.fillStyle=u.it,h=u.it);var o=Math.floor(.5*this.Di),a=Math.round(u.x*i),l=a-o,f=this.Di,c=l+f-1,v=Math.min(u.highY,u.lowY),d=Math.max(u.highY,u.lowY),_=Math.round(v*i)-o,w=Math.round(d*i)+o,M=Math.max(w-_,this.Di);t.fillRect(l,_,f,M);var b=Math.ceil(1.5*this.Ti);if(r){if(this.H.Fi){var m=a-b,p=Math.max(_,Math.round(u.openY*i)-o),g=p+f-1;g>_+M-1&&(p=(g=_+M-1)-f+1),t.fillRect(m,p,l-m,g-p+1)}var y=a+b,k=Math.max(_,Math.round(u.closeY*i)-o),x=k+f-1;x>_+M-1&&(k=(x=_+M-1)-f+1),t.fillRect(c+1,k,y-c,x-k+1)}}}},t.prototype.Bi=function(t){var i=Math.floor(t);return Math.max(i,Math.floor(function(t,i){return Math.floor(.3*t*i)}(u(this.H).Ei,t)))},t}(),yt=function(t){function i(i,n){return t.call(this,i,n,!1)||this}return m(i,t),i.prototype.ki=function(t,i,n){i.indexesToCoordinates(this.vi,A(this.di)),t.barPricesToCoordinates(this.vi,n,A(this.di))},i.prototype.Oi=function(t,i,n){return{time:t,open:i.value[0],high:i.value[1],low:i.value[2],close:i.value[3],x:NaN,openY:NaN,highY:NaN,lowY:NaN,closeY:NaN}},i.prototype.mi=function(){var t=this,i=this._i.barColorer();this.vi=this._i.bars().rows().map((function(n){return t.Ni(n.index,n,i)}))},i}(bt),kt=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.ht=new gt,i}return m(i,t),i.prototype.renderer=function(t,i){if(!this._i.visible())return null;var n=this._i.options();this.bi();var s={Ai:this.vi,Ei:this.wi.timeScale().barSpacing(),Fi:n.openVisible,Li:n.thinBars,L:this.di};return this.ht.B(s),this.ht},i.prototype.gi=function(){var t=this;this.vi.forEach((function(i){i.it=t._i.barColorer().barStyle(i.time).barColor}))},i.prototype.Ni=function(t,i,n){return p(p({},this.Oi(t,i,n)),{it:n.barStyle(t).barColor})},i}(yt);function xt(t,i,n){return Math.min(Math.max(t,i),n)}function Nt(t,i,n){return i-t<=n}function Ct(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function St(t){var i=Math.ceil(t);return i%2!=0?i-1:i}function Tt(t){var i=Math.ceil(t);return i%2==0?i-1:i}var Dt=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return m(i,t),i.prototype.hi=function(t){var i=this.A,n=t.createLinearGradient(0,0,0,i.ri),s=xt(i.ni/i.ri,0,1);return n.addColorStop(0,i.Vi),n.addColorStop(s,i.Pi),n.addColorStop(s,i.Wi),n.addColorStop(1,i.zi),n},i}(at),At=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return m(i,t),i.prototype.oi=function(t){var i=this.A,n=t.createLinearGradient(0,0,0,i.ri),s=xt(i.ni/i.ri,0,1);return n.addColorStop(0,i.ei),n.addColorStop(s,i.ei),n.addColorStop(s,i.ui),n.addColorStop(1,i.ui),n},i}(ft),Bt=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.Ri=new Dt,s.Ii=new At,s.W=new F,s.W.S([s.Ri,s.Ii]),s}return m(i,t),i.prototype.renderer=function(t,i){if(!this._i.visible())return null;var n=this._i.firstValue();if(null===n)return null;var s=this._i.options();this.bi();var h=this._i.priceScale().priceToCoordinate(s.baseValue.price,n.value),r=this.wi.timeScale().barSpacing();return this.Ri.B({F:this.vi,Vi:s.topFillColor1,Pi:s.topFillColor2,Wi:s.bottomFillColor1,zi:s.bottomFillColor2,tt:s.lineWidth,nt:s.lineStyle,si:0,ni:h,ri:t,L:this.di,ii:r}),this.Ii.B({F:this.vi,ei:s.topLineColor,ui:s.bottomLineColor,tt:s.lineWidth,nt:s.lineStyle,si:0,ni:h,ri:t,L:this.di,ii:r}),this.W},i.prototype.Ni=function(t,i){return this.xi(t,i)},i}(mt),Lt=function(){function t(){this.H=null,this.Ti=0}return t.prototype.B=function(t){this.H=t},t.prototype.draw=function(t,i,n,s){if(null!==this.H&&0!==this.H.Ai.length&&null!==this.H.L){if(this.Ti=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);var n=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),s=Math.floor(t*n*i),h=Math.floor(t*i),r=Math.min(s,h);return Math.max(Math.floor(i),r)}(this.H.Ei,i),this.Ti>=2)Math.floor(i)%2!=this.Ti%2&&this.Ti--;var h=this.H.Ai;this.H.ji&&this.qi(t,h,this.H.L,i),this.H.Ui&&this.Hi(t,h,this.H.L,this.H.Ei,i);var r=this.Yi(i);(!this.H.Ui||this.Ti>2*r)&&this.$i(t,h,this.H.L,i)}},t.prototype.qi=function(t,i,n,s){if(null!==this.H){var h="",r=Math.min(Math.floor(s),Math.floor(this.H.Ei*s));r=Math.max(Math.floor(s),Math.min(r,this.Ti));for(var e=Math.floor(.5*r),u=null,o=n.from;o<n.to;o++){var a=i[o];a.Ki!==h&&(t.fillStyle=a.Ki,h=a.Ki);var l=Math.round(Math.min(a.openY,a.closeY)*s),f=Math.round(Math.max(a.openY,a.closeY)*s),c=Math.round(a.highY*s),v=Math.round(a.lowY*s),d=Math.round(s*a.x)-e,_=d+r-1;null!==u&&(d=Math.max(u+1,d),d=Math.min(d,_));var w=_-d+1;t.fillRect(d,c,w,l-c),t.fillRect(d,f+1,w,v-f),u=_}}},t.prototype.Yi=function(t){var i=Math.floor(1*t);this.Ti<=2*i&&(i=Math.floor(.5*(this.Ti-1)));var n=Math.max(Math.floor(t),i);return this.Ti<=2*n?Math.max(Math.floor(t),Math.floor(1*t)):n},t.prototype.Hi=function(t,i,n,s,h){if(null!==this.H)for(var r="",e=this.Yi(h),u=null,o=n.from;o<n.to;o++){var a=i[o];a.Xi!==r&&(t.fillStyle=a.Xi,r=a.Xi);var l=Math.round(a.x*h)-Math.floor(.5*this.Ti),f=l+this.Ti-1,c=Math.round(Math.min(a.openY,a.closeY)*h),v=Math.round(Math.max(a.openY,a.closeY)*h);if(null!==u&&(l=Math.max(u+1,l),l=Math.min(l,f)),this.H.Ei*h>2*e)j(t,l,c,f-l+1,v-c+1,e);else{var d=f-l+1;t.fillRect(l,c,d,v-c+1)}u=f}},t.prototype.$i=function(t,i,n,s){if(null!==this.H)for(var h="",r=this.Yi(s),e=n.from;e<n.to;e++){var u=i[e],o=Math.round(Math.min(u.openY,u.closeY)*s),a=Math.round(Math.max(u.openY,u.closeY)*s),l=Math.round(u.x*s)-Math.floor(.5*this.Ti),f=l+this.Ti-1;if(u.it!==h){var c=u.it;t.fillStyle=c,h=c}this.H.Ui&&(l+=r,o+=r,f-=r,a-=r),o>a||t.fillRect(l,o,f-l+1,a-o+1)}},t}(),Et=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.ht=new Lt,i}return m(i,t),i.prototype.renderer=function(t,i){if(!this._i.visible())return null;var n=this._i.options();this.bi();var s={Ai:this.vi,Ei:this.wi.timeScale().barSpacing(),ji:n.wickVisible,Ui:n.borderVisible,L:this.di};return this.ht.B(s),this.ht},i.prototype.gi=function(){var t=this;this.vi.forEach((function(i){var n=t._i.barColorer().barStyle(i.time);i.it=n.barColor,i.Ki=n.barWickColor,i.Xi=n.barBorderColor}))},i.prototype.Ni=function(t,i,n){var s=n.barStyle(t);return p(p({},this.Oi(t,i,n)),{it:s.barColor,Ki:s.barWickColor,Xi:s.barBorderColor})},i}(yt),Ft=function(){function t(){this.H=null,this.Zi=[]}return t.prototype.B=function(t){this.H=t,this.Zi=[]},t.prototype.draw=function(t,i,n,s){if(null!==this.H&&0!==this.H.F.length&&null!==this.H.L){this.Zi.length||this.Ji(i);for(var h=Math.max(1,Math.floor(i)),r=Math.round(this.H.Gi*i)-Math.floor(h/2),e=r+h,u=this.H.L.from;u<this.H.L.to;u++){var o=this.H.F[u],a=this.Zi[u-this.H.L.from],l=Math.round(o.y*i);t.fillStyle=o.it;var f=void 0,c=void 0;l<=r?(f=l,c=e):(f=r,c=l-Math.floor(h/2)+h),t.fillRect(a.Qi,f,a.tn-a.Qi+1,c-f)}}},t.prototype.Ji=function(t){if(null!==this.H&&0!==this.H.F.length&&null!==this.H.L){var i=Math.ceil(this.H.Ei*t)<=1?0:Math.max(1,Math.floor(t)),n=Math.round(this.H.Ei*t)-i;this.Zi=new Array(this.H.L.to-this.H.L.from);for(var s=this.H.L.from;s<this.H.L.to;s++){var h,r=this.H.F[s],e=Math.round(r.x*t),u=void 0,o=void 0;if(n%2)u=e-(h=(n-1)/2),o=e+h;else u=e-(h=n/2),o=e+h-1;this.Zi[s-this.H.L.from]={Qi:u,tn:o,nn:e,sn:r.x*t,kt:r.time}}for(s=this.H.L.from+1;s<this.H.L.to;s++){var a=this.Zi[s-this.H.L.from],l=this.Zi[s-this.H.L.from-1];a.kt===l.kt+1&&(a.Qi-l.tn!==i+1&&(l.nn>l.sn?l.tn=a.Qi-i-1:a.Qi=l.tn+i+1))}var f=Math.ceil(this.H.Ei*t);for(s=this.H.L.from;s<this.H.L.to;s++){(a=this.Zi[s-this.H.L.from]).tn<a.Qi&&(a.tn=a.Qi);var c=a.tn-a.Qi+1;f=Math.min(c,f)}if(i>0&&f<4)for(s=this.H.L.from;s<this.H.L.to;s++){(c=(a=this.Zi[s-this.H.L.from]).tn-a.Qi+1)>f&&(a.nn>a.sn?a.tn-=1:a.Qi+=1)}}else this.Zi=[]},t}();function Ot(t){return{F:[],Ei:t,Gi:NaN,L:null}}function Vt(t,i,n){return{time:t,price:i,x:NaN,y:NaN,it:n}}var Pt=function(t){function i(i,n){var s=t.call(this,i,n,!1)||this;return s.W=new F,s.hn=Ot(0),s.ht=new Ft,s}return m(i,t),i.prototype.renderer=function(t,i){return this._i.visible()?(this.bi(),this.W):null},i.prototype.mi=function(){var t=this.wi.timeScale().barSpacing();this.hn=Ot(t);for(var i=0,n=0,s=this._i.options().color,h=0,r=this._i.bars().rows();h<r.length;h++){var e=r[h],u=e.value[3],o=void 0!==e.color?e.color:s,a=Vt(e.index,u,o);++i<this.hn.F.length?this.hn.F[i]=a:this.hn.F.push(a),this.vi[n++]={time:e.index,x:0}}this.ht.B(this.hn),this.W.S([this.ht])},i.prototype.gi=function(){},i.prototype.yi=function(){t.prototype.yi.call(this),this.hn.L=null},i.prototype.ki=function(t,i,n){if(null!==this.di){var s=i.barSpacing(),h=u(i.visibleStrictRange()),r=t.priceToCoordinate(this._i.options().base,n);i.indexesToCoordinates(this.hn.F),t.pointsArrayToCoordinates(this.hn.F,n),this.hn.Gi=r,this.hn.L=Mt(this.hn.F,h,!1),this.hn.Ei=s,this.ht.B(this.hn)}},i}(bt),Wt=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.Si=new ct,s}return m(i,t),i.prototype.renderer=function(t,i){if(!this._i.visible())return null;var n=this._i.options();this.bi();var s={F:this.vi,P:n.color,nt:n.lineStyle,si:n.lineType,tt:n.lineWidth,L:this.di,ii:this.wi.timeScale().barSpacing()};return this.Si.B(s),this.Si},i.prototype.gi=function(){var t=this;this.vi.forEach((function(i){i.it=t._i.barColorer().barStyle(i.time).barColor}))},i.prototype.Ni=function(t,i,n){var s=this.xi(t,i);return s.it=n.barStyle(t).barColor,s},i}(mt),zt=/[2-9]/g,Rt=function(){function t(t){void 0===t&&(t=50),this.rn=new Map,this.en=0,this.un=Array.from(new Array(t))}return t.prototype.reset=function(){this.rn.clear(),this.un.fill(void 0)},t.prototype.measureText=function(t,i,n){var s=n||zt,h=String(i).replace(s,"0"),r=this.rn.get(h);if(void 0===r){if(0===(r=t.measureText(h).width)&&0!==i.length)return 0;var e=this.un[this.en];void 0!==e&&this.rn.delete(e),this.un[this.en]=h,this.en=(this.en+1)%this.un.length,this.rn.set(h,r)}return r},t}(),It=function(){function t(t){this.on=null,this.m=null,this.an="right",this.ln=0,this.fn=t}return t.prototype.cn=function(t,i,n,s){this.on=t,this.m=i,this.ln=n,this.an=s},t.prototype.draw=function(t,i){null!==this.m&&null!==this.on&&this.on.draw(t,this.m,this.fn,this.ln,this.an,i)},t}(),jt=function(){function t(t,i,n){this.vn=t,this.fn=new Rt(50),this.dn=i,this.p=n,this.g=-1,this.ht=new It(this.fn)}return t.prototype.renderer=function(t,i){var n=this.p.paneForSource(this.dn);if(null===n)return null;var s=n.isOverlay(this.dn)?n.defaultVisiblePriceScale():this.dn.priceScale();if(null===s)return null;var h=n.priceScalePosition(s);if("overlay"===h)return null;var r=this.p.priceAxisRendererOptions();return r.fontSize!==this.g&&(this.g=r.fontSize,this.fn.reset()),this.ht.cn(this.vn.paneRenderer(),r,i,h),this.ht},t}(),qt=function(){function t(){this.H=null}return t.prototype.B=function(t){this.H=t},t.prototype.draw=function(t,i,n,r){if(null!==this.H&&!1!==this.H.Y){var e=Math.round(this.H.Z*i);if(!(e<0||e>Math.ceil(this.H._n*i))){var u=Math.ceil(this.H.wn*i);t.lineCap="butt",t.strokeStyle=this.H.it,t.lineWidth=Math.floor(this.H.tt*i),s(t,this.H.nt),h(t,e,0,u)}}},t}(),Ut=function(){function t(t){this.Mn={wn:0,_n:0,Z:0,it:"rgba(0, 0, 0, 0)",tt:1,nt:0,Y:!1},this.bn=new qt,this.j=!0,this._i=t,this.wi=t.model(),this.bn.B(this.Mn)}return t.prototype.et=function(){this.j=!0},t.prototype.renderer=function(t,i){return this._i.visible()?(this.j&&(this.mn(t,i),this.j=!1),this.bn):null},t}(),Ht=function(t){function i(i){return t.call(this,i)||this}return m(i,t),i.prototype.mn=function(t,i){this.Mn.Y=!1;var n=this._i.priceScale(),s=n.mode().mode;if(2===s||3===s){var h=this._i.options();if(h.baseLineVisible&&this._i.visible()){var r=this._i.firstValue();null!==r&&(this.Mn.Y=!0,this.Mn.Z=n.priceToCoordinate(r.value,r.value),this.Mn.wn=i,this.Mn._n=t,this.Mn.it=h.baseLineColor,this.Mn.tt=h.baseLineWidth,this.Mn.nt=h.baseLineStyle)}}},i}(Ut),Yt=function(){function t(){this.H=null}return t.prototype.B=function(t){this.H=t},t.prototype.pn=function(){return this.H},t.prototype.draw=function(t,i,n,s){var h=this.H;if(null!==h){t.save();var r=Math.max(1,Math.floor(i)),e=r%2/2,u=Math.round(h.sn.x*i)+e,o=h.sn.y*i;t.fillStyle=h.gn,t.beginPath();var a=Math.max(2,1.5*h.yn)*i;t.arc(u,o,a,0,2*Math.PI,!1),t.fill(),t.fillStyle=h.kn,t.beginPath(),t.arc(u,o,h.V*i,0,2*Math.PI,!1),t.fill(),t.lineWidth=r,t.strokeStyle=h.xn,t.beginPath(),t.arc(u,o,h.V*i+r/2,0,2*Math.PI,!1),t.stroke(),t.restore()}},t}(),$t=[{Nn:0,Cn:.25,Sn:4,Tn:10,Dn:.25,An:0,Bn:.4,Ln:.8},{Nn:.25,Cn:.525,Sn:10,Tn:14,Dn:0,An:0,Bn:.8,Ln:0},{Nn:.525,Cn:1,Sn:14,Tn:14,Dn:0,An:0,Bn:0,Ln:0}];function Kt(t,i,n,s){return function(t,i){if("transparent"===t)return t;var n=w(t),s=n[3];return"rgba(".concat(n[0],", ").concat(n[1],", ").concat(n[2],", ").concat(i*s,")")}(t,n+(s-n)*i)}function Xt(t,i){for(var n,s=t%2600/2600,h=0,e=$t;h<e.length;h++){var u=e[h];if(s>=u.Nn&&s<=u.Cn){n=u;break}}r(void 0!==n,"Last price animation internal logic error");var o,a,l,f=(s-n.Nn)/(n.Cn-n.Nn);return{kn:Kt(i,f,n.Dn,n.An),xn:Kt(i,f,n.Bn,n.Ln),V:(o=f,a=n.Sn,l=n.Tn,a+(l-a)*o)}}var Zt=function(){function t(t){this.ht=new Yt,this.j=!0,this.En=!0,this.Fn=performance.now(),this.On=this.Fn-1,this.Vn=t}return t.prototype.Pn=function(){this.On=this.Fn-1,this.update()},t.prototype.Wn=function(){if(this.update(),2===this.Vn.options().lastPriceAnimation){var t=performance.now(),i=this.On-t;if(i>0)return void(i<650&&(this.On+=2600));this.Fn=t,this.On=t+2600}},t.prototype.update=function(){this.j=!0},t.prototype.zn=function(){this.En=!0},t.prototype.Y=function(){return 0!==this.Vn.options().lastPriceAnimation},t.prototype.Rn=function(){switch(this.Vn.options().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.On}},t.prototype.renderer=function(t,i){return this.j?(this.U(t,i),this.j=!1,this.En=!1):this.En&&(this.In(),this.En=!1),this.ht},t.prototype.U=function(t,i){this.ht.B(null);var n=this.Vn.model().timeScale(),s=n.visibleStrictRange(),h=this.Vn.firstValue();if(null!==s&&null!==h){var r=this.Vn.lastValueData(!0);if(!r.noData&&s.contains(r.index)){var e={x:n.indexToCoordinate(r.index),y:this.Vn.priceScale().priceToCoordinate(r.price,h.value)},u=r.color,o=this.Vn.options().lineWidth,a=Xt(this.jn(),u);this.ht.B({gn:u,yn:o,kn:a.kn,xn:a.xn,V:a.V,sn:e})}}},t.prototype.In=function(){var t=this.ht.pn();if(null!==t){var i=Xt(this.jn(),t.gn);t.kn=i.kn,t.xn=i.xn,t.V=i.V}},t.prototype.jn=function(){return this.Rn()?performance.now()-this.Fn:2599},t}();function Jt(t,i){return Tt(Math.min(Math.max(t,12),30)*i)}function Gt(t,i){switch(t){case"arrowDown":case"arrowUp":return Jt(i,1);case"circle":return Jt(i,.8);case"square":return Jt(i,.7)}}function Qt(t){return St(Jt(t,1))}function ti(t){return Math.max(Jt(t,.1),3)}function ii(t,i,n,s,h){var r=Gt("square",n),e=(r-1)/2,u=t-e,o=i-e;return s>=u&&s<=u+r&&h>=o&&h<=o+r}function ni(t,i,n,s,h){var r=(Gt("arrowUp",h)-1)/2,e=(Tt(h/2)-1)/2;i.beginPath(),t?(i.moveTo(n-r,s),i.lineTo(n,s-r),i.lineTo(n+r,s),i.lineTo(n+e,s),i.lineTo(n+e,s+r),i.lineTo(n-e,s+r),i.lineTo(n-e,s)):(i.moveTo(n-r,s),i.lineTo(n,s+r),i.lineTo(n+r,s),i.lineTo(n+e,s),i.lineTo(n+e,s-r),i.lineTo(n-e,s-r),i.lineTo(n-e,s)),i.fill()}function si(t,i,n,s,h,r){return ii(i,n,s,h,r)}var hi=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.H=null,i.fn=new Rt,i.g=-1,i.k="",i.qn="",i}return m(i,t),i.prototype.B=function(t){this.H=t},i.prototype.cn=function(t,i){this.g===t&&this.k===i||(this.g=t,this.k=i,this.qn=L(t,i),this.fn.reset())},i.prototype.hitTest=function(t,i){if(null===this.H||null===this.H.L)return null;for(var n=this.H.L.from;n<this.H.L.to;n++){var s=this.H.F[n];if(ei(s,t,i))return{hitTestData:s.Un,externalId:s.Hn}}return null},i.prototype.T=function(t,i,n){if(null!==this.H&&null!==this.H.L){t.textBaseline="middle",t.font=this.qn;for(var s=this.H.L.from;s<this.H.L.to;s++){var h=this.H.F[s];void 0!==h.Yn&&(h.Yn.wn=this.fn.measureText(t,h.Yn.$n),h.Yn._n=this.g),ri(h,t)}}},i}(O);function ri(t,i){i.fillStyle=t.it,void 0!==t.Yn&&function(t,i,n,s){t.fillText(i,n,s)}(i,t.Yn.$n,t.x-t.Yn.wn/2,t.Yn.Z),function(t,i){if(0===t.Kn)return;switch(t.Xn){case"arrowDown":return void ni(!1,i,t.x,t.Z,t.Kn);case"arrowUp":return void ni(!0,i,t.x,t.Z,t.Kn);case"circle":return void function(t,i,n,s){var h=(Gt("circle",s)-1)/2;t.beginPath(),t.arc(i,n,h,0,2*Math.PI,!1),t.fill()}(i,t.x,t.Z,t.Kn);case"square":return void function(t,i,n,s){var h=Gt("square",s),r=(h-1)/2,e=i-r,u=n-r;t.fillRect(e,u,h,h)}(i,t.x,t.Z,t.Kn)}t.Xn}(t,i)}function ei(t,i,n){return!(void 0===t.Yn||!function(t,i,n,s,h,r){var e=s/2;return h>=t&&h<=t+n&&r>=i-e&&r<=i+e}(t.x,t.Yn.Z,t.Yn.wn,t.Yn._n,i,n))||function(t,i,n){if(0===t.Kn)return!1;switch(t.Xn){case"arrowDown":case"arrowUp":return si(0,t.x,t.Z,t.Kn,i,n);case"circle":return function(t,i,n,s,h){var r=2+Gt("circle",n)/2,e=t-s,u=i-h;return Math.sqrt(e*e+u*u)<=r}(t.x,t.Z,t.Kn,i,n);case"square":return ii(t.x,t.Z,t.Kn,i,n)}}(t,i,n)}function ui(t,i,n,s,h,r,e,u,o){var a=x(n)?n:n.close,l=x(n)?n:n.high,f=x(n)?n:n.low,c=x(i.size)?Math.max(i.size,0):1,v=Qt(u.barSpacing())*c,d=v/2;switch(t.Kn=v,i.position){case"inBar":return t.Z=e.priceToCoordinate(a,o),void(void 0!==t.Yn&&(t.Yn.Z=t.Z+d+r+.6*h));case"aboveBar":return t.Z=e.priceToCoordinate(l,o)-d-s.Zn,void 0!==t.Yn&&(t.Yn.Z=t.Z-d-.6*h,s.Zn+=1.2*h),void(s.Zn+=v+r);case"belowBar":return t.Z=e.priceToCoordinate(f,o)+d+s.Jn,void 0!==t.Yn&&(t.Yn.Z=t.Z+d+r+.6*h,s.Jn+=1.2*h),void(s.Jn+=v+r)}i.position}var oi=function(){function t(t,i){this.j=!0,this.Gn=!0,this.Qn=!0,this.ts=null,this.ht=new hi,this.Vn=t,this.yt=i,this.H={F:[],L:null}}return t.prototype.update=function(t){this.j=!0,this.Qn=!0,"data"===t&&(this.Gn=!0)},t.prototype.renderer=function(t,i,n){if(!this.Vn.visible())return null;this.j&&this.bi();var s=this.yt.options().layout;return this.ht.cn(s.fontSize,s.fontFamily),this.ht.B(this.H),this.ht},t.prototype.ns=function(){if(this.Qn){if(this.Vn.indexedMarkers().length>0){var t=this.yt.timeScale().barSpacing(),i=ti(t),n=1.5*Qt(t)+2*i;this.ts={above:n,below:n}}else this.ts=null;this.Qn=!1}return this.ts},t.prototype.bi=function(){var t=this.Vn.priceScale(),i=this.yt.timeScale(),n=this.Vn.indexedMarkers();this.Gn&&(this.H.F=n.map((function(t){return{time:t.time,x:0,Z:0,Kn:0,Xn:t.shape,it:t.color,Un:t.internalId,Hn:t.id,Yn:void 0}})),this.Gn=!1);var s=this.yt.options().layout;this.H.L=null;var h=i.visibleStrictRange();if(null!==h){var r=this.Vn.firstValue();if(null!==r&&0!==this.H.F.length){var e=NaN,u=ti(i.barSpacing()),o={Zn:u,Jn:u};this.H.L=Mt(this.H.F,h,!0);for(var a=this.H.L.from;a<this.H.L.to;a++){var l=n[a];l.time!==e&&(o.Zn=u,o.Jn=u,e=l.time);var f=this.H.F[a];f.x=i.indexToCoordinate(l.time),void 0!==l.text&&l.text.length>0&&(f.Yn={$n:l.text,Z:0,wn:0,_n:0});var c=this.Vn.dataAt(l.time);null!==c&&ui(f,l,c,o,s.fontSize,u,t,i,r.value)}this.j=!1}}},t}(),ai=function(t){function i(i){return t.call(this,i)||this}return m(i,t),i.prototype.mn=function(t,i){var n=this.Mn;n.Y=!1;var s=this._i.options();if(s.priceLineVisible&&this._i.visible()){var h=this._i.lastValueData(0===s.priceLineSource);h.noData||(n.Y=!0,n.Z=h.coordinate,n.it=this._i.priceLineColor(h.color),n.wn=i,n._n=t,n.tt=s.priceLineWidth,n.nt=s.priceLineStyle)}},i}(Ut),li=function(t){function i(i){var n=t.call(this)||this;return n.rt=i,n}return m(i,t),i.prototype._t=function(t,i,n){t.visible=!1,i.visible=!1;var s=this.rt;if(s.visible()){var h=s.options(),r=h.lastValueVisible,e=""!==s.title(),u=0===h.seriesLastValueMode,o=s.lastValueData(!1);if(!o.noData){r&&(t.text=this.ss(o,r,u),t.visible=0!==t.text.length),(e||u)&&(i.text=this.hs(o,r,e,u),i.visible=i.text.length>0);var a=s.priceLineColor(o.color),l=M(a);n.background=l.t,n.color=l.i,n.coordinate=o.coordinate,i.borderColor=s.model().backgroundColorAtYPercentFromTop(o.coordinate/s.priceScale().height()),t.borderColor=a}}},i.prototype.hs=function(t,i,n,s){var h="",r=this.rt.title();return n&&0!==r.length&&(h+="".concat(r," ")),i&&s&&(h+=this.rt.priceScale().isPercentage()?t.formattedPriceAbsolute:t.formattedPricePercentage),h.trim()},i.prototype.ss=function(t,i,n){return i?n?this.rt.priceScale().isPercentage()?t.formattedPricePercentage:t.formattedPriceAbsolute:t.text:""},i}(K),fi=function(){function t(t,i){this.rs=t,this.es=i}return t.prototype.equals=function(t){return null!==t&&(this.rs===t.rs&&this.es===t.es)},t.prototype.clone=function(){return new t(this.rs,this.es)},t.prototype.minValue=function(){return this.rs},t.prototype.maxValue=function(){return this.es},t.prototype.length=function(){return this.es-this.rs},t.prototype.isEmpty=function(){return this.es===this.rs||Number.isNaN(this.es)||Number.isNaN(this.rs)},t.prototype.merge=function(i){return null===i?this:new t(Math.min(this.minValue(),i.minValue()),Math.max(this.maxValue(),i.maxValue()))},t.prototype.scaleAroundCenter=function(t){if(x(t)&&0!==this.es-this.rs){var i=.5*(this.es+this.rs),n=this.es-i,s=this.rs-i;n*=t,s*=t,this.es=i+n,this.rs=i+s}},t.prototype.shift=function(t){x(t)&&(this.es+=t,this.rs+=t)},t.prototype.toRaw=function(){return{minValue:this.rs,maxValue:this.es}},t.fromRaw=function(i){return null===i?null:new t(i.minValue,i.maxValue)},t}(),ci=function(){function t(t,i){this.us=t,this.os=i||null}return t.prototype.priceRange=function(){return this.us},t.prototype.margins=function(){return this.os},t.prototype.toRaw=function(){return null===this.us?null:{priceRange:this.us.toRaw(),margins:this.os||void 0}},t.fromRaw=function(i){return null===i?null:new t(fi.fromRaw(i.priceRange),i.margins)},t}(),vi=function(t){function i(i,n){var s=t.call(this,i)||this;return s.ls=n,s}return m(i,t),i.prototype.mn=function(t,i){var n=this.Mn;n.Y=!1;var s=this.ls.options();if(this._i.visible()&&s.lineVisible){var h=this.ls.yCoord();null!==h&&(n.Y=!0,n.Z=h,n.it=s.color,n.wn=i,n._n=t,n.tt=s.lineWidth,n.nt=s.lineStyle)}},i}(Ut),di=function(t){function i(i,n){var s=t.call(this)||this;return s.Vn=i,s.ls=n,s}return m(i,t),i.prototype._t=function(t,i,n){t.visible=!1,i.visible=!1;var s=this.ls.options(),h=s.axisLabelVisible,r=""!==s.title,e=this.Vn;if(h&&e.visible()){var u=this.ls.yCoord();if(null!==u){r&&(i.text=s.title,i.visible=!0),i.borderColor=e.model().backgroundColorAtYPercentFromTop(u/e.priceScale().height()),t.text=e.priceScale().formatPriceAbsolute(s.price),t.visible=!0;var o=M(s.color);n.background=o.t,n.color=o.i,n.coordinate=u}}},i}(K),_i=function(){function t(t,i){this.Vn=t,this.Ot=i,this.fs=new vi(t,this),this.vn=new di(t,this),this.cs=new jt(this.vn,t,t.model())}return t.prototype.applyOptions=function(t){k(this.Ot,t),this.update(),this.Vn.model().lightUpdate()},t.prototype.options=function(){return this.Ot},t.prototype.paneViews=function(){return[this.fs,this.cs]},t.prototype.priceAxisView=function(){return this.vn},t.prototype.update=function(){this.fs.et(),this.vn.update()},t.prototype.yCoord=function(){var t=this.Vn,i=t.priceScale();if(t.model().timeScale().isEmpty()||i.isEmpty())return null;var n=t.firstValue();return null===n?null:i.priceToCoordinate(this.Ot.price,n.value)},t}(),wi=function(t){function i(i){var n=t.call(this)||this;return n.yt=i,n}return m(i,t),i.prototype.model=function(){return this.yt},i}(Q),Mi={barColor:"",barBorderColor:"",barWickColor:""},bi=function(){function t(t){this.Vn=t}return t.prototype.barStyle=function(t,i){var n=this.Vn.seriesType(),s=this.Vn.options();switch(n){case"Line":return this.vs(s,t,i);case"Area":return this.ds(s);case"Baseline":return this._s(s,t,i);case"Bar":return this.ws(s,t,i);case"Candlestick":return this.Ms(s,t,i);case"Histogram":return this.bs(s,t,i)}throw new Error("Unknown chart style")},t.prototype.ws=function(t,i,n){var s=p({},Mi),h=t.upColor,r=t.downColor,e=h,a=r,l=u(this.ps(i,n)),f=o(l.value[0])<=o(l.value[3]);return void 0!==l.color?(s.barColor=l.color,s.barBorderColor=l.color):(s.barColor=f?h:r,s.barBorderColor=f?e:a),s},t.prototype.Ms=function(t,i,n){var s,h,r,e=p({},Mi),a=t.upColor,l=t.downColor,f=t.borderUpColor,c=t.borderDownColor,v=t.wickUpColor,d=t.wickDownColor,_=u(this.ps(i,n)),w=o(_.value[0])<=o(_.value[3]);return e.barColor=null!==(s=_.color)&&void 0!==s?s:w?a:l,e.barBorderColor=null!==(h=_.borderColor)&&void 0!==h?h:w?f:c,e.barWickColor=null!==(r=_.wickColor)&&void 0!==r?r:w?v:d,e},t.prototype.ds=function(t){return p(p({},Mi),{barColor:t.lineColor})},t.prototype._s=function(t,i,n){var s=u(this.ps(i,n)).value[3]>=t.baseValue.price;return p(p({},Mi),{barColor:s?t.topLineColor:t.bottomLineColor})},t.prototype.vs=function(t,i,n){var s,h=u(this.ps(i,n));return p(p({},Mi),{barColor:null!==(s=h.color)&&void 0!==s?s:t.color})},t.prototype.bs=function(t,i,n){var s=p({},Mi),h=u(this.ps(i,n));return s.barColor=void 0!==h.color?h.color:t.color,s},t.prototype.ps=function(t,i){return void 0!==i?i.value:this.Vn.bars().valueAt(t)},t}(),mi=function(){function t(){this.gs=[],this.ys=new Map,this.ks=new Map}return t.prototype.last=function(){return this.size()>0?this.gs[this.gs.length-1]:null},t.prototype.firstIndex=function(){return this.size()>0?this.xs(0):null},t.prototype.lastIndex=function(){return this.size()>0?this.xs(this.gs.length-1):null},t.prototype.size=function(){return this.gs.length},t.prototype.isEmpty=function(){return 0===this.size()},t.prototype.contains=function(t){return null!==this.Ns(t,0)},t.prototype.valueAt=function(t){return this.search(t)},t.prototype.search=function(t,i){void 0===i&&(i=0);var n=this.Ns(t,i);return null===n?null:p(p({},this.Cs(n)),{index:this.xs(n)})},t.prototype.rows=function(){return this.gs},t.prototype.minMaxOnRangeCached=function(t,i,n){if(this.isEmpty())return null;for(var s=null,h=0,r=n;h<r.length;h++){var e=r[h];s=pi(s,this.Ss(t,i,e))}return s},t.prototype.setData=function(t){this.ks.clear(),this.ys.clear(),this.gs=t},t.prototype.xs=function(t){return this.gs[t].index},t.prototype.Cs=function(t){return this.gs[t]},t.prototype.Ns=function(t,i){var n=this.Ts(t);if(null===n&&0!==i)switch(i){case-1:return this.Ds(t);case 1:return this.As(t);default:throw new TypeError("Unknown search mode")}return n},t.prototype.Ds=function(t){var i=this.Bs(t);return i>0&&(i-=1),i!==this.gs.length&&this.xs(i)<t?i:null},t.prototype.As=function(t){var i=this.Ls(t);return i!==this.gs.length&&t<this.xs(i)?i:null},t.prototype.Ts=function(t){var i=this.Bs(t);return i===this.gs.length||t<this.gs[i].index?null:i},t.prototype.Bs=function(t){return vt(this.gs,t,(function(t,i){return t.index<i}))},t.prototype.Ls=function(t){return dt(this.gs,t,(function(t,i){return i.index>t}))},t.prototype.Es=function(t,i,n){for(var s=null,h=t;h<i;h++){var r=this.gs[h].value[n];Number.isNaN(r)||(null===s?s={min:r,max:r}:(r<s.min&&(s.min=r),r>s.max&&(s.max=r)))}return s},t.prototype.Ss=function(t,i,n){if(this.isEmpty())return null;var s=null,h=u(this.firstIndex()),r=u(this.lastIndex()),e=Math.max(t,h),o=Math.min(i,r),a=30*Math.ceil(e/30),l=Math.max(a,30*Math.floor(o/30)),f=this.Bs(e),c=this.Ls(Math.min(o,a,i));s=pi(s,this.Es(f,c,n));var v=this.ys.get(n);void 0===v&&(v=new Map,this.ys.set(n,v));for(var d=Math.max(a+1,e);d<l;d+=30){var _=Math.floor(d/30),w=v.get(_);if(void 0===w){var M=this.Bs(30*_),b=this.Ls(30*(_+1)-1);w=this.Es(M,b,n),v.set(_,w)}s=pi(s,w)}f=this.Bs(l),c=this.Ls(o);return s=pi(s,this.Es(f,c,n))},t}();function pi(t,i){return null===t?i:null===i?t:{min:Math.min(t.min,i.min),max:Math.max(t.max,i.max)}}var gi=function(){function t(){this.H=null}return t.prototype.B=function(t){this.H=t},t.prototype.draw=function(t,i,n,h){if(null!==this.H&&!1!==this.H.Y){var r=[];if(0===this.H.Fs.length){var e=Math.ceil(this.H._n*i),u=Math.round(this.H.Os*i);if(u>e)return;var o=Math.round(this.H.Vs*i);if(o<0)return;var a=Math.ceil(this.H.wn*i),l=Math.round(this.H.Ps*i);if(l>a)return;var f=Math.round(this.H.Ws*i);if(f<0)return;r=[{x:l,y:u},{x:l,y:o},{x:f,y:o},{x:f,y:u}]}else for(var c=0;c<this.H.Fs.length;++c)r.push({x:Math.round(this.H.Fs[c].x*i),y:Math.round(this.H.Fs[c].y*i)});t.beginPath(),t.moveTo(r[r.length-1].x,r[r.length-1].y);for(c=0;c<r.length;++c)t.lineTo(r[c].x,r[c].y);t.fillStyle=this.zs(this.H.kn,this.H.Rs),t.fill(),this.H.Ui&&(t.strokeStyle=this.H.Xi,t.lineWidth=this.H.Is,s(t,this.H.js)),t.stroke()}},t.prototype.zs=function(t,i){3===(t=t.substring(1)).length&&(t="".concat(t[0]).concat(t[0]).concat(t[1]).concat(t[1]).concat(t[2]).concat(t[2]));var n=parseInt(t.substring(0,2),16),s=parseInt(t.substring(2,4),16),h=parseInt(t.substring(4,6),16);return"rgba(".concat(n,", ").concat(s,", ").concat(h,", ").concat(i,")")},t}(),yi=function(t){function i(i,n){var s=t.call(this,i)||this;return s.qs=n,s}return m(i,t),i.prototype.mn=function(t,i){var n=this.Us,s=this.qs.options();if(n.Y=!1,this._i.visible())if(n.kn=s.fillColor,n.Rs=s.fillOpacity,n.Xi=s.borderColor,n.js=s.borderStyle,n.Is=s.borderWidth,n.Ui=s.borderVisible,n.Fs=[],n.Y=!0,n.wn=i,n._n=t,0===s.corners.length){var h=this.qs.yLowCoord(),r=this.qs.yHighCoord();if(null===h||null===r)return;var e=this.qs.xLowCoord(),u=this.qs.xHighCoord();if(null===e||null===u)return;n.Ps=e,n.Ws=0===s.lateTime?1e21:u,n.Os=h,n.Vs=r}else for(var o=0;o<s.corners.length;++o){var a=this.qs.xCoord(s.corners[o].time),l=this.qs.yCoord(s.corners[o].price);if(null===a||null===l)return;n.Fs.push({x:a,y:l})}},i}(function(){function t(t){this.Us={kn:"#000",Rs:1,Xi:"#000",js:0,Is:1,Ui:!1,Fs:[],Ps:0,Ws:0,Os:0,Vs:0,Y:!1,wn:0,_n:0},this.Hs=new gi,this.j=!0,this._i=t,this.wi=t.model(),this.Hs.B(this.Us)}return t.prototype.et=function(){this.j=!0},t.prototype.renderer=function(t,i){return this._i.visible()?(this.j&&(this.mn(t,i),this.j=!1),this.Hs):null},t}()),ki=function(){function t(t,i){this.Vn=t,this.Ot=i,this.Ys=new yi(t,this)}return t.prototype.applyOptions=function(t){k(this.Ot,t),this.update(),this.Vn.model().lightUpdate()},t.prototype.options=function(){return this.Ot},t.prototype.paneView=function(){return this.Ys},t.prototype.update=function(){this.Ys.et()},t.prototype.xLowCoord=function(){return this.xCoord(this.Ot.earlyTime)},t.prototype.xHighCoord=function(){return this.xCoord(this.Ot.lateTime)},t.prototype.yLowCoord=function(){return this.yCoord(this.Ot.highPrice)},t.prototype.yHighCoord=function(){return this.yCoord(this.Ot.lowPrice)},t.prototype.xCoord=function(t){var i=this.Vn.model().timeScale(),n=i.timeToIndex({timestamp:t},!0);return i.isEmpty()||null===n?null:i.indexToCoordinate(n)},t.prototype.yCoord=function(t){var i=this.Vn,n=i.priceScale();if(i.model().timeScale().isEmpty()||n.isEmpty())return null;var s=i.firstValue();return null===s?null:n.priceToCoordinate(t,s.value)},t}(),xi=function(t){function i(i,n,s){var h=t.call(this,i)||this;h.H=new mi,h.fs=new ai(h),h.$s=[],h.Ks=new Ht(h),h.Xs=null,h.Zs=null,h.Js=[],h.Gs=[],h.Qs=null,h.th=[],h.Ot=n,h.ih=s;var r=new li(h);return h.Dt=[r],h.cs=new jt(r,h,i),"Area"!==s&&"Line"!==s&&"Baseline"!==s||(h.Xs=new Zt(h)),h.nh(),h.sh(),h}return m(i,t),i.prototype.createBox=function(t){var i=new ki(this,t);return this.th.push(i),this.model().updateSource(this),i},i.prototype.removeBox=function(t){var i=this.th.indexOf(t);-1!==i&&this.th.splice(i,1),this.model().updateSource(this)},i.prototype.destroy=function(){null!==this.Qs&&clearTimeout(this.Qs)},i.prototype.priceLineColor=function(t){return this.Ot.priceLineColor||t},i.prototype.lastValueData=function(t){var i={noData:!0},n=this.priceScale();if(this.model().timeScale().isEmpty()||n.isEmpty()||this.H.isEmpty())return i;var s,h,r=this.model().timeScale().visibleStrictRange(),e=this.firstValue();if(null===r||null===e)return i;if(t){var u=this.H.last();if(null===u)return i;s=u,h=u.index}else{var o=this.H.search(r.right(),-1);if(null===o)return i;if(null===(s=this.H.valueAt(o.index)))return i;h=o.index}var a=s.value[3],l=this.barColorer().barStyle(h,{value:s}),f=n.priceToCoordinate(a,e.value);return{noData:!1,price:a,text:n.formatPrice(a,e.value),formattedPriceAbsolute:n.formatPriceAbsolute(a),formattedPricePercentage:n.formatPricePercentage(a,e.value),color:l.barColor,coordinate:f,index:h}},i.prototype.barColorer=function(){return null!==this.Zs||(this.Zs=new bi(this)),this.Zs},i.prototype.options=function(){return this.Ot},i.prototype.applyOptions=function(t){var i=t.priceScaleId;void 0!==i&&i!==this.Ot.priceScaleId&&this.model().moveSeriesToScale(this,i),k(this.Ot,t),null!==this._priceScale&&void 0!==t.scaleMargins&&this._priceScale.applyOptions({scaleMargins:t.scaleMargins}),void 0!==t.priceFormat&&(this.nh(),this.model().fullUpdate()),this.model().updateSource(this),this.model().updateCrosshair(),this.zt.update("options")},i.prototype.setData=function(t,i){this.H.setData(t),this.hh(),this.zt.update("data"),this.Vt.update("data"),null!==this.Xs&&(i&&i.lastBarUpdatedOrNewBarsAddedToTheRight?this.Xs.Wn():0===t.length&&this.Xs.Pn());var n=this.model().paneForSource(this);this.model().recalculatePane(n),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},i.prototype.setMarkers=function(t){this.Js=t.map((function(t){return p({},t)})),this.hh();var i=this.model().paneForSource(this);this.Vt.update("data"),this.model().recalculatePane(i),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},i.prototype.indexedMarkers=function(){return this.Gs},i.prototype.createPriceLine=function(t){var i=new _i(this,t);return this.$s.push(i),this.model().updateSource(this),i},i.prototype.removePriceLine=function(t){var i=this.$s.indexOf(t);-1!==i&&this.$s.splice(i,1),this.model().updateSource(this)},i.prototype.customPriceLines=function(){return this.$s},i.prototype.seriesType=function(){return this.ih},i.prototype.firstValue=function(){var t=this.firstBar();return null===t?null:{value:t.value[3],timePoint:t.time}},i.prototype.firstBar=function(){var t=this.model().timeScale().visibleStrictRange();if(null===t)return null;var i=t.left();return this.H.search(i,1)},i.prototype.bars=function(){return this.H},i.prototype.dataAt=function(t){var i=this.H.valueAt(t);return null===i?null:"Bar"===this.ih||"Candlestick"===this.ih?{open:i.value[0],high:i.value[1],low:i.value[2],close:i.value[3]}:i.value[3]},i.prototype.topPaneViews=function(t){var i=this,n=this.Xs;return null!==n&&n.Y()?(null===this.Qs&&n.Rn()&&(this.Qs=setTimeout((function(){i.Qs=null,i.model().cursorUpdate()}),0)),n.zn(),[n]):[]},i.prototype.paneViews=function(){var t=[];this.rh()||t.push(this.Ks);for(var i=0,n=this.$s;i<n.length;i++){var s=n[i];t.push.apply(t,s.paneViews())}t.push(this.zt,this.fs,this.cs,this.Vt);var h=this.th.map((function(t){return t.paneView()}));return t.push.apply(t,h),t},i.prototype.priceAxisViews=function(t,i){if(i!==this._priceScale&&!this.rh())return[];for(var n=g([],this.Dt,!0),s=0,h=this.$s;s<h.length;s++){var r=h[s];n.push(r.priceAxisView())}return n},i.prototype.autoscaleInfo=function(t,i){var n=this;if(void 0!==this.Ot.autoscaleInfoProvider){var s=this.Ot.autoscaleInfoProvider((function(){var s=n.eh(t,i);return null===s?null:s.toRaw()}));return ci.fromRaw(s)}return this.eh(t,i)},i.prototype.minMove=function(){return this.Ot.priceFormat.minMove},i.prototype.formatter=function(){return this.uh},i.prototype.updateAllViews=function(){var t;this.zt.update(),this.Vt.update();for(var i=0,n=this.Dt;i<n.length;i++){n[i].update()}for(var s=0,h=this.$s;s<h.length;s++){h[s].update()}for(var r=0,e=this.th;r<e.length;r++){e[r].update()}this.fs.et(),this.Ks.et(),null===(t=this.Xs)||void 0===t||t.update()},i.prototype.priceScale=function(){return u(t.prototype.priceScale.call(this))},i.prototype.markerDataAtIndex=function(t){if(!(("Line"===this.ih||"Area"===this.ih||"Baseline"===this.ih)&&this.Ot.crosshairMarkerVisible))return null;var i=this.H.valueAt(t);return null===i?null:{price:i.value[3],radius:this.oh(),borderColor:this.ah(),backgroundColor:this.lh(t)}},i.prototype.title=function(){return this.Ot.title},i.prototype.visible=function(){return this.Ot.visible},i.prototype.rh=function(){return!it(this.priceScale().id())},i.prototype.eh=function(t,i){if(!N(t)||!N(i)||this.H.isEmpty())return null;var n="Line"===this.ih||"Area"===this.ih||"Baseline"===this.ih||"Histogram"===this.ih?[3]:[2,1],s=this.H.minMaxOnRangeCached(t,i,n),h=null!==s?new fi(s.min,s.max):null;if("Histogram"===this.seriesType()){var r=this.Ot.base,e=new fi(r,r);h=null!==h?h.merge(e):e}return new ci(h,this.Vt.ns())},i.prototype.oh=function(){switch(this.ih){case"Line":case"Area":case"Baseline":return this.Ot.crosshairMarkerRadius}return 0},i.prototype.ah=function(){switch(this.ih){case"Line":case"Area":case"Baseline":var t=this.Ot.crosshairMarkerBorderColor;if(0!==t.length)return t}return null},i.prototype.lh=function(t){switch(this.ih){case"Line":case"Area":case"Baseline":var i=this.Ot.crosshairMarkerBackgroundColor;if(0!==i.length)return i}return this.barColorer().barStyle(t).barColor},i.prototype.nh=function(){switch(this.Ot.priceFormat.type){case"custom":this.uh={format:this.Ot.priceFormat.formatter};break;case"volume":this.uh=new ut(this.Ot.priceFormat.precision);break;case"percent":this.uh=new et(this.Ot.priceFormat.precision);break;default:var t=Math.pow(10,this.Ot.priceFormat.precision);this.uh=new rt(t,this.Ot.priceFormat.minMove*t)}null!==this._priceScale&&this._priceScale.updateFormatter()},i.prototype.hh=function(){var t=this,i=this.model().timeScale();if(i.isEmpty()||0===this.H.size())this.Gs=[];else{var n=u(this.H.firstIndex());this.Gs=this.Js.map((function(s,h){var r=u(i.timeToIndex(s.time,!0)),e=r<n?1:-1;return{time:u(t.H.search(r,e)).index,position:s.position,shape:s.shape,color:s.color,id:s.id,internalId:h,text:s.text,size:s.size}}))}},i.prototype.sh=function(){switch(this.Vt=new oi(this,this.model()),this.ih){case"Bar":this.zt=new kt(this,this.model());break;case"Candlestick":this.zt=new Et(this,this.model());break;case"Line":this.zt=new Wt(this,this.model());break;case"Area":this.zt=new pt(this,this.model());break;case"Baseline":this.zt=new Bt(this,this.model());break;case"Histogram":this.zt=new Pt(this,this.model());break;default:throw Error("Unknown chart style assigned: "+this.ih)}},i}(wi),Ni=function(){function t(t){this.Ot=t}return t.prototype.fh=function(t,i,n){var s=t;if(0===this.Ot.mode)return s;var h=n.defaultPriceScale(),r=h.firstValue();if(null===r)return s;var e=h.priceToCoordinate(t,r),u=n.dataSources().filter((function(t){return t instanceof xi})).reduce((function(t,s){if(n.isOverlay(s)||!s.visible())return t;var h=s.priceScale(),r=s.bars();if(h.isEmpty()||!r.contains(i))return t;var e=r.valueAt(i);if(null===e)return t;var u=o(s.firstValue());return t.concat([h.priceToCoordinate(e.value[3],u.value)])}),[]);if(0===u.length)return s;u.sort((function(t,i){return Math.abs(t-e)-Math.abs(i-e)}));var a=u[0];return s=h.coordinateToPrice(a,r)},t}(),Ci=function(){function t(){this.H=null}return t.prototype.B=function(t){this.H=t},t.prototype.draw=function(t,i,n,h){var r=this;if(null!==this.H){var e=Math.max(1,Math.floor(i));t.lineWidth=e;var o=Math.ceil(this.H.G*i),a=Math.ceil(this.H.J*i);!function(t,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),i(),t.restore()}(t,(function(){var n=u(r.H);if(n.dh){t.strokeStyle=n._h,s(t,n.wh),t.beginPath();for(var h=0,l=n.Mh;h<l.length;h++){var f=l[h],c=Math.round(f.bh*i);t.moveTo(c,-e),t.lineTo(c,o+e)}t.stroke()}if(n.mh){t.strokeStyle=n.ph,s(t,n.gh),t.beginPath();for(var v=0,d=n.yh;v<d.length;v++){var _=d[v],w=Math.round(_.coord*i);t.moveTo(-e,w),t.lineTo(a+e,w)}t.stroke()}}))}},t}(),Si=function(){function t(t){this.ht=new Ci,this.j=!0,this.Nt=t}return t.prototype.update=function(){this.j=!0},t.prototype.renderer=function(t,i){if(this.j){var n=this.Nt.model().options().grid,s={G:t,J:i,mh:n.horzLines.visible,dh:n.vertLines.visible,ph:n.horzLines.color,_h:n.vertLines.color,gh:n.horzLines.style,wh:n.vertLines.style,yh:this.Nt.defaultPriceScale().marks(),Mh:this.Nt.model().timeScale().marks()||[]};this.ht.B(s),this.j=!1}return this.ht},t}(),Ti=function(){function t(t){this.zt=new Si(t)}return t.prototype.paneView=function(){return this.zt},t}(),Di={kh:4,xh:1e-4};function Ai(t,i){var n=100*(t-i)/i;return i<0?-n:n}function Bi(t,i){var n=Ai(t.minValue(),i),s=Ai(t.maxValue(),i);return new fi(n,s)}function Li(t,i){var n=100*(t-i)/i+100;return i<0?-n:n}function Ei(t,i){var n=Li(t.minValue(),i),s=Li(t.maxValue(),i);return new fi(n,s)}function Fi(t,i){var n=Math.abs(t);if(n<1e-15)return 0;var s=Ct(n+i.xh)+i.kh;return t<0?-s:s}function Oi(t,i){var n=Math.abs(t);if(n<1e-15)return 0;var s=Math.pow(10,n-i.kh)-i.xh;return t<0?-s:s}function Vi(t,i){if(null===t)return null;var n=Fi(t.minValue(),i),s=Fi(t.maxValue(),i);return new fi(n,s)}function Pi(t,i){if(null===t)return null;var n=Oi(t.minValue(),i),s=Oi(t.maxValue(),i);return new fi(n,s)}function Wi(t){if(null===t)return Di;var i=Math.abs(t.maxValue()-t.minValue());if(i>=1||i<1e-15)return Di;var n=Math.ceil(Math.abs(Math.log10(i))),s=Di.kh+n;return{kh:s,xh:1/Math.pow(10,s)}}var zi,Ri=function(){function t(t,i){if(this.Nh=t,this.Ch=i,function(t){if(t<0)return!1;for(var i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.Nh))this.Sh=[2,2.5,2];else{this.Sh=[];for(var n=this.Nh;1!==n;){if(n%2==0)this.Sh.push(2),n/=2;else{if(n%5!=0)throw new Error("unexpected base");this.Sh.push(2,2.5),n/=5}if(this.Sh.length>100)throw new Error("something wrong with base")}}}return t.prototype.Th=function(t,i,n){for(var s,h,r,e=0===this.Nh?0:1/this.Nh,u=Math.pow(10,Math.max(0,Math.ceil(Ct(t-i)))),o=0,a=this.Ch[0];;){var l=Nt(u,e,1e-14)&&u>e+1e-14,f=Nt(u,n*a,1e-14),c=Nt(u,1,1e-14);if(!(l&&f&&c))break;u/=a,a=this.Ch[++o%this.Ch.length]}if(u<=e+1e-14&&(u=e),u=Math.max(1,u),this.Sh.length>0&&(s=u,h=1,r=1e-14,Math.abs(s-h)<r))for(o=0,a=this.Sh[0];Nt(u,n*a,1e-14)&&u>e+1e-14;)u/=a,a=this.Sh[++o%this.Sh.length];return u},t}(),Ii=function(){function t(t,i,n,s){this.Dh=[],this.wt=t,this.Nh=i,this.Ah=n,this.Bh=s}return t.prototype.Th=function(t,i){if(t<i)throw new Error("high < low");var n=this.wt.height(),s=(t-i)*this.Lh()/n,h=new Ri(this.Nh,[2,2.5,2]),r=new Ri(this.Nh,[2,2,2.5]),e=new Ri(this.Nh,[2.5,2,2]),u=[];return u.push(h.Th(t,i,s),r.Th(t,i,s),e.Th(t,i,s)),function(t){if(t.length<1)throw Error("array is empty");for(var i=t[0],n=1;n<t.length;++n)t[n]<i&&(i=t[n]);return i}(u)},t.prototype.Eh=function(){var t=this.wt,i=t.firstValue();if(null!==i){var n=t.height(),s=this.Ah(n-1,i),h=this.Ah(0,i),r=this.wt.options().entireTextOnly?this.Fh()/2:0,e=r,u=n-1-r,o=Math.max(s,h),a=Math.min(s,h);if(o!==a){for(var l=this.Th(o,a),f=o%l,c=o>=a?1:-1,v=null,d=0,_=o-(f+=f<0?l:0);_>a;_-=l){var w=this.Bh(_,i,!0);null!==v&&Math.abs(w-v)<this.Lh()||(w<e||w>u||(d<this.Dh.length?(this.Dh[d].coord=w,this.Dh[d].label=t.formatLogical(_)):this.Dh.push({coord:w,label:t.formatLogical(_)}),d++,v=w,t.isLog()&&(l=this.Th(_*c,a))))}this.Dh.length=d}else this.Dh=[]}else this.Dh=[]},t.prototype.Oh=function(){return this.Dh},t.prototype.Fh=function(){return this.wt.fontSize()},t.prototype.Lh=function(){return Math.ceil(2.5*this.Fh())},t}();function ji(t){return t.slice().sort((function(t,i){return u(t.zorder())-u(i.zorder())}))}!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(zi||(zi={}));var qi=new et,Ui=new rt(100,1),Hi=function(){function t(t,i,n,s){this.Vh=0,this.Ph=null,this.us=null,this.Wh=null,this.zh={Rh:!1,Ih:null},this.jh=0,this.qh=0,this.Uh=new y,this.Hh=new y,this.Yh=[],this.$h=null,this.Kh=null,this.Xh=null,this.Zh=null,this.uh=Ui,this.Jh=Wi(null),this.Gh=t,this.Ot=i,this.Qh=n,this.tr=s,this.ir=new Ii(this,100,this.nr.bind(this),this.sr.bind(this))}return t.prototype.id=function(){return this.Gh},t.prototype.options=function(){return this.Ot},t.prototype.applyOptions=function(t){if(k(this.Ot,t),this.updateFormatter(),void 0!==t.mode&&this.setMode({mode:t.mode}),void 0!==t.scaleMargins){var i=e(t.scaleMargins.top),n=e(t.scaleMargins.bottom);if(i<0||i>1)throw new Error("Invalid top margin - expect value between 0 and 1, given=".concat(i));if(n<0||n>1||i+n>1)throw new Error("Invalid bottom margin - expect value between 0 and 1, given=".concat(n));if(i+n>1)throw new Error("Invalid margins - sum of margins must be less than 1, given=".concat(i+n));this.hr(),this.Kh=null}},t.prototype.isAutoScale=function(){return this.Ot.autoScale},t.prototype.isLog=function(){return 1===this.Ot.mode},t.prototype.isPercentage=function(){return 2===this.Ot.mode},t.prototype.isIndexedTo100=function(){return 3===this.Ot.mode},t.prototype.mode=function(){return{autoScale:this.Ot.autoScale,isInverted:this.Ot.invertScale,mode:this.Ot.mode}},t.prototype.setMode=function(t){var i=this.mode(),n=null;void 0!==t.autoScale&&(this.Ot.autoScale=t.autoScale),void 0!==t.mode&&(this.Ot.mode=t.mode,2!==t.mode&&3!==t.mode||(this.Ot.autoScale=!0),this.zh.Rh=!1),1===i.mode&&t.mode!==i.mode&&(!function(t,i){if(null===t)return!1;var n=Oi(t.minValue(),i),s=Oi(t.maxValue(),i);return isFinite(n)&&isFinite(s)}(this.us,this.Jh)?this.Ot.autoScale=!0:null!==(n=Pi(this.us,this.Jh))&&this.setPriceRange(n)),1===t.mode&&t.mode!==i.mode&&null!==(n=Vi(this.us,this.Jh))&&this.setPriceRange(n);var s=i.mode!==this.Ot.mode;s&&(2===i.mode||this.isPercentage())&&this.updateFormatter(),s&&(3===i.mode||this.isIndexedTo100())&&this.updateFormatter(),void 0!==t.isInverted&&i.isInverted!==t.isInverted&&(this.Ot.invertScale=t.isInverted,this.rr()),this.Hh.v(i,this.mode())},t.prototype.modeChanged=function(){return this.Hh},t.prototype.fontSize=function(){return this.Qh.fontSize},t.prototype.height=function(){return this.Vh},t.prototype.setHeight=function(t){this.Vh!==t&&(this.Vh=t,this.hr(),this.Kh=null)},t.prototype.internalHeight=function(){if(this.Ph)return this.Ph;var t=this.height()-this.er()-this.ur();return this.Ph=t,t},t.prototype.priceRange=function(){return this.ar(),this.us},t.prototype.setPriceRange=function(t,i){var n=this.us;(i||null===n&&null!==t||null!==n&&!n.equals(t))&&(this.Kh=null,this.us=t)},t.prototype.isEmpty=function(){return this.ar(),0===this.Vh||!this.us||this.us.isEmpty()},t.prototype.invertedCoordinate=function(t){return this.isInverted()?t:this.height()-1-t},t.prototype.priceToCoordinate=function(t,i){return this.isPercentage()?t=Ai(t,i):this.isIndexedTo100()&&(t=Li(t,i)),this.sr(t,i)},t.prototype.pointsArrayToCoordinates=function(t,i,n){this.ar();for(var s=this.ur(),h=u(this.priceRange()),r=h.minValue(),e=h.maxValue(),o=this.internalHeight()-1,a=this.isInverted(),l=o/(e-r),f=void 0===n?0:n.from,c=void 0===n?t.length:n.to,v=this.lr(),d=f;d<c;d++){var _=t[d],w=_.price;if(!isNaN(w)){var M=w;null!==v&&(M=v(_.price,i));var b=s+l*(M-r),m=a?b:this.Vh-1-b;_.y=m}}},t.prototype.barPricesToCoordinates=function(t,i,n){this.ar();for(var s=this.ur(),h=u(this.priceRange()),r=h.minValue(),e=h.maxValue(),o=this.internalHeight()-1,a=this.isInverted(),l=o/(e-r),f=void 0===n?0:n.from,c=void 0===n?t.length:n.to,v=this.lr(),d=f;d<c;d++){var _=t[d],w=_.open,M=_.high,b=_.low,m=_.close;null!==v&&(w=v(_.open,i),M=v(_.high,i),b=v(_.low,i),m=v(_.close,i));var p=s+l*(w-r),g=a?p:this.Vh-1-p;_.openY=g,p=s+l*(M-r),g=a?p:this.Vh-1-p,_.highY=g,p=s+l*(b-r),g=a?p:this.Vh-1-p,_.lowY=g,p=s+l*(m-r),g=a?p:this.Vh-1-p,_.closeY=g}},t.prototype.coordinateToPrice=function(t,i){var n=this.nr(t,i);return this.logicalToPrice(n,i)},t.prototype.logicalToPrice=function(t,i){var n=t;return this.isPercentage()?n=function(t,i){return i<0&&(t=-t),t/100*i+i}(n,i):this.isIndexedTo100()&&(n=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(n,i)),n},t.prototype.dataSources=function(){return this.Yh},t.prototype.orderedSources=function(){if(this.$h)return this.$h;for(var t=[],i=0;i<this.Yh.length;i++){var n=this.Yh[i];null===n.zorder()&&n.setZorder(i+1),t.push(n)}return t=ji(t),this.$h=t,this.$h},t.prototype.addDataSource=function(t){-1===this.Yh.indexOf(t)&&(this.Yh.push(t),this.updateFormatter(),this.invalidateSourcesCache())},t.prototype.removeDataSource=function(t){var i=this.Yh.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.Yh.splice(i,1),0===this.Yh.length&&(this.setMode({autoScale:!0}),this.setPriceRange(null)),this.updateFormatter(),this.invalidateSourcesCache()},t.prototype.firstValue=function(){for(var t=null,i=0,n=this.Yh;i<n.length;i++){var s=n[i].firstValue();null!==s&&((null===t||s.timePoint<t.timePoint)&&(t=s))}return null===t?null:t.value},t.prototype.isInverted=function(){return this.Ot.invertScale},t.prototype.marks=function(){var t=null===this.firstValue();if(null!==this.Kh&&(t||this.Kh.cr===t))return this.Kh.Oh;this.ir.Eh();var i=this.ir.Oh();return this.Kh={Oh:i,cr:t},this.Uh.v(),i},t.prototype.onMarksChanged=function(){return this.Uh},t.prototype.startScale=function(t){this.isPercentage()||this.isIndexedTo100()||null===this.Xh&&null===this.Wh&&(this.isEmpty()||(this.Xh=this.Vh-t,this.Wh=u(this.priceRange()).clone()))},t.prototype.scaleTo=function(t){if(!this.isPercentage()&&!this.isIndexedTo100()&&null!==this.Xh){this.setMode({autoScale:!1}),(t=this.Vh-t)<0&&(t=0);var i=(this.Xh+.2*(this.Vh-1))/(t+.2*(this.Vh-1)),n=u(this.Wh).clone();i=Math.max(i,.1),n.scaleAroundCenter(i),this.setPriceRange(n)}},t.prototype.endScale=function(){this.isPercentage()||this.isIndexedTo100()||(this.Xh=null,this.Wh=null)},t.prototype.startScroll=function(t){this.isAutoScale()||null===this.Zh&&null===this.Wh&&(this.isEmpty()||(this.Zh=t,this.Wh=u(this.priceRange()).clone()))},t.prototype.scrollTo=function(t){if(!this.isAutoScale()&&null!==this.Zh){var i=u(this.priceRange()).length()/(this.internalHeight()-1),n=t-this.Zh;this.isInverted()&&(n*=-1);var s=n*i,h=u(this.Wh).clone();h.shift(s),this.setPriceRange(h,!0),this.Kh=null}},t.prototype.endScroll=function(){this.isAutoScale()||null!==this.Zh&&(this.Zh=null,this.Wh=null)},t.prototype.formatter=function(){return this.uh||this.updateFormatter(),this.uh},t.prototype.formatPrice=function(t,i){switch(this.Ot.mode){case 2:return this.formatter().format(Ai(t,i));case 3:return this.formatter().format(Li(t,i));default:return this.vr(t)}},t.prototype.formatLogical=function(t){switch(this.Ot.mode){case 2:case 3:return this.formatter().format(t);default:return this.vr(t)}},t.prototype.formatPriceAbsolute=function(t){return this.vr(t,u(this.dr()).formatter())},t.prototype.formatPricePercentage=function(t,i){return t=Ai(t,i),qi.format(t)},t.prototype.sourcesForAutoScale=function(){return this.Yh},t.prototype.recalculatePriceRange=function(t){this.zh={Ih:t,Rh:!1}},t.prototype.updateAllViews=function(){this.Yh.forEach((function(t){return t.updateAllViews()}))},t.prototype.updateFormatter=function(){this.Kh=null;var t=this.dr(),i=100;null!==t&&(i=Math.round(1/t.minMove())),this.uh=Ui,this.isPercentage()?(this.uh=qi,i=100):this.isIndexedTo100()?(this.uh=new rt(100,1),i=100):null!==t&&(this.uh=t.formatter()),this.ir=new Ii(this,i,this.nr.bind(this),this.sr.bind(this)),this.ir.Eh()},t.prototype.invalidateSourcesCache=function(){this.$h=null},t.prototype.dr=function(){return this.Yh[0]||null},t.prototype.er=function(){return this.isInverted()?this.Ot.scaleMargins.bottom*this.height()+this.qh:this.Ot.scaleMargins.top*this.height()+this.jh},t.prototype.ur=function(){return this.isInverted()?this.Ot.scaleMargins.top*this.height()+this.jh:this.Ot.scaleMargins.bottom*this.height()+this.qh},t.prototype.ar=function(){this.zh.Rh||(this.zh.Rh=!0,this._r())},t.prototype.hr=function(){this.Ph=null},t.prototype.sr=function(t,i){if(this.ar(),this.isEmpty())return 0;t=this.isLog()&&t?Fi(t,this.Jh):t;var n=u(this.priceRange()),s=this.ur()+(this.internalHeight()-1)*(t-n.minValue())/n.length();return this.invertedCoordinate(s)},t.prototype.nr=function(t,i){if(this.ar(),this.isEmpty())return 0;var n=this.invertedCoordinate(t),s=u(this.priceRange()),h=s.minValue()+s.length()*((n-this.ur())/(this.internalHeight()-1));return this.isLog()?Oi(h,this.Jh):h},t.prototype.rr=function(){this.Kh=null,this.ir.Eh()},t.prototype._r=function(){var t=this.zh.Ih;if(null!==t){for(var i,n,s=null,h=0,r=0,e=0,o=this.sourcesForAutoScale();e<o.length;e++){var a=o[e];if(a.visible()){var l=a.firstValue();if(null!==l){var f=a.autoscaleInfo(t.left(),t.right()),c=f&&f.priceRange();if(null!==c){switch(this.Ot.mode){case 1:c=Vi(c,this.Jh);break;case 2:c=Bi(c,l.value);break;case 3:c=Ei(c,l.value)}if(s=null===s?c:s.merge(u(c)),null!==f){var v=f.margins();null!==v&&(h=Math.max(h,v.above),r=Math.max(h,v.below))}}}}}if(h===this.jh&&r===this.qh||(this.jh=h,this.qh=r,this.Kh=null,this.hr()),null!==s){if(s.minValue()===s.maxValue()){var d=this.dr(),_=5*(null===d||this.isPercentage()||this.isIndexedTo100()?1:d.minMove());this.isLog()&&(s=Pi(s,this.Jh)),s=new fi(s.minValue()-_,s.maxValue()+_),this.isLog()&&(s=Vi(s,this.Jh))}if(this.isLog()){var w=Pi(s,this.Jh),M=Wi(w);if(i=M,n=this.Jh,i.kh!==n.kh||i.xh!==n.xh){var b=null!==this.Wh?Pi(this.Wh,this.Jh):null;this.Jh=M,s=Vi(w,M),null!==b&&(this.Wh=Vi(b,M))}}this.setPriceRange(s)}else null===this.us&&(this.setPriceRange(new fi(-.5,.5)),this.Jh=Wi(null));this.zh.Rh=!0}},t.prototype.lr=function(){var t=this;return this.isPercentage()?Ai:this.isIndexedTo100()?Li:this.isLog()?function(i){return Fi(i,t.Jh)}:null},t.prototype.vr=function(t,i){return void 0===this.tr.priceFormatter?(void 0===i&&(i=this.formatter()),i.format(t)):this.tr.priceFormatter(t)},t}(),Yi=function(){function t(t,i){this.Yh=[],this.wr=new Map,this.Vh=0,this.ln=0,this.Mr=1e3,this.$h=null,this.br=new y,this.mr=t,this.yt=i,this.pr=new Ti(this);var n=i.options();this.gr=this.yr("left",n.leftPriceScale),this.kr=this.yr("right",n.rightPriceScale),this.gr.modeChanged().subscribe(this.Nr.bind(this,this.gr),this),this.kr.modeChanged().subscribe(this.Nr.bind(this,this.gr),this),this.applyScaleOptions(n)}return t.prototype.applyScaleOptions=function(t){if(t.leftPriceScale&&this.gr.applyOptions(t.leftPriceScale),t.rightPriceScale&&this.kr.applyOptions(t.rightPriceScale),t.localization&&(this.gr.updateFormatter(),this.kr.updateFormatter()),t.overlayPriceScales)for(var i=0,n=Array.from(this.wr.values());i<n.length;i++){var s=u(n[i][0].priceScale());s.applyOptions(t.overlayPriceScales),t.localization&&s.updateFormatter()}},t.prototype.priceScaleById=function(t){switch(t){case"left":return this.gr;case"right":return this.kr}return this.wr.has(t)?e(this.wr.get(t))[0].priceScale():null},t.prototype.destroy=function(){this.model().priceScalesOptionsChanged().unsubscribeAll(this),this.gr.modeChanged().unsubscribeAll(this),this.kr.modeChanged().unsubscribeAll(this),this.Yh.forEach((function(t){t.destroy&&t.destroy()})),this.br.v()},t.prototype.stretchFactor=function(){return this.Mr},t.prototype.setStretchFactor=function(t){this.Mr=t},t.prototype.model=function(){return this.yt},t.prototype.width=function(){return this.ln},t.prototype.height=function(){return this.Vh},t.prototype.setWidth=function(t){this.ln=t,this.updateAllSources()},t.prototype.setHeight=function(t){var i=this;this.Vh=t,this.gr.setHeight(t),this.kr.setHeight(t),this.Yh.forEach((function(n){if(i.isOverlay(n)){var s=n.priceScale();null!==s&&s.setHeight(t)}})),this.updateAllSources()},t.prototype.dataSources=function(){return this.Yh},t.prototype.isOverlay=function(t){var i=t.priceScale();return null===i||this.gr!==i&&this.kr!==i},t.prototype.addDataSource=function(t,i,n){var s=void 0!==n?n:this.Sr().Cr+1;this.Tr(t,i,s)},t.prototype.removeDataSource=function(t){var i=this.Yh.indexOf(t);r(-1!==i,"removeDataSource: invalid data source"),this.Yh.splice(i,1);var n=u(t.priceScale()).id();if(this.wr.has(n)){var s=e(this.wr.get(n)),h=s.indexOf(t);-1!==h&&(s.splice(h,1),0===s.length&&this.wr.delete(n))}var o=t.priceScale();o&&o.dataSources().indexOf(t)>=0&&o.removeDataSource(t),null!==o&&(o.invalidateSourcesCache(),this.recalculatePriceScale(o)),this.$h=null},t.prototype.priceScalePosition=function(t){return t===this.gr?"left":t===this.kr?"right":"overlay"},t.prototype.leftPriceScale=function(){return this.gr},t.prototype.rightPriceScale=function(){return this.kr},t.prototype.startScalePrice=function(t,i){t.startScale(i)},t.prototype.scalePriceTo=function(t,i){t.scaleTo(i),this.updateAllSources()},t.prototype.endScalePrice=function(t){t.endScale()},t.prototype.startScrollPrice=function(t,i){t.startScroll(i)},t.prototype.scrollPriceTo=function(t,i){t.scrollTo(i),this.updateAllSources()},t.prototype.endScrollPrice=function(t){t.endScroll()},t.prototype.updateAllSources=function(){this.Yh.forEach((function(t){t.updateAllViews()}))},t.prototype.defaultPriceScale=function(){var t=null;return this.yt.options().rightPriceScale.visible&&0!==this.kr.dataSources().length?t=this.kr:this.yt.options().leftPriceScale.visible&&0!==this.gr.dataSources().length?t=this.gr:0!==this.Yh.length&&(t=this.Yh[0].priceScale()),null===t&&(t=this.kr),t},t.prototype.defaultVisiblePriceScale=function(){var t=null;return this.yt.options().rightPriceScale.visible?t=this.kr:this.yt.options().leftPriceScale.visible&&(t=this.gr),t},t.prototype.recalculatePriceScale=function(t){null!==t&&t.isAutoScale()&&this.Dr(t)},t.prototype.resetPriceScale=function(t){var i=this.mr.visibleStrictRange();t.setMode({autoScale:!0}),null!==i&&t.recalculatePriceRange(i),this.updateAllSources()},t.prototype.momentaryAutoScale=function(){this.Dr(this.gr),this.Dr(this.kr)},t.prototype.recalculate=function(){var t=this;this.recalculatePriceScale(this.gr),this.recalculatePriceScale(this.kr),this.Yh.forEach((function(i){t.isOverlay(i)&&t.recalculatePriceScale(i.priceScale())})),this.updateAllSources(),this.yt.lightUpdate()},t.prototype.orderedSources=function(){return null===this.$h&&(this.$h=ji(this.Yh)),this.$h},t.prototype.onDestroyed=function(){return this.br},t.prototype.grid=function(){return this.pr},t.prototype.Dr=function(t){var i=t.sourcesForAutoScale();if(i&&i.length>0&&!this.mr.isEmpty()){var n=this.mr.visibleStrictRange();null!==n&&t.recalculatePriceRange(n)}t.updateAllViews()},t.prototype.Sr=function(){var t=this.orderedSources();if(0===t.length)return{Ar:0,Cr:0};for(var i=0,n=0,s=0;s<t.length;s++){var h=t[s].zorder();null!==h&&(h<i&&(i=h),h>n&&(n=h))}return{Ar:i,Cr:n}},t.prototype.Tr=function(t,i,n){var s=this.priceScaleById(i);if(null===s&&(s=this.yr(i,this.yt.options().overlayPriceScales)),this.Yh.push(t),!it(i)){var h=this.wr.get(i)||[];h.push(t),this.wr.set(i,h)}s.addDataSource(t),t.setPriceScale(s),t.setZorder(n),this.recalculatePriceScale(s),this.$h=null},t.prototype.Nr=function(t,i,n){i.mode!==n.mode&&this.Dr(t)},t.prototype.yr=function(t,i){var n=p({visible:!0,autoScale:!0},T(i)),s=new Hi(t,n,this.yt.options().layout,this.yt.options().localization);return s.setHeight(this.height()),s},t}(),$i=function(t){return t.getUTCFullYear()};function Ki(t,i,n){return i.replace(/yyyy/g,function(t){return ht($i(t),4)}(t)).replace(/yy/g,function(t){return ht($i(t)%100,2)}(t)).replace(/MMMM/g,function(t,i){return new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"})}(t,n)).replace(/MMM/g,function(t,i){return new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"})}(t,n)).replace(/MM/g,function(t){return ht(function(t){return t.getUTCMonth()+1}(t),2)}(t)).replace(/dd/g,function(t){return ht(function(t){return t.getUTCDate()}(t),2)}(t))}var Xi=function(){function t(t,i){void 0===t&&(t="yyyy-MM-dd"),void 0===i&&(i="default"),this.Br=t,this.Lr=i}return t.prototype.Er=function(t){return Ki(t,this.Br,this.Lr)},t}(),Zi=function(){function t(t){this.Fr=t||"%h:%m:%s"}return t.prototype.Er=function(t){return this.Fr.replace("%h",ht(t.getUTCHours(),2)).replace("%m",ht(t.getUTCMinutes(),2)).replace("%s",ht(t.getUTCSeconds(),2))},t}(),Ji={Or:"yyyy-MM-dd",Vr:"%h:%m:%s",Pr:" ",Wr:"default"},Gi=function(){function t(t){void 0===t&&(t={});var i=p(p({},Ji),t);this.zr=new Xi(i.Or,i.Wr),this.Rr=new Zi(i.Vr),this.Ir=i.Pr}return t.prototype.Er=function(t){return"".concat(this.zr.Er(t)).concat(this.Ir).concat(this.Rr.Er(t))},t}();var Qi=function(){function t(t,i){void 0===i&&(i=50),this.jr=0,this.qr=1,this.Ur=1,this.rn=new Map,this.Hr=new Map,this.Yr=t,this.$r=i}return t.prototype.Er=function(t){var i=void 0===t.businessDay?new Date(1e3*t.timestamp).getTime():new Date(Date.UTC(t.businessDay.year,t.businessDay.month-1,t.businessDay.day)).getTime(),n=this.rn.get(i);if(void 0!==n)return n.Kr;if(this.jr===this.$r){var s=this.Hr.get(this.Ur);this.Hr.delete(this.Ur),this.rn.delete(e(s)),this.Ur++,this.jr--}var h=this.Yr(t);return this.rn.set(i,{Kr:h,Xr:this.qr}),this.Hr.set(this.qr,i),this.jr++,this.qr++,h},t}(),tn=function(){function t(t,i){r(t<=i,"right should be >= left"),this.Zr=t,this.Jr=i}return t.prototype.left=function(){return this.Zr},t.prototype.right=function(){return this.Jr},t.prototype.count=function(){return this.Jr-this.Zr+1},t.prototype.contains=function(t){return this.Zr<=t&&t<=this.Jr},t.prototype.equals=function(t){return this.Zr===t.left()&&this.Jr===t.right()},t}();function nn(t,i){return null===t||null===i?t===i:t.equals(i)}var sn,hn=function(){function t(){this.Gr=new Map,this.rn=null}return t.prototype.Qr=function(t,i){this.te(i),this.rn=null;for(var n=i;n<t.length;++n){var s=t[n],h=this.Gr.get(s.timeWeight);void 0===h&&(h=[],this.Gr.set(s.timeWeight,h)),h.push({ie:n,kt:s.time,ne:s.timeWeight})}},t.prototype.se=function(t,i){var n=Math.ceil(i/t);return null!==this.rn&&this.rn.he===n||(this.rn={Oh:this.re(n),he:n}),this.rn.Oh},t.prototype.te=function(t){if(0!==t){var i=[];this.Gr.forEach((function(n,s){t<=n[0].ie?i.push(s):n.splice(vt(n,t,(function(i){return i.ie<t})),1/0)}));for(var n=0,s=i;n<s.length;n++){var h=s[n];this.Gr.delete(h)}}else this.Gr.clear()},t.prototype.re=function(t){for(var i=[],n=0,s=Array.from(this.Gr.keys()).sort((function(t,i){return i-t}));n<s.length;n++){var h=s[n];if(this.Gr.get(h)){var r=i;i=[];for(var u=r.length,o=0,a=e(this.Gr.get(h)),l=a.length,f=1/0,c=-1/0,v=0;v<l;v++){for(var d=a[v],_=d.ie;o<u;){var w=r[o],M=w.ie;if(!(M<_)){f=M;break}o++,i.push(w),c=M,f=1/0}f-_>=t&&_-c>=t&&(i.push(d),c=_)}for(;o<u;o++)i.push(r[o])}}return i},t}(),rn=function(){function t(t){this.ee=t}return t.prototype.ue=function(){return null===this.ee?null:new tn(Math.floor(this.ee.left()),Math.ceil(this.ee.right()))},t.prototype.oe=function(){return this.ee},t.ae=function(){return new t(null)},t}();!function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(sn||(sn={}));var en=function(){function t(t,i,n){this.ln=0,this.le=null,this.fe=[],this.Zh=null,this.Xh=null,this.ce=new hn,this.ve=new Map,this.de=rn.ae(),this._e=!0,this.we=new y,this.Me=new y,this.be=new y,this.me=null,this.pe=null,this.ge=[],this.Ot=i,this.tr=n,this.ye=i.rightOffset,this.ke=i.barSpacing,this.yt=t,this.xe()}return t.prototype.options=function(){return this.Ot},t.prototype.applyLocalizationOptions=function(t){k(this.tr,t),this.Ne(),this.xe()},t.prototype.applyOptions=function(t,i){var n;k(this.Ot,t),this.Ot.fixLeftEdge&&this.Ce(),this.Ot.fixRightEdge&&this.Se(),void 0!==t.barSpacing&&this.yt.setBarSpacing(t.barSpacing),void 0!==t.rightOffset&&this.yt.setRightOffset(t.rightOffset),void 0!==t.minBarSpacing&&this.yt.setBarSpacing(null!==(n=t.barSpacing)&&void 0!==n?n:this.ke),this.Ne(),this.xe(),this.be.v()},t.prototype.indexToTime=function(t){var i;return(null===(i=this.fe[t])||void 0===i?void 0:i.time)||null},t.prototype.timeToIndex=function(t,i){if(this.fe.length<1)return null;if(t.timestamp>this.fe[this.fe.length-1].time.timestamp)return i?this.fe.length-1:null;var n=vt(this.fe,t.timestamp,(function(t,i){return t.time.timestamp<i}));return t.timestamp<this.fe[n].time.timestamp?i?n:null:n},t.prototype.isEmpty=function(){return 0===this.ln||0===this.fe.length||null===this.le},t.prototype.visibleStrictRange=function(){return this.Te(),this.de.ue()},t.prototype.visibleLogicalRange=function(){return this.Te(),this.de.oe()},t.prototype.visibleTimeRange=function(){var t=this.visibleStrictRange();if(null===t)return null;var i={from:t.left(),to:t.right()};return this.timeRangeForLogicalRange(i)},t.prototype.timeRangeForLogicalRange=function(t){var i=Math.round(t.from),n=Math.round(t.to),s=u(this.De()),h=u(this.Ae());return{from:u(this.indexToTime(Math.max(s,i))),to:u(this.indexToTime(Math.min(h,n)))}},t.prototype.logicalRangeForTimeRange=function(t){return{from:u(this.timeToIndex(t.from,!0)),to:u(this.timeToIndex(t.to,!0))}},t.prototype.width=function(){return this.ln},t.prototype.setWidth=function(t){if(isFinite(t)&&!(t<=0)&&this.ln!==t){if(this.Ot.lockVisibleTimeRangeOnResize&&this.ln){var i=this.ke*t/this.ln;this.ke=i}if(this.Ot.fixLeftEdge){var n=this.visibleStrictRange();if(null!==n)if(n.left()<=0){var s=this.ln-t;this.ye-=Math.round(s/this.ke)+1}}this.ln=t,this._e=!0,this.Be(),this.Le()}},t.prototype.indexToCoordinate=function(t){if(this.isEmpty()||!N(t))return 0;var i=this.baseIndex()+this.ye-t;return this.ln-(i+.5)*this.ke-1},t.prototype.indexesToCoordinates=function(t,i){for(var n=this.baseIndex(),s=void 0===i?0:i.from,h=void 0===i?t.length:i.to,r=s;r<h;r++){var e=t[r].time,u=n+this.ye-e,o=this.ln-(u+.5)*this.ke-1;t[r].x=o}},t.prototype.coordinateToIndex=function(t){return Math.ceil(this.Ee(t))},t.prototype.setRightOffset=function(t){this._e=!0,this.ye=t,this.Le(),this.yt.recalculateAllPanes(),this.yt.lightUpdate()},t.prototype.barSpacing=function(){return this.ke},t.prototype.setBarSpacing=function(t){this.Fe(t),this.Le(),this.yt.recalculateAllPanes(),this.yt.lightUpdate()},t.prototype.rightOffset=function(){return this.ye},t.prototype.marks=function(){if(this.isEmpty())return null;if(null!==this.pe)return this.pe;for(var t=this.ke,i=5*(this.yt.options().layout.fontSize+4),n=Math.round(i/t),s=u(this.visibleStrictRange()),h=Math.max(s.left(),s.left()-n),r=Math.max(s.right(),s.right()-n),e=this.ce.se(t,i),o=this.De()+n,a=this.Ae()-n,l=this.Oe(),f=this.Ot.fixLeftEdge||l,c=this.Ot.fixRightEdge||l,v=0,d=0,_=e;d<_.length;d++){var w=_[d];if(h<=w.ie&&w.ie<=r){var M=void 0;v<this.ge.length?((M=this.ge[v]).coord=this.indexToCoordinate(w.ie),M.label=this.Ve(w.kt,w.ne),M.weight=w.ne):(M={needAlignCoordinate:!1,coord:this.indexToCoordinate(w.ie),label:this.Ve(w.kt,w.ne),weight:w.ne},this.ge.push(M)),this.ke>i/2&&!l?M.needAlignCoordinate=!1:M.needAlignCoordinate=f&&w.ie<=o||c&&w.ie>=a,v++}}return this.ge.length=v,this.pe=this.ge,this.ge},t.prototype.restoreDefault=function(){this._e=!0,this.setBarSpacing(this.Ot.barSpacing),this.setRightOffset(this.Ot.rightOffset)},t.prototype.setBaseIndex=function(t){this._e=!0,this.le=t,this.Le(),this.Ce()},t.prototype.zoom=function(t,i){var n=this.Ee(t),s=this.barSpacing(),h=s+i*(s/10);this.setBarSpacing(h),this.Ot.rightBarStaysOnScroll||this.setRightOffset(this.rightOffset()+(n-this.Ee(t)))},t.prototype.startScale=function(t){this.Zh&&this.endScroll(),null===this.Xh&&null===this.me&&(this.isEmpty()||(this.Xh=t,this.Pe()))},t.prototype.scaleTo=function(t){if(null!==this.me){var i=xt(this.ln-t,0,this.ln),n=xt(this.ln-u(this.Xh),0,this.ln);0!==i&&0!==n&&this.setBarSpacing(this.me.Ei*i/n)}},t.prototype.endScale=function(){null!==this.Xh&&(this.Xh=null,this.We())},t.prototype.startScroll=function(t){null===this.Zh&&null===this.me&&(this.isEmpty()||(this.Zh=t,this.Pe()))},t.prototype.scrollTo=function(t){if(null!==this.Zh){var i=(this.Zh-t)/this.barSpacing();this.ye=u(this.me).ze+i,this._e=!0,this.Le()}},t.prototype.endScroll=function(){null!==this.Zh&&(this.Zh=null,this.We())},t.prototype.scrollToRealTime=function(){this.scrollToOffsetAnimated(this.Ot.rightOffset)},t.prototype.scrollToOffsetAnimated=function(t,i){var n=this;if(void 0===i&&(i=400),!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");var s=this.ye,h=performance.now(),r=function(){var e=(performance.now()-h)/i,u=e>=1,o=u?t:s+(t-s)*e;n.setRightOffset(o),u||setTimeout(r,20)};r()},t.prototype.update=function(t,i){this._e=!0,this.fe=t,this.ce.Qr(t,i),this.Le()},t.prototype.visibleBarsChanged=function(){return this.we},t.prototype.logicalRangeChanged=function(){return this.Me},t.prototype.optionsApplied=function(){return this.be},t.prototype.baseIndex=function(){return this.le||0},t.prototype.setVisibleRange=function(t){var i=t.count();this.Fe(this.ln/i),this.ye=t.right()-this.baseIndex(),this.Le(),this._e=!0,this.yt.recalculateAllPanes(),this.yt.lightUpdate()},t.prototype.fitContent=function(){var t=this.De(),i=this.Ae();null!==t&&null!==i&&this.setVisibleRange(new tn(t,i+this.Ot.rightOffset))},t.prototype.setLogicalRange=function(t){var i=new tn(t.from,t.to);this.setVisibleRange(i)},t.prototype.formatDateTime=function(t){return void 0!==this.tr.timeFormatter?this.tr.timeFormatter(t.businessDay||t.timestamp):this.Re.Er(new Date(1e3*t.timestamp))},t.prototype.Oe=function(){var t=this.yt.options(),i=t.handleScroll,n=t.handleScale;return!(i.horzTouchDrag||i.mouseWheel||i.pressedMouseMove||i.vertTouchDrag||n.axisDoubleClickReset||n.axisPressedMouseMove.time||n.mouseWheel||n.pinch)},t.prototype.De=function(){return 0===this.fe.length?null:0},t.prototype.Ae=function(){return 0===this.fe.length?null:this.fe.length-1},t.prototype.Ie=function(t){return(this.ln-1-t)/this.ke},t.prototype.Ee=function(t){var i=this.Ie(t),n=this.baseIndex()+this.ye-i;return Math.round(1e6*n)/1e6},t.prototype.Fe=function(t){var i=this.ke;this.ke=t,this.Be(),i!==this.ke&&(this._e=!0,this.je())},t.prototype.Te=function(){if(this._e)if(this._e=!1,this.isEmpty())this.qe(rn.ae());else{var t=this.baseIndex(),i=this.ln/this.ke,n=this.ye+t,s=new tn(n-i+1,n);this.qe(new rn(s))}},t.prototype.Be=function(){var t=this.Ue();if(this.ke<t&&(this.ke=t,this._e=!0),0!==this.ln){var i=.5*this.ln;this.ke>i&&(this.ke=i,this._e=!0)}},t.prototype.Ue=function(){return this.Ot.fixLeftEdge&&this.Ot.fixRightEdge&&0!==this.fe.length?this.ln/this.fe.length:this.Ot.minBarSpacing},t.prototype.Le=function(){var t=this.He();this.ye>t&&(this.ye=t,this._e=!0);var i=this.Ye();null!==i&&this.ye<i&&(this.ye=i,this._e=!0)},t.prototype.Ye=function(){var t=this.De(),i=this.le;return null===t||null===i?null:t-i-1+(this.Ot.fixLeftEdge?this.ln/this.ke:Math.min(2,this.fe.length))},t.prototype.He=function(){return this.Ot.fixRightEdge?0:this.ln/this.ke-Math.min(2,this.fe.length)},t.prototype.Pe=function(){this.me={Ei:this.barSpacing(),ze:this.rightOffset()}},t.prototype.We=function(){this.me=null},t.prototype.Ve=function(t,i){var n=this,s=this.ve.get(i);return void 0===s&&(s=new Qi((function(t){return n.$e(t,i)})),this.ve.set(i,s)),s.Er(t)},t.prototype.$e=function(t,i){var n,s=function(t,i,n){switch(t){case 0:case 10:return i?n?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return i?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(i,this.Ot.timeVisible,this.Ot.secondsVisible);return void 0!==this.Ot.tickMarkFormatter?this.Ot.tickMarkFormatter(null!==(n=t.businessDay)&&void 0!==n?n:t.timestamp,s,this.tr.locale):function(t,i,n){var s={};switch(i){case 0:s.year="numeric";break;case 1:s.month="short";break;case 2:s.day="numeric";break;case 3:s.hour12=!1,s.hour="2-digit",s.minute="2-digit";break;case 4:s.hour12=!1,s.hour="2-digit",s.minute="2-digit",s.second="2-digit"}var h=void 0===t.businessDay?new Date(1e3*t.timestamp):new Date(Date.UTC(t.businessDay.year,t.businessDay.month-1,t.businessDay.day));return new Date(h.getUTCFullYear(),h.getUTCMonth(),h.getUTCDate(),h.getUTCHours(),h.getUTCMinutes(),h.getUTCSeconds(),h.getUTCMilliseconds()).toLocaleString(n,s)}(t,s,this.tr.locale)},t.prototype.qe=function(t){var i=this.de;this.de=t,nn(i.ue(),this.de.ue())||this.we.v(),nn(i.oe(),this.de.oe())||this.Me.v(),this.je()},t.prototype.je=function(){this.pe=null},t.prototype.Ne=function(){this.je(),this.ve.clear()},t.prototype.xe=function(){var t=this.tr.dateFormat;this.Ot.timeVisible?this.Re=new Gi({Or:t,Vr:this.Ot.secondsVisible?"%h:%m:%s":"%h:%m",Pr:"   ",Wr:this.tr.locale}):this.Re=new Xi(t,this.tr.locale)},t.prototype.Ce=function(){if(this.Ot.fixLeftEdge){var t=this.De();if(null!==t){var i=this.visibleStrictRange();if(null!==i){var n=i.left()-t;if(n<0){var s=this.ye-n-1;this.setRightOffset(s)}this.Be()}}}},t.prototype.Se=function(){this.Le(),this.Be()},t}();var un,on=function(t){function i(i){var n=t.call(this)||this;return n.Ke=new Map,n.H=i,n}return m(i,t),i.prototype.T=function(t){},i.prototype.D=function(t){if(this.H.Y){t.save();for(var i=0,n=0,s=this.H.Xe;n<s.length;n++){if(0!==(o=s[n]).Yn.length){t.font=o.Ze;var h=this.Je(t,o.Yn);h>this.H.wn?o.Ge=this.H.wn/h:o.Ge=1,i+=o.Qe*o.Ge}}var r=0;switch(this.H.tu){case"top":r=0;break;case"center":r=Math.max((this.H._n-i)/2,0);break;case"bottom":r=Math.max(this.H._n-i,0)}t.fillStyle=this.H.it;for(var e=0,u=this.H.Xe;e<u.length;e++){var o=u[e];t.save();var a=0;switch(this.H.iu){case"left":t.textAlign="left",a=o.Qe/2;break;case"center":t.textAlign="center",a=this.H.wn/2;break;case"right":t.textAlign="right",a=this.H.wn-1-o.Qe/2}t.translate(a,r),t.textBaseline="top",t.font=o.Ze,t.scale(o.Ge,o.Ge),t.fillText(o.Yn,0,o.nu),t.restore(),r+=o.Qe*o.Ge}t.restore()}},i.prototype.Je=function(t,i){var n=this.su(t.font),s=n.get(i);return void 0===s&&(s=t.measureText(i).width,n.set(i,s)),s},i.prototype.su=function(t){var i=this.Ke.get(t);return void 0===i&&(i=new Map,this.Ke.set(t,i)),i},i}(O),an=function(){function t(t){this.j=!0,this.st={Y:!1,it:"",_n:0,wn:0,Xe:[],tu:"center",iu:"center"},this.ht=new on(this.st),this.rt=t}return t.prototype.update=function(){this.j=!0},t.prototype.renderer=function(t,i){return this.j&&(this.U(t,i),this.j=!1),this.ht},t.prototype.U=function(t,i){var n=this.rt.options(),s=this.st;s.Y=n.visible,s.Y&&(s.it=n.color,s.wn=i,s._n=t,s.iu=n.horzAlign,s.tu=n.vertAlign,s.Xe=[{Yn:n.text,Ze:L(n.fontSize,n.fontFamily,n.fontStyle),Qe:1.2*n.fontSize,nu:0,Ge:0}])},t}(),ln=function(t){function i(i,n){var s=t.call(this)||this;return s.Ot=n,s.zt=new an(s),s}return m(i,t),i.prototype.priceAxisViews=function(){return[]},i.prototype.paneViews=function(){return[this.zt]},i.prototype.options=function(){return this.Ot},i.prototype.updateAllViews=function(){this.zt.update()},i}(Q);!function(t){t[t.OnTouchEnd=0]="OnTouchEnd",t[t.OnNextTap=1]="OnNextTap"}(un||(un={}));var fn,cn,vn,dn=function(){function t(t,i){this.hu=[],this.ru=[],this.ln=0,this.eu=null,this.uu=null,this.ou=new y,this.au=new y,this.lu=new y,this.fu=null,this.cu=t,this.Ot=i,this.vu=new E(this),this.mr=new en(this,i.timeScale,this.Ot.localization),this.q=new tt(this,i.crosshair),this.du=new Ni(i.crosshair),this._u=new ln(this,i.watermark),this.createPane(),this.hu[0].setStretchFactor(2e3),this.wu=this.Mu(0),this.bu=this.Mu(1)}return t.prototype.fullUpdate=function(){this.mu(new nt(3))},t.prototype.lightUpdate=function(){this.mu(new nt(2))},t.prototype.cursorUpdate=function(){this.mu(new nt(1))},t.prototype.updateSource=function(t){var i=this.pu(t);this.mu(i)},t.prototype.hoveredSource=function(){return this.uu},t.prototype.setHoveredSource=function(t){var i=this.uu;this.uu=t,null!==i&&this.updateSource(i.source),null!==t&&this.updateSource(t.source)},t.prototype.options=function(){return this.Ot},t.prototype.applyOptions=function(t){k(this.Ot,t),this.hu.forEach((function(i){return i.applyScaleOptions(t)})),void 0!==t.timeScale&&this.mr.applyOptions(t.timeScale),void 0!==t.localization&&this.mr.applyLocalizationOptions(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.ou.v(),this.wu=this.Mu(0),this.bu=this.Mu(1),this.fullUpdate()},t.prototype.applyPriceScaleOptions=function(t,i){if("left"!==t)if("right"!==t){var n=this.findPriceScale(t);null!==n&&(n.priceScale.applyOptions(i),this.ou.v())}else this.applyOptions({rightPriceScale:i});else this.applyOptions({leftPriceScale:i})},t.prototype.findPriceScale=function(t){for(var i=0,n=this.hu;i<n.length;i++){var s=n[i],h=s.priceScaleById(t);if(null!==h)return{pane:s,priceScale:h}}return null},t.prototype.timeScale=function(){return this.mr},t.prototype.panes=function(){return this.hu},t.prototype.watermarkSource=function(){return this._u},t.prototype.crosshairSource=function(){return this.q},t.prototype.crosshairMoved=function(){return this.au},t.prototype.customPriceLineDragged=function(){return this.lu},t.prototype.setPaneHeight=function(t,i){t.setHeight(i),this.recalculateAllPanes()},t.prototype.setWidth=function(t){this.ln=t,this.mr.setWidth(this.ln),this.hu.forEach((function(i){return i.setWidth(t)})),this.recalculateAllPanes()},t.prototype.createPane=function(t){var i=new Yi(this.mr,this);void 0!==t?this.hu.splice(t,0,i):this.hu.push(i);var n=void 0===t?this.hu.length-1:t,s=new nt(3);return s.invalidatePane(n,{level:0,autoScale:!0}),this.mu(s),i},t.prototype.startScalePrice=function(t,i,n){t.startScalePrice(i,n)},t.prototype.scalePriceTo=function(t,i,n){t.scalePriceTo(i,n),this.updateCrosshair(),this.mu(this.gu(t,2))},t.prototype.endScalePrice=function(t,i){t.endScalePrice(i),this.mu(this.gu(t,2))},t.prototype.startScrollPrice=function(t,i,n){i.isAutoScale()||t.startScrollPrice(i,n)},t.prototype.scrollPriceTo=function(t,i,n){i.isAutoScale()||(t.scrollPriceTo(i,n),this.updateCrosshair(),this.mu(this.gu(t,2)))},t.prototype.endScrollPrice=function(t,i){i.isAutoScale()||(t.endScrollPrice(i),this.mu(this.gu(t,2)))},t.prototype.resetPriceScale=function(t,i){t.resetPriceScale(i),this.mu(this.gu(t,2))},t.prototype.startScaleTime=function(t){this.mr.startScale(t)},t.prototype.zoomTime=function(t,i){var n=this.timeScale();if(!n.isEmpty()&&0!==i){var s=n.width();t=Math.max(1,Math.min(t,s)),n.zoom(t,i),this.recalculateAllPanes()}},t.prototype.scrollChart=function(t){this.startScrollTime(0),this.scrollTimeTo(t),this.endScrollTime()},t.prototype.scaleTimeTo=function(t){this.mr.scaleTo(t),this.recalculateAllPanes()},t.prototype.endScaleTime=function(){this.mr.endScale(),this.lightUpdate()},t.prototype.startScrollTime=function(t){this.eu=t,this.mr.startScroll(t)},t.prototype.scrollTimeTo=function(t){var i=!1;return null!==this.eu&&Math.abs(t-this.eu)>20&&(this.eu=null,i=!0),this.mr.scrollTo(t),this.recalculateAllPanes(),i},t.prototype.endScrollTime=function(){this.mr.endScroll(),this.lightUpdate(),this.eu=null},t.prototype.serieses=function(){return this.ru},t.prototype.setAndSaveCurrentPosition=function(t,i,n){this.q.saveOriginCoord(t,i);var s=NaN,h=this.mr.coordinateToIndex(t),r=this.mr.visibleStrictRange();null!==r&&(h=Math.min(Math.max(r.left(),h),r.right()));var e=n.defaultPriceScale(),u=e.firstValue();null!==u&&(s=e.coordinateToPrice(i,u)),s=this.du.fh(s,h,n),this.q.setPosition(h,s,n),this.cursorUpdate(),this.au.v(this.q.appliedIndex(),{x:t,y:i})},t.prototype.clearCurrentPosition=function(){this.crosshairSource().clearPosition(),this.cursorUpdate(),this.au.v(null,null)},t.prototype.updateCrosshair=function(){var t=this.q.pane();if(null!==t){var i=this.q.originCoordX(),n=this.q.originCoordY();this.setAndSaveCurrentPosition(i,n,t)}this.q.updateAllViews()},t.prototype.updateTimeScale=function(t,i,n){var s=this.mr.indexToTime(0);void 0!==i&&void 0!==n&&this.mr.update(i,n);var h=this.mr.indexToTime(0),r=this.mr.baseIndex(),e=this.mr.visibleStrictRange();if(null!==e&&null!==s&&null!==h){var u=e.contains(r),o=s.timestamp>h.timestamp,a=null!==t&&t>r&&!o,l=u&&this.mr.options().shiftVisibleRangeOnNewBar;if(a&&!l){var f=t-r;this.mr.setRightOffset(this.mr.rightOffset()-f)}}this.mr.setBaseIndex(t)},t.prototype.recalculatePane=function(t){null!==t&&t.recalculate()},t.prototype.paneForSource=function(t){var i=this.hu.find((function(i){return i.orderedSources().includes(t)}));return void 0===i?null:i},t.prototype.recalculateAllPanes=function(){this._u.updateAllViews(),this.hu.forEach((function(t){return t.recalculate()})),this.updateCrosshair()},t.prototype.fireCustomPriceLineDragged=function(t,i){this.lu.v(t,i)},t.prototype.destroy=function(){this.hu.forEach((function(t){return t.destroy()})),this.hu.length=0,this.Ot.localization.priceFormatter=void 0,this.Ot.localization.timeFormatter=void 0},t.prototype.rendererOptionsProvider=function(){return this.vu},t.prototype.priceAxisRendererOptions=function(){return this.vu.options()},t.prototype.priceScalesOptionsChanged=function(){return this.ou},t.prototype.createSeries=function(t,i){var n=this.hu[0],s=this.yu(i,t,n);return this.ru.push(s),1===this.ru.length?this.fullUpdate():this.lightUpdate(),s},t.prototype.removeSeries=function(t){var i=this.paneForSource(t),n=this.ru.indexOf(t);r(-1!==n,"Series not found"),this.ru.splice(n,1),u(i).removeDataSource(t),t.destroy&&t.destroy()},t.prototype.moveSeriesToScale=function(t,i){var n=u(this.paneForSource(t));n.removeDataSource(t);var s=this.findPriceScale(i);if(null===s){var h=t.zorder();n.addDataSource(t,i,h)}else{h=s.pane===n?t.zorder():void 0;s.pane.addDataSource(t,i,h)}},t.prototype.fitContent=function(){var t=new nt(2);t.setFitContent(),this.mu(t)},t.prototype.setTargetLogicalRange=function(t){var i=new nt(2);i.applyRange(t),this.mu(i)},t.prototype.resetTimeScale=function(){var t=new nt(2);t.resetTimeScale(),this.mu(t)},t.prototype.setBarSpacing=function(t){var i=new nt(2);i.setBarSpacing(t),this.mu(i)},t.prototype.setRightOffset=function(t){var i=new nt(2);i.setRightOffset(t),this.mu(i)},t.prototype.defaultVisiblePriceScaleId=function(){return this.Ot.rightPriceScale.visible?"right":"left"},t.prototype.backgroundBottomColor=function(){return this.bu},t.prototype.backgroundTopColor=function(){return this.wu},t.prototype.backgroundColorAtYPercentFromTop=function(t){var i=this.bu,n=this.wu;if(i===n)return i;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this.fu||this.fu.ei!==n||this.fu.ui!==i)this.fu={ei:n,ui:i,ku:new Map};else{var s=this.fu.ku.get(t);if(void 0!==s)return s}var h=function(t,i,n){var s=w(t),h=s[0],r=s[1],e=s[2],u=s[3],o=w(i),a=o[0],c=o[1],v=o[2],d=o[3],_=[l(h+n*(a-h)),l(r+n*(c-r)),l(e+n*(v-e)),f(u+n*(d-u))];return"rgba(".concat(_[0],", ").concat(_[1],", ").concat(_[2],", ").concat(_[3],")")}(n,i,t/100);return this.fu.ku.set(t,h),h},t.prototype.gu=function(t,i){var n=new nt(i);if(null!==t){var s=this.hu.indexOf(t);n.invalidatePane(s,{level:i})}return n},t.prototype.pu=function(t,i){return void 0===i&&(i=2),this.gu(this.paneForSource(t),i)},t.prototype.mu=function(t){this.cu&&this.cu(t),this.hu.forEach((function(t){return t.grid().paneView().update()}))},t.prototype.yu=function(t,i,n){var s=new xi(this,t,i),h=void 0!==t.priceScaleId?t.priceScaleId:this.defaultVisiblePriceScaleId();return n.addDataSource(s,h),it(h)||s.applyOptions(t),s},t.prototype.Mu=function(t){var i=this.Ot.layout;return"gradient"===i.background.type?0===t?i.background.topColor:i.background.bottomColor:i.background.color},t}();function _n(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}function wn(t){return!x(t)&&!C(t)}function Mn(t){return x(t)}!function(t){t[t.Disabled=0]="Disabled",t[t.Continuous=1]="Continuous",t[t.OnDataUpdate=2]="OnDataUpdate"}(fn||(fn={})),function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}(cn||(cn={})),function(t){t.Solid="solid",t.VerticalGradient="gradient"}(vn||(vn={}));var bn=function(){function t(t,i){this.J=t,this.G=i}return t.prototype.xu=function(t){return this.J===t.J&&this.G===t.G},t}();function mn(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||1}function pn(t){var i=u(t.getContext("2d"));return i.setTransform(1,0,0,1,0,0),i}function gn(t,i){var n=t.createElement("canvas"),s=mn(n);return n.style.width="".concat(i.J,"px"),n.style.height="".concat(i.G,"px"),n.width=i.J*s,n.height=i.G*s,n}function yn(i,n){var s=u(i.ownerDocument).createElement("canvas");i.appendChild(s);var h=t(s,{allowDownsampling:!1});return h.resizeCanvas({width:n.J,height:n.G}),h}function kn(t,i){return t.Nu-i.Nu}function xn(t,i,n){var s=(t.Nu-i.Nu)/(t.kt-i.kt);return Math.sign(s)*Math.min(Math.abs(s),n)}var Nn=function(){function t(t,i,n,s){this.Cu=null,this.Su=null,this.Tu=null,this.Du=null,this.Au=null,this.Bu=0,this.Lu=0,this.Eu=!1,this.Fu=t,this.Ou=i,this.Vu=n,this.Xt=s}return t.prototype.Pu=function(t,i){if(null!==this.Cu){if(this.Cu.kt===i)return void(this.Cu.Nu=t);if(Math.abs(this.Cu.Nu-t)<this.Xt)return}this.Du=this.Tu,this.Tu=this.Su,this.Su=this.Cu,this.Cu={kt:i,Nu:t}},t.prototype.Nn=function(t,i){if(null!==this.Cu&&null!==this.Su&&!(i-this.Cu.kt>50)){var n=0,s=xn(this.Cu,this.Su,this.Ou),h=kn(this.Cu,this.Su),r=[s],e=[h];if(n+=h,null!==this.Tu){var u=xn(this.Su,this.Tu,this.Ou);if(Math.sign(u)===Math.sign(s)){var o=kn(this.Su,this.Tu);if(r.push(u),e.push(o),n+=o,null!==this.Du){var a=xn(this.Tu,this.Du,this.Ou);if(Math.sign(a)===Math.sign(s)){var l=kn(this.Tu,this.Du);r.push(a),e.push(l),n+=l}}}}for(var f,c,v,d=0,_=0;_<r.length;++_)d+=e[_]/n*r[_];if(!(Math.abs(d)<this.Fu))this.Au={Nu:t,kt:i},this.Lu=d,this.Bu=(f=Math.abs(d),c=this.Vu,v=Math.log(c),Math.log(1*v/-f)/v)}},t.prototype.Wu=function(t){var i=u(this.Au),n=t-i.kt;return i.Nu+this.Lu*(Math.pow(this.Vu,n)-1)/Math.log(this.Vu)},t.prototype.zu=function(t){return null===this.Au||this.Ru(t)===this.Bu},t.prototype.Iu=function(){return this.Eu},t.prototype.ju=function(){this.Eu=!0},t.prototype.Ru=function(t){var i=t-u(this.Au).kt;return Math.min(i,this.Bu)},t}(),Cn="undefined"!=typeof window;function Sn(){return!!Cn&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function Tn(){return!!Cn&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function Dn(t){Cn&&void 0!==window.chrome&&t.addEventListener("mousedown",(function(t){if(1===t.button)return t.preventDefault(),!1}))}var An=function(){function t(t,i,n){var s=this;this.qu=0,this.Uu=null,this.Hu={X:Number.NEGATIVE_INFINITY,Z:Number.POSITIVE_INFINITY},this.Yu=0,this.$u=null,this.Ku={X:Number.NEGATIVE_INFINITY,Z:Number.POSITIVE_INFINITY},this.Xu=null,this.Zu=!1,this.Ju=null,this.Gu=null,this.Qu=!1,this.io=!1,this.no=!1,this.so=null,this.ho=null,this.ro=null,this.eo=null,this.uo=null,this.oo=null,this.ao=null,this.lo=0,this.fo=!1,this.co=!1,this.vo=!1,this.do=0,this._o=null,this.wo=!Tn(),this.Mo=function(t){s.bo(t)},this.mo=function(t){if(s.po(t)){var i=s.yo(t);if(++s.Yu,s.$u&&s.Yu>1)s.xo(En(t),s.Ku).ko<30&&!s.no&&s.No(i,s.So.Co),s.To()}else{i=s.yo(t);if(++s.qu,s.Uu&&s.qu>1)s.xo(En(t),s.Hu).ko<5&&!s.io&&s.Do(i,s.So.Ao),s.Bo()}},this.Lo=t,this.So=i,this.Ot=n,this.Eo()}return t.prototype.destroy=function(){null!==this.so&&(this.so(),this.so=null),null!==this.ho&&(this.ho(),this.ho=null),null!==this.eo&&(this.eo(),this.eo=null),null!==this.uo&&(this.uo(),this.uo=null),null!==this.oo&&(this.oo(),this.oo=null),null!==this.ro&&(this.ro(),this.ro=null),this.Fo(),this.Bo()},t.prototype.Oo=function(t){var i=this;this.eo&&this.eo();var n=this.Vo.bind(this);if(this.eo=function(){i.Lo.removeEventListener("mousemove",n)},this.Lo.addEventListener("mousemove",n),!this.po(t)){var s=this.yo(t);this.Do(s,this.So.Po),this.wo=!0}},t.prototype.Bo=function(){null!==this.Uu&&clearTimeout(this.Uu),this.qu=0,this.Uu=null,this.Hu={X:Number.NEGATIVE_INFINITY,Z:Number.POSITIVE_INFINITY}},t.prototype.To=function(){null!==this.$u&&clearTimeout(this.$u),this.Yu=0,this.$u=null,this.Ku={X:Number.NEGATIVE_INFINITY,Z:Number.POSITIVE_INFINITY}},t.prototype.Vo=function(t){if(!this.vo&&null===this.Gu&&!this.po(t)){var i=this.yo(t);this.Do(i,this.So.Wo),this.wo=!0}},t.prototype.zo=function(t){var i=On(t.changedTouches,u(this._o));if(null!==i&&(this.do=Fn(t),null===this.ao&&!this.co)){this.fo=!0;var n=this.xo(En(i),u(this.Gu)),s=n.Ro,h=n.Io,r=n.ko;if(this.Qu||!(r<5)){if(!this.Qu){var e=.5*s,o=h>=e&&!this.Ot.jo(),a=e>h&&!this.Ot.qo();o||a||(this.co=!0),this.Qu=!0,this.no=!0,this.Fo(),this.To()}if(!this.co){var l=this.yo(t,i);this.No(l,this.So.Uo),Ln(t)}}}},t.prototype.Ho=function(t){if(0===t.button&&(this.xo(En(t),u(this.Ju)).ko>=5&&(this.io=!0,this.Bo()),this.io)){var i=this.yo(t);this.Do(i,this.So.Yo)}},t.prototype.xo=function(t,i){var n=Math.abs(i.X-t.X),s=Math.abs(i.Z-t.Z);return{Ro:n,Io:s,ko:n+s}},t.prototype.$o=function(t){var i=On(t.changedTouches,u(this._o));if(null===i&&0===t.touches.length&&(i=t.changedTouches[0]),null!==i){this._o=null,this.do=Fn(t),this.Fo(),this.Gu=null,this.oo&&(this.oo(),this.oo=null);var n=this.yo(t,i);if(this.No(n,this.So.Ko),++this.Yu,this.$u&&this.Yu>1)this.xo(En(i),this.Ku).ko<30&&!this.no&&this.No(n,this.So.Co),this.To();else this.no||(this.No(n,this.So.Xo),this.So.Xo&&Ln(t));0===this.Yu&&Ln(t),0===t.touches.length&&this.Zu&&(this.Zu=!1,Ln(t))}},t.prototype.bo=function(t){if(0===t.button){var i=this.yo(t);if(this.Ju=null,this.vo=!1,this.uo&&(this.uo(),this.uo=null),Sn())this.Lo.ownerDocument.documentElement.removeEventListener("mouseleave",this.Mo);if(!this.po(t))if(this.Do(i,this.So.Zo),++this.qu,this.Uu&&this.qu>1)this.xo(En(t),this.Hu).ko<5&&!this.io&&this.Do(i,this.So.Ao),this.Bo();else this.io||this.Do(i,this.So.Jo)}},t.prototype.Fo=function(){null!==this.Xu&&(clearTimeout(this.Xu),this.Xu=null)},t.prototype.Go=function(t){if(null===this._o){var i=t.changedTouches[0];this._o=i.identifier,this.do=Fn(t);var n=this.Lo.ownerDocument.documentElement;this.no=!1,this.Qu=!1,this.co=!1,this.Gu=En(i),this.oo&&(this.oo(),this.oo=null);var s=this.zo.bind(this),h=this.$o.bind(this);this.oo=function(){n.removeEventListener("touchmove",s),n.removeEventListener("touchend",h)},n.addEventListener("touchmove",s,{passive:!1}),n.addEventListener("touchend",h,{passive:!1}),this.Fo(),this.Xu=setTimeout(this.Qo.bind(this,t),240);var r=this.yo(t,i);this.No(r,this.So.ta),this.$u||(this.Yu=0,this.$u=setTimeout(this.To.bind(this),500),this.Ku=En(i))}},t.prototype.ia=function(t){if(0===t.button){var i=this.Lo.ownerDocument.documentElement;Sn()&&i.addEventListener("mouseleave",this.Mo),this.io=!1,this.Ju=En(t),this.uo&&(this.uo(),this.uo=null);var n=this.Ho.bind(this),s=this.bo.bind(this);if(this.uo=function(){i.removeEventListener("mousemove",n),i.removeEventListener("mouseup",s)},i.addEventListener("mousemove",n),i.addEventListener("mouseup",s),this.vo=!0,!this.po(t)){var h=this.yo(t);this.Do(h,this.So.na),this.Uu||(this.qu=0,this.Uu=setTimeout(this.Bo.bind(this),500),this.Hu=En(t))}}},t.prototype.Eo=function(){var t=this;this.Lo.addEventListener("mouseenter",this.Oo.bind(this)),this.Lo.addEventListener("touchcancel",this.Fo.bind(this));var i=this.Lo.ownerDocument,n=function(i){t.So.sa&&(i.target&&t.Lo.contains(i.target)||t.So.sa())};this.ho=function(){i.removeEventListener("touchstart",n)},this.so=function(){i.removeEventListener("mousedown",n)},i.addEventListener("mousedown",n),i.addEventListener("touchstart",n,{passive:!0}),Tn()&&(this.ro=function(){t.Lo.removeEventListener("dblclick",t.mo)},this.Lo.addEventListener("dblclick",this.mo)),this.Lo.addEventListener("mouseleave",this.ha.bind(this)),this.Lo.addEventListener("touchstart",this.Go.bind(this),{passive:!0}),Dn(this.Lo),this.Lo.addEventListener("mousedown",this.ia.bind(this)),this.ra(),this.Lo.addEventListener("touchmove",(function(){}),{passive:!1})},t.prototype.ra=function(){var t=this;void 0===this.So.ea&&void 0===this.So.ua&&void 0===this.So.oa||(this.Lo.addEventListener("touchstart",(function(i){return t.aa(i.touches)}),{passive:!0}),this.Lo.addEventListener("touchmove",(function(i){if(2===i.touches.length&&null!==t.ao&&void 0!==t.So.ua){var n=Bn(i.touches[0],i.touches[1])/t.lo;t.So.ua(t.ao,n),Ln(i)}}),{passive:!1}),this.Lo.addEventListener("touchend",(function(i){t.aa(i.touches)})))},t.prototype.aa=function(t){1===t.length&&(this.fo=!1),2!==t.length||this.fo||this.Zu?this.la():this.fa(t)},t.prototype.fa=function(t){var i=this.Lo.getBoundingClientRect()||{left:0,top:0};this.ao={X:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,Z:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.lo=Bn(t[0],t[1]),void 0!==this.So.ea&&this.So.ea(),this.Fo()},t.prototype.la=function(){null!==this.ao&&(this.ao=null,void 0!==this.So.oa&&this.So.oa())},t.prototype.ha=function(t){if(this.eo&&this.eo(),!this.po(t)&&this.wo){var i=this.yo(t);this.Do(i,this.So.ca),this.wo=!Tn()}},t.prototype.Qo=function(t){var i=On(t.touches,u(this._o));if(null!==i){var n=this.yo(t,i);this.No(n,this.So.va),this.no=!0,this.Zu=!0}},t.prototype.po=function(t){return t.sourceCapabilities&&void 0!==t.sourceCapabilities.firesTouchEvents?t.sourceCapabilities.firesTouchEvents:Fn(t)<this.do+500},t.prototype.No=function(t,i){i&&i.call(this.So,t)},t.prototype.Do=function(t,i){i&&i.call(this.So,t)},t.prototype.yo=function(t,i){var n=i||t,s=this.Lo.getBoundingClientRect()||{left:0,top:0};return{da:n.clientX,_a:n.clientY,wa:n.pageX,Ma:n.pageY,ba:n.screenX,ma:n.screenY,pa:n.clientX-s.left,ga:n.clientY-s.top,ya:t.ctrlKey,ka:t.altKey,xa:t.shiftKey,Na:t.metaKey,Ca:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,Sa:t.type,Ta:n.target,Da:t.view,Aa:function(){"touchstart"!==t.type&&Ln(t)}}},t}();function Bn(t,i){var n=t.clientX-i.clientX,s=t.clientY-i.clientY;return Math.sqrt(n*n+s*s)}function Ln(t){t.cancelable&&t.preventDefault()}function En(t){return{X:t.pageX,Z:t.pageY}}function Fn(t){return t.timeStamp||performance.now()}function On(t,i){for(var n=0;n<t.length;++n)if(t[n].identifier===i)return t[n];return null}var Vn=function(){function t(t,i,n,s){this.fn=new Rt(200),this.g=0,this.Ba="",this.qn="",this.un=[],this.La=new Map,this.g=t,this.Ba=i,this.qn=L(t,n,s)}return t.prototype.destroy=function(){this.fn.reset(),this.un=[],this.La.clear()},t.prototype.Ea=function(t,i,n,s,h){var r=this.Fa(t,i);if("left"!==h){var e=mn(t.canvas);n-=Math.floor(r.Oa*e)}s-=Math.floor(r._n/2),t.drawImage(r.Va,n,s,r.wn,r._n)},t.prototype.Fa=function(t,i){var n,s=this;if(this.La.has(i))n=e(this.La.get(i));else{if(this.un.length>=200){var h=e(this.un.shift());this.La.delete(h)}var r=mn(t.canvas),u=Math.ceil(this.g/4.5),o=Math.round(this.g/10),a=Math.ceil(this.fn.measureText(t,i)),l=St(Math.round(a+2*u)),f=St(this.g+2*u),c=gn(document,new bn(l,f));n={Yn:i,Oa:Math.round(Math.max(1,a)),wn:Math.ceil(l*r),_n:Math.ceil(f*r),Va:c},0!==a&&(this.un.push(n.Yn),this.La.set(n.Yn,n)),q(t=pn(n.Va),r,(function(){t.font=s.qn,t.fillStyle=s.Ba,t.fillText(i,0,f-u-o)}))}return n},t}(),Pn=function(){function t(t,i,n,s){var h=this;this.wt=null,this.Pa=null,this.Wa=!1,this.za=null,this.Ra="",this.Ia=new Rt(50),this.ja=new Vn(11,"#000"),this.Ba=null,this.qn=null,this.qa=0,this.Ua=!1,this.Ha=function(){h.Ya(h.vu.options()),h.Ua||h.Nt.Ka().$a().lightUpdate()},this.Xa=function(){h.Ua||h.Nt.Ka().$a().lightUpdate()},this.Nt=t,this.Ot=i,this.vu=n,this.Za="left"===s,this.Ja=document.createElement("div"),this.Ja.style.height="100%",this.Ja.style.overflow="hidden",this.Ja.style.width="25px",this.Ja.style.left="0",this.Ja.style.position="relative",this.Ga=yn(this.Ja,new bn(16,16)),this.Ga.subscribeCanvasConfigured(this.Ha);var r=this.Ga.canvas;r.style.position="absolute",r.style.zIndex="1",r.style.left="0",r.style.top="0",this.Qa=yn(this.Ja,new bn(16,16)),this.Qa.subscribeCanvasConfigured(this.Xa);var e=this.Qa.canvas;e.style.position="absolute",e.style.zIndex="2",e.style.left="0",e.style.top="0";var u={Wo:this.tl.bind(this),na:this.il.bind(this),ta:this.il.bind(this),Yo:this.nl.bind(this),Uo:this.nl.bind(this),sa:this.sl.bind(this),Zo:this.hl.bind(this),Ko:this.hl.bind(this),Ao:this.rl.bind(this),Co:this.rl.bind(this),Po:this.el.bind(this),ca:this.ul.bind(this)};this.ol=new An(this.Qa.canvas,u,{jo:function(){return!1},qo:function(){return!0}})}return t.prototype.destroy=function(){this.ol.destroy(),this.Qa.unsubscribeCanvasConfigured(this.Xa),this.Qa.destroy(),this.Ga.unsubscribeCanvasConfigured(this.Ha),this.Ga.destroy(),null!==this.wt&&this.wt.onMarksChanged().unsubscribeAll(this),this.wt=null,this.ja.destroy()},t.prototype.al=function(){return this.Ja},t.prototype.P=function(){return u(this.wt).options().borderColor},t.prototype.ll=function(){return this.Ot.textColor},t.prototype.fl=function(){return this.Ot.fontSize},t.prototype.cl=function(){return L(this.fl(),this.Ot.fontFamily)},t.prototype.vl=function(){var t=this.vu.options(),i=this.Ba!==t.color,n=this.qn!==t.font;return(i||n)&&(this.Ya(t),this.Ba=t.color),n&&(this.Ia.reset(),this.qn=t.font),t},t.prototype.dl=function(){if(null===this.wt)return 0;var t=0,i=this.vl(),n=pn(this.Ga.canvas),s=this.wt.marks();n.font=this.cl(),s.length>0&&(t=Math.max(this.Ia.measureText(n,s[0].label),this.Ia.measureText(n,s[s.length-1].label)));for(var h=this._l(),r=h.length;r--;){var e=this.Ia.measureText(n,h[r].text());e>t&&(t=e)}var u=this.wt.firstValue();if(null!==u&&null!==this.Pa){var o=this.wt.coordinateToPrice(1,u),a=this.wt.coordinateToPrice(this.Pa.G-2,u);t=Math.max(t,this.Ia.measureText(n,this.wt.formatPrice(Math.floor(Math.min(o,a))+.11111111111111,u)),this.Ia.measureText(n,this.wt.formatPrice(Math.ceil(Math.max(o,a))-.11111111111111,u)))}var l=t||34,f=Math.ceil(i.borderSize+i.tickLength+i.paddingInner+i.paddingOuter+l);return f+=f%2},t.prototype.wl=function(t){if(t.J<0||t.G<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this.Pa&&this.Pa.xu(t)||(this.Pa=t,this.Ua=!0,this.Ga.resizeCanvas({width:t.J,height:t.G}),this.Qa.resizeCanvas({width:t.J,height:t.G}),this.Ua=!1,this.Ja.style.width=t.J+"px",this.Ja.style.height=t.G+"px",this.Ja.style.minWidth=t.J+"px")},t.prototype.Ml=function(){return u(this.Pa).J},t.prototype.bl=function(t){this.wt!==t&&(null!==this.wt&&this.wt.onMarksChanged().unsubscribeAll(this),this.wt=t,t.onMarksChanged().subscribe(this.Uh.bind(this),this))},t.prototype.ml=function(){return this.wt},t.prototype.pl=function(){var t=this.Nt.gl();this.Nt.Ka().$a().resetPriceScale(t,u(this.ml()))},t.prototype.yl=function(t){if(null!==this.Pa){if(1!==t){var i=pn(this.Ga.canvas);this.kl(),this.xl(i,this.Ga.pixelRatio),this.Hi(i,this.Ga.pixelRatio),this.Nl(i,this.Ga.pixelRatio),this.Cl(i,this.Ga.pixelRatio)}var n=pn(this.Qa.canvas),s=this.Pa.J,h=this.Pa.G;q(n,this.Qa.pixelRatio,(function(){n.clearRect(0,0,s,h)})),this.Sl(n,this.Qa.pixelRatio)}},t.prototype.Tl=function(){return this.Ga.canvas},t.prototype.et=function(){var t;null===(t=this.wt)||void 0===t||t.marks()},t.prototype.Dl=function(){for(var t=[],i=0,n=this.Nt.gl().orderedSources();i<n.length;i++){var s=n[i];s instanceof xi&&t.push.apply(t,s.customPriceLines().filter((function(t){return t.options().draggable&&t.priceAxisView().isAxisLabelVisible()})))}return t},t.prototype.Al=function(t){for(var i=this.vl(),n=0,s=this.Dl();n<s.length;n++){var h=s[n],r=h.priceAxisView(),e=r.height(i,!1),u=r.getFixedCoordinate();if(u-e/2<=t&&t<=u+e/2)return h}return null},t.prototype.tl=function(t){null!==this.Al(t.ga)?this.Bl(2):this.Bl(1)},t.prototype.il=function(t){if(null!==this.wt&&!this.wt.isEmpty()){this.Wa=!0;var i=this.Al(t.ga);if(i){this.za=i;var n=i.options().price,s=u(this.wt.firstValue());return this.Ra=this.wt.formatPrice(n,s),void this.Bl(3)}if(this.Nt.Ka().Ll().handleScale.axisPressedMouseMove.price){var h=this.Nt.Ka().$a(),r=this.Nt.gl();h.startScalePrice(r,this.wt,t.ga)}}},t.prototype.nl=function(t){if(null!==this.wt){var i=this.wt;if(this.za){var n=u(i.firstValue()),s=i.coordinateToPrice(t.ga,n);this.za.applyOptions({price:s})}else if(this.Nt.Ka().Ll().handleScale.axisPressedMouseMove.price){var h=this.Nt.Ka().$a(),r=this.Nt.gl();h.scalePriceTo(r,i,t.ga)}}},t.prototype.sl=function(){if(null!==this.wt&&this.Wa){if(this.Wa=!1,this.za=null,this.Ra="",!this.Nt.Ka().Ll().handleScale.axisPressedMouseMove.price)return;var t=this.Nt.Ka().$a(),i=this.Nt.gl(),n=this.wt;t.endScalePrice(i,n)}},t.prototype.hl=function(t){if(null!==this.wt){var i=this.Nt.Ka().$a();if(this.Wa=!1,this.za)return i.fireCustomPriceLineDragged(this.za,this.Ra),this.za=null,this.Ra="",void this.Bl(2);if(this.Nt.Ka().Ll().handleScale.axisPressedMouseMove.price){var n=this.Nt.gl();i.endScalePrice(n,this.wt)}}},t.prototype.rl=function(t){null===this.Al(t.ga)&&this.Nt.Ka().Ll().handleScale.axisDoubleClickReset&&this.pl()},t.prototype.el=function(t){null!==this.wt&&(null===this.za?null===this.Al(t.ga)?!this.Nt.Ka().$a().options().handleScale.axisPressedMouseMove.price||this.wt.isPercentage()||this.wt.isIndexedTo100()||this.Bl(1):this.Bl(2):this.Bl(3))},t.prototype.ul=function(t){this.Bl(0)},t.prototype._l=function(){var t=this,i=[],n=null===this.wt?void 0:this.wt;return function(s){for(var h=0;h<s.length;++h)for(var r=s[h].priceAxisViews(t.Nt.gl(),n),e=0;e<r.length;e++)i.push(r[e])}(this.Nt.gl().orderedSources()),i},t.prototype.xl=function(t,i){var n=this;if(null!==this.Pa){var s=this.Pa.J,h=this.Pa.G;q(t,i,(function(){var i=n.Nt.gl().model(),r=i.backgroundTopColor(),e=i.backgroundBottomColor();r===e?U(t,0,0,s,h,r):H(t,0,0,s,h,r,e)}))}},t.prototype.Hi=function(t,i){if(null!==this.Pa&&null!==this.wt&&this.wt.options().borderVisible){t.save(),t.fillStyle=this.P();var n,s=Math.max(1,Math.floor(this.vl().borderSize*i));n=this.Za?Math.floor(this.Pa.J*i)-s:0,t.fillRect(n,0,s,Math.ceil(this.Pa.G*i)),t.restore()}},t.prototype.Nl=function(t,i){if(null!==this.Pa&&null!==this.wt){var n=this.wt.marks();t.save(),t.strokeStyle=this.P(),t.font=this.cl(),t.fillStyle=this.P();var s=this.vl(),h=this.wt.options().borderVisible&&this.wt.options().drawTicks,r=this.Za?Math.floor((this.Pa.J-s.tickLength)*i-s.borderSize*i):Math.floor(s.borderSize*i),e=this.Za?Math.round(r-s.paddingInner*i):Math.round(r+s.tickLength*i+s.paddingInner*i),u=this.Za?"right":"left",o=Math.max(1,Math.floor(i)),a=Math.floor(.5*i);if(h){var l=Math.round(s.tickLength*i);t.beginPath();for(var f=0,c=n;f<c.length;f++){var v=c[f];t.rect(r,Math.round(v.coord*i)-a,l,o)}t.fill()}t.fillStyle=this.ll();for(var d=0,_=n;d<_.length;d++){v=_[d];this.ja.Ea(t,v.label,e,Math.round(v.coord*i),u)}t.restore()}},t.prototype.kl=function(){if(null!==this.Pa&&null!==this.wt){var t=this.Pa.G/2,i=[],n=this.wt.orderedSources().slice(),s=this.Nt.gl(),h=this.vl();this.wt===s.defaultVisiblePriceScale()&&this.Nt.gl().orderedSources().forEach((function(t){s.isOverlay(t)&&n.push(t)}));var r=this.wt.dataSources()[0],e=this.wt;n.forEach((function(n){var h=n.priceAxisViews(s,e);h.forEach((function(t){t.setFixedCoordinate(null),t.isVisible()&&i.push(t)})),r===n&&h.length>0&&(t=h[0].coordinate())}));var u=i.filter((function(i){return i.coordinate()<=t})),o=i.filter((function(i){return i.coordinate()>t}));if(u.sort((function(t,i){return i.coordinate()-t.coordinate()})),u.length&&o.length&&o.push(u[0]),o.sort((function(t,i){return t.coordinate()-i.coordinate()})),i.forEach((function(t){return t.setFixedCoordinate(t.coordinate())})),this.wt.options().alignLabels){for(var a=1;a<u.length;a++){var l=u[a],f=(v=u[a-1]).height(h,!1);l.coordinate()>(d=v.getFixedCoordinate())-f&&l.setFixedCoordinate(d-f)}for(var c=1;c<o.length;c++){var v,d;l=o[c],f=(v=o[c-1]).height(h,!0);l.coordinate()<(d=v.getFixedCoordinate())+f&&l.setFixedCoordinate(d+f)}}}},t.prototype.Cl=function(t,i){var n=this;if(null!==this.Pa){t.save();var s=this.Pa,h=this._l(),r=this.vl(),e=this.Za?"right":"left";h.forEach((function(h){if(h.isAxisLabelVisible()){var o=h.renderer(u(n.wt));t.save(),o.draw(t,r,n.Ia,s.J,e,i),t.restore()}})),t.restore()}},t.prototype.Sl=function(t,i){var n=this;if(null!==this.Pa&&null!==this.wt){t.save();var s=this.Pa,h=this.Nt.Ka().$a(),r=[],e=this.Nt.gl(),o=h.crosshairSource().priceAxisViews(e,this.wt);o.length&&r.push(o);var a=this.vl(),l=this.Za?"right":"left";r.forEach((function(h){h.forEach((function(h){t.save(),h.renderer(u(n.wt)).draw(t,a,n.Ia,s.J,l,i),t.restore()}))})),t.restore()}},t.prototype.Bl=function(t){var i="default";1===t?i="ns-resize":2===t?i="grab":3===t&&(i="grabbing"),this.Ja.style.cursor=i},t.prototype.Uh=function(){var t=this.dl();this.qa<t&&this.Nt.Ka().$a().fullUpdate(),this.qa=t},t.prototype.Ya=function(t){this.ja.destroy(),this.ja=new Vn(t.fontSize,t.color,t.fontFamily)},t}();function Wn(t,i,n,s,h){t.drawBackground&&t.drawBackground(i,n,s,h)}function zn(t,i,n,s,h){t.draw(i,n,s,h)}function Rn(t,i){return t.paneViews(i)}function In(t,i){return void 0!==t.topPaneViews?t.topPaneViews(i):[]}var jn=function(){function t(t,i){var n=this;this.Pa=new bn(0,0),this.El=null,this.Fl=null,this.Ol=null,this.Vl=!1,this.Pl=new y,this.Wl=0,this.zl=!1,this.Rl=null,this.Il=!1,this.jl=null,this.ql=null,this.Ua=!1,this.Ha=function(){n.Ua||null===n.Ul||n.yt().lightUpdate()},this.Xa=function(){n.Ua||null===n.Ul||n.yt().lightUpdate()},this.Hl=t,this.Ul=i,this.Ul.onDestroyed().subscribe(this.Yl.bind(this),this,!0),this.$l=document.createElement("td"),this.$l.style.padding="0",this.$l.style.position="relative";var s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",this.Kl=document.createElement("td"),this.Kl.style.padding="0",this.Xl=document.createElement("td"),this.Xl.style.padding="0",this.$l.appendChild(s),this.Ga=yn(s,new bn(16,16)),this.Ga.subscribeCanvasConfigured(this.Ha);var h=this.Ga.canvas;h.style.position="absolute",h.style.zIndex="1",h.style.left="0",h.style.top="0",this.Qa=yn(s,new bn(16,16)),this.Qa.subscribeCanvasConfigured(this.Xa);var r=this.Qa.canvas;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0",this.Zl=document.createElement("tr"),this.Zl.appendChild(this.Kl),this.Zl.appendChild(this.$l),this.Zl.appendChild(this.Xl),this.Jl(),this.ol=new An(this.Qa.canvas,this,{jo:function(){return null===n.Rl&&!n.Hl.Ll().handleScroll.vertTouchDrag},qo:function(){return null===n.Rl&&!n.Hl.Ll().handleScroll.horzTouchDrag}})}return t.prototype.destroy=function(){null!==this.El&&this.El.destroy(),null!==this.Fl&&this.Fl.destroy(),this.Qa.unsubscribeCanvasConfigured(this.Xa),this.Qa.destroy(),this.Ga.unsubscribeCanvasConfigured(this.Ha),this.Ga.destroy(),null!==this.Ul&&this.Ul.onDestroyed().unsubscribeAll(this),this.ol.destroy()},t.prototype.gl=function(){return u(this.Ul)},t.prototype.Gl=function(i){null!==this.Ul&&this.Ul.onDestroyed().unsubscribeAll(this),this.Ul=i,null!==this.Ul&&this.Ul.onDestroyed().subscribe(t.prototype.Yl.bind(this),this,!0),this.Jl()},t.prototype.Ka=function(){return this.Hl},t.prototype.al=function(){return this.Zl},t.prototype.Jl=function(){if(null!==this.Ul&&(this.Ql(),0!==this.yt().serieses().length)){if(null!==this.El){var t=this.Ul.leftPriceScale();this.El.bl(u(t))}if(null!==this.Fl){var i=this.Ul.rightPriceScale();this.Fl.bl(u(i))}}},t.prototype.tf=function(){null!==this.El&&this.El.et(),null!==this.Fl&&this.Fl.et()},t.prototype.if=function(){return null!==this.Ul?this.Ul.stretchFactor():0},t.prototype.nf=function(t){this.Ul&&this.Ul.setStretchFactor(t)},t.prototype.Po=function(t){if(this.Ul){this.sf();var i=t.pa,n=t.ga;this.hf(i,n)}},t.prototype.na=function(t){this.sf(),this.rf(),this.hf(t.pa,t.ga)},t.prototype.Wo=function(t){if(this.Ul){this.sf();var i=t.pa,n=t.ga;this.hf(i,n);var s=this.ef(i,n);this.yt().setHoveredSource(s&&{source:s.uf,object:s.af})}},t.prototype.Jo=function(t){if(null!==this.Ul){this.sf();var i=t.pa,n=t.ga;if(this.Pl._()){var s=this.yt().crosshairSource().appliedIndex();this.Pl.v(s,{x:i,y:n})}}},t.prototype.Yo=function(t){this.sf(),this.lf(t),this.hf(t.pa,t.ga)},t.prototype.Zo=function(t){null!==this.Ul&&(this.sf(),this.zl=!1,this.ff(t))},t.prototype.va=function(t){if(this.zl=!0,null===this.Rl){var i={x:t.pa,y:t.ga};this.cf(i,i)}},t.prototype.ca=function(t){null!==this.Ul&&(this.sf(),this.Ul.model().setHoveredSource(null),this.vf())},t.prototype.df=function(){return this.Pl},t.prototype.ea=function(){this.Wl=1,this._f()},t.prototype.ua=function(t,i){if(this.Hl.Ll().handleScale.pinch){var n=5*(i-this.Wl);this.Wl=i,this.yt().zoomTime(t.X,n)}},t.prototype.ta=function(t){if(this.zl=!1,this.Il=null!==this.Rl,this.rf(),null!==this.Rl){var i=this.yt().crosshairSource();this.jl={x:i.appliedX(),y:i.appliedY()},this.Rl={x:t.pa,y:t.ga}}},t.prototype.Uo=function(t){if(null!==this.Ul){var i=t.pa,n=t.ga;if(null===this.Rl)this.lf(t);else{this.Il=!1;var s=u(this.jl),h=s.x+(i-this.Rl.x),r=s.y+(n-this.Rl.y);this.hf(h,r)}}},t.prototype.Ko=function(t){0===this.Ka().Ll().trackingMode.exitMode&&(this.Il=!0),this.wf(),this.ff(t)},t.prototype.ef=function(t,i){var n=this.Ul;if(null===n)return null;for(var s=0,h=n.orderedSources();s<h.length;s++){var r=h[s],e=this.Mf(r.paneViews(n),t,i);if(null!==e)return{uf:r,Da:e.Da,af:e.af}}return null},t.prototype.bf=function(t,i){u("left"===i?this.El:this.Fl).wl(new bn(t,this.Pa.G))},t.prototype.mf=function(){return this.Pa},t.prototype.wl=function(t){if(t.J<0||t.G<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(t));this.Pa.xu(t)||(this.Pa=t,this.Ua=!0,this.Ga.resizeCanvas({width:t.J,height:t.G}),this.Qa.resizeCanvas({width:t.J,height:t.G}),this.Ua=!1,this.$l.style.width=t.J+"px",this.$l.style.height=t.G+"px")},t.prototype.pf=function(){var t=u(this.Ul);t.recalculatePriceScale(t.leftPriceScale()),t.recalculatePriceScale(t.rightPriceScale());for(var i=0,n=t.dataSources();i<n.length;i++){var s=n[i];if(t.isOverlay(s)){var h=s.priceScale();null!==h&&t.recalculatePriceScale(h),s.updateAllViews()}}},t.prototype.Tl=function(){return this.Ga.canvas},t.prototype.yl=function(t){if(0!==t&&null!==this.Ul){if(t>1&&this.pf(),null!==this.El&&this.El.yl(t),null!==this.Fl&&this.Fl.yl(t),1!==t){var i=pn(this.Ga.canvas);i.save(),this.xl(i,this.Ga.pixelRatio),this.Ul&&(this.gf(i,this.Ga.pixelRatio),this.yf(i,this.Ga.pixelRatio),this.kf(i,this.Ga.pixelRatio,Rn)),i.restore()}var n=pn(this.Qa.canvas);n.clearRect(0,0,Math.ceil(this.Pa.J*this.Qa.pixelRatio),Math.ceil(this.Pa.G*this.Qa.pixelRatio)),this.kf(n,this.Ga.pixelRatio,In),this.xf(n,this.Qa.pixelRatio)}},t.prototype.Nf=function(){return this.El},t.prototype.Cf=function(){return this.Fl},t.prototype.Yl=function(){null!==this.Ul&&this.Ul.onDestroyed().unsubscribeAll(this),this.Ul=null},t.prototype.xl=function(t,i){var n=this;q(t,i,(function(){var i=n.yt(),s=i.backgroundTopColor(),h=i.backgroundBottomColor();s===h?U(t,0,0,n.Pa.J,n.Pa.G,h):H(t,0,0,n.Pa.J,n.Pa.G,s,h)}))},t.prototype.gf=function(t,i){var n=u(this.Ul),s=n.grid().paneView().renderer(n.height(),n.width());null!==s&&(t.save(),s.draw(t,i,!1),t.restore())},t.prototype.yf=function(t,i){var n=this.yt().watermarkSource();this.Sf(t,i,Rn,Wn,n),this.Sf(t,i,Rn,zn,n)},t.prototype.xf=function(t,i){this.Sf(t,i,Rn,zn,this.yt().crosshairSource())},t.prototype.kf=function(t,i,n){for(var s=u(this.Ul).orderedSources(),h=0,r=s;h<r.length;h++){var e=r[h];this.Sf(t,i,n,Wn,e)}for(var o=0,a=s;o<a.length;o++){e=a[o];this.Sf(t,i,n,zn,e)}},t.prototype.Sf=function(t,i,n,s,h){for(var r=u(this.Ul),e=n(h,r),o=r.height(),a=r.width(),l=r.model().hoveredSource(),f=null!==l&&l.source===h,c=null!==l&&f&&void 0!==l.object?l.object.hitTestData:void 0,v=0,d=e;v<d.length;v++){var _=d[v].renderer(o,a);null!==_&&(t.save(),s(_,t,i,f,c),t.restore())}},t.prototype.Mf=function(t,i,n){for(var s=0,h=t;s<h.length;s++){var r=h[s],e=r.renderer(this.Pa.G,this.Pa.J);if(null!==e&&e.hitTest){var u=e.hitTest(i,n);if(null!==u)return{Da:r,af:u}}}return null},t.prototype.Ql=function(){if(null!==this.Ul){var t=this.Hl,i=this.Ul.leftPriceScale().options().visible,n=this.Ul.rightPriceScale().options().visible;i||null===this.El||(this.Kl.removeChild(this.El.al()),this.El.destroy(),this.El=null),n||null===this.Fl||(this.Xl.removeChild(this.Fl.al()),this.Fl.destroy(),this.Fl=null);var s=t.$a().rendererOptionsProvider();i&&null===this.El&&(this.El=new Pn(this,t.Ll().layout,s,"left"),this.Kl.appendChild(this.El.al())),n&&null===this.Fl&&(this.Fl=new Pn(this,t.Ll().layout,s,"right"),this.Xl.appendChild(this.Fl.al()))}},t.prototype.Tf=function(t){return t.Ca&&this.zl||null!==this.Rl},t.prototype.Df=function(t){return Math.max(0,Math.min(t,this.Pa.J-1))},t.prototype.Af=function(t){return Math.max(0,Math.min(t,this.Pa.G-1))},t.prototype.hf=function(t,i){this.yt().setAndSaveCurrentPosition(this.Df(t),this.Af(i),u(this.Ul))},t.prototype.vf=function(){this.yt().clearCurrentPosition()},t.prototype.wf=function(){this.Il&&(this.Rl=null,this.vf())},t.prototype.cf=function(t,i){this.Rl=t,this.Il=!1,this.hf(i.x,i.y);var n=this.yt().crosshairSource();this.jl={x:n.appliedX(),y:n.appliedY()}},t.prototype.yt=function(){return this.Hl.$a()},t.prototype.Bf=function(){var t=this.yt(),i=this.gl(),n=i.defaultPriceScale();t.endScrollPrice(i,n),t.endScrollTime(),this.Ol=null,this.Vl=!1},t.prototype.ff=function(t){var i=this;if(this.Vl){var n=performance.now();if(null!==this.ql&&this.ql.Nn(t.pa,n),null===this.ql||this.ql.zu(n))this.Bf();else{var s=this.yt(),h=s.timeScale(),r=this.ql,e=function(){if(!r.Iu()){var t=performance.now(),n=r.zu(t);if(!r.Iu()){var u=h.rightOffset();s.scrollTimeTo(r.Wu(t)),u===h.rightOffset()&&(n=!0,i.ql=null)}n?i.Bf():requestAnimationFrame(e)}};requestAnimationFrame(e)}}},t.prototype.sf=function(){this.Rl=null},t.prototype.rf=function(){if(this.Ul){if(this._f(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)u(document.activeElement).blur();else{var t=document.getSelection();null!==t&&t.removeAllRanges()}!this.Ul.defaultPriceScale().isEmpty()&&this.yt().timeScale().isEmpty()}},t.prototype.lf=function(t){if(null!==this.Ul){var i=this.yt();if(!i.timeScale().isEmpty()){var n=this.Hl.Ll(),s=n.handleScroll,h=n.kineticScroll;if(s.pressedMouseMove&&!t.Ca||(s.horzTouchDrag||s.vertTouchDrag)&&t.Ca){var r=this.Ul.defaultPriceScale(),e=performance.now();null!==this.Ol||this.Tf(t)||(this.Ol={x:t.da,y:t._a,Lf:e,pa:t.pa,ga:t.ga}),null!==this.ql&&this.ql.Pu(t.pa,e),null===this.Ol||this.Vl||this.Ol.x===t.da&&this.Ol.y===t._a||(null===this.ql&&(t.Ca&&h.touch||!t.Ca&&h.mouse)&&(this.ql=new Nn(.2,7,.997,15),this.ql.Pu(this.Ol.pa,this.Ol.Lf),this.ql.Pu(t.pa,e)),r.isEmpty()||i.startScrollPrice(this.Ul,r,t.ga),i.startScrollTime(t.pa),this.Vl=!0),this.Vl&&(r.isEmpty()||i.scrollPriceTo(this.Ul,r,t.ga),i.scrollTimeTo(t.pa))}}}},t.prototype._f=function(){var t=performance.now(),i=null===this.ql||this.ql.zu(t);null!==this.ql&&(i||this.Bf()),null!==this.ql&&(this.ql.ju(),this.ql=null)},t}(),qn=function(){function t(t,i,n,s,h){var r=this;this.j=!0,this.Pa=new bn(0,0),this.Ha=function(){return r.yl(3)},this.Za="left"===t,this.vu=n.Ef,this.Ot=i,this.Ff=s,this.Of=h,this.Ja=document.createElement("div"),this.Ja.style.width="25px",this.Ja.style.height="100%",this.Ja.style.overflow="hidden",this.Ga=yn(this.Ja,new bn(16,16)),this.Ga.subscribeCanvasConfigured(this.Ha)}return t.prototype.destroy=function(){this.Ga.unsubscribeCanvasConfigured(this.Ha),this.Ga.destroy()},t.prototype.al=function(){return this.Ja},t.prototype.mf=function(){return this.Pa},t.prototype.wl=function(t){if(t.J<0||t.G<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this.Pa.xu(t)||(this.Pa=t,this.Ga.resizeCanvas({width:t.J,height:t.G}),this.Ja.style.width="".concat(t.J,"px"),this.Ja.style.minWidth="".concat(t.J,"px"),this.Ja.style.height="".concat(t.G,"px"),this.j=!0)},t.prototype.yl=function(t){if((!(t<3)||this.j)&&0!==this.Pa.J&&0!==this.Pa.G){this.j=!1;var i=pn(this.Ga.canvas);this.xl(i,this.Ga.pixelRatio),this.Hi(i,this.Ga.pixelRatio)}},t.prototype.Tl=function(){return this.Ga.canvas},t.prototype.Hi=function(t,i){if(this.Ff()){var n=this.Pa.J;t.save(),t.fillStyle=this.Ot.timeScale.borderColor;var s=Math.floor(this.vu.options().borderSize*i),h=this.Za?Math.round(n*i)-s:0;t.fillRect(h,0,s,s),t.restore()}},t.prototype.xl=function(t,i){var n=this;q(t,i,(function(){U(t,0,0,n.Pa.J,n.Pa.G,n.Of())}))},t}();function Un(t,i){return t.weight>i.weight?t:i}var Hn=function(){function t(t){var i=this;this.Vf=null,this.Pf=null,this.m=null,this.Wf=!1,this.Pa=new bn(0,0),this.zf=new y,this.Ia=new Rt(5),this.Ua=!1,this.Ha=function(){i.Ua||i.Hl.$a().lightUpdate()},this.Xa=function(){i.Ua||i.Hl.$a().lightUpdate()},this.Hl=t,this.Ot=t.Ll().layout,this.Rf=document.createElement("tr"),this.If=document.createElement("td"),this.If.style.padding="0",this.jf=document.createElement("td"),this.jf.style.padding="0",this.Ja=document.createElement("td"),this.Ja.style.height="25px",this.Ja.style.padding="0",this.qf=document.createElement("div"),this.qf.style.width="100%",this.qf.style.height="100%",this.qf.style.position="relative",this.qf.style.overflow="hidden",this.Ja.appendChild(this.qf),this.Ga=yn(this.qf,new bn(16,16)),this.Ga.subscribeCanvasConfigured(this.Ha);var n=this.Ga.canvas;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this.Qa=yn(this.qf,new bn(16,16)),this.Qa.subscribeCanvasConfigured(this.Xa);var s=this.Qa.canvas;s.style.position="absolute",s.style.zIndex="2",s.style.left="0",s.style.top="0",this.Rf.appendChild(this.If),this.Rf.appendChild(this.Ja),this.Rf.appendChild(this.jf),this.Uf(),this.Hl.$a().priceScalesOptionsChanged().subscribe(this.Uf.bind(this),this),this.ol=new An(this.Qa.canvas,this,{jo:function(){return!0},qo:function(){return!1}})}return t.prototype.destroy=function(){this.ol.destroy(),null!==this.Vf&&this.Vf.destroy(),null!==this.Pf&&this.Pf.destroy(),this.Qa.unsubscribeCanvasConfigured(this.Xa),this.Qa.destroy(),this.Ga.unsubscribeCanvasConfigured(this.Ha),this.Ga.destroy()},t.prototype.al=function(){return this.Rf},t.prototype.Hf=function(){return this.Vf},t.prototype.Yf=function(){return this.Pf},t.prototype.na=function(t){if(!this.Wf){this.Wf=!0;var i=this.Hl.$a();!i.timeScale().isEmpty()&&this.Hl.Ll().handleScale.axisPressedMouseMove.time&&i.startScaleTime(t.pa)}},t.prototype.ta=function(t){this.na(t)},t.prototype.sa=function(){var t=this.Hl.$a();!t.timeScale().isEmpty()&&this.Wf&&(this.Wf=!1,this.Hl.Ll().handleScale.axisPressedMouseMove.time&&t.endScaleTime())},t.prototype.Yo=function(t){var i=this.Hl.$a();!i.timeScale().isEmpty()&&this.Hl.Ll().handleScale.axisPressedMouseMove.time&&i.scaleTimeTo(t.pa)},t.prototype.Uo=function(t){this.Yo(t)},t.prototype.Zo=function(){this.Wf=!1;var t=this.Hl.$a();t.timeScale().isEmpty()&&!this.Hl.Ll().handleScale.axisPressedMouseMove.time||t.endScaleTime()},t.prototype.Ko=function(){this.Zo()},t.prototype.Ao=function(){this.Hl.Ll().handleScale.axisDoubleClickReset&&this.Hl.$a().resetTimeScale()},t.prototype.Co=function(){this.Ao()},t.prototype.Po=function(){this.Hl.$a().options().handleScale.axisPressedMouseMove.time&&this.Bl(1)},t.prototype.ca=function(){this.Bl(0)},t.prototype.mf=function(){return this.Pa},t.prototype.$f=function(){return this.zf},t.prototype.Kf=function(t,i,n){this.Pa&&this.Pa.xu(t)||(this.Pa=t,this.Ua=!0,this.Ga.resizeCanvas({width:t.J,height:t.G}),this.Qa.resizeCanvas({width:t.J,height:t.G}),this.Ua=!1,this.Ja.style.width=t.J+"px",this.Ja.style.height=t.G+"px",this.zf.v(t)),null!==this.Vf&&this.Vf.wl(new bn(i,t.G)),null!==this.Pf&&this.Pf.wl(new bn(n,t.G))},t.prototype.Xf=function(){var t=this.Zf();return Math.ceil(t.borderSize+t.tickLength+t.fontSize+t.paddingTop+t.paddingBottom)},t.prototype.et=function(){this.Hl.$a().timeScale().marks()},t.prototype.Tl=function(){return this.Ga.canvas},t.prototype.yl=function(t){if(0!==t){if(1!==t){var i=pn(this.Ga.canvas);this.xl(i,this.Ga.pixelRatio),this.Hi(i,this.Ga.pixelRatio),this.Nl(i,this.Ga.pixelRatio),null!==this.Vf&&this.Vf.yl(t),null!==this.Pf&&this.Pf.yl(t)}var n=pn(this.Qa.canvas),s=this.Qa.pixelRatio;n.clearRect(0,0,Math.ceil(this.Pa.J*s),Math.ceil(this.Pa.G*s)),this.Jf([this.Hl.$a().crosshairSource()],n,s)}},t.prototype.xl=function(t,i){var n=this;q(t,i,(function(){U(t,0,0,n.Pa.J,n.Pa.G,n.Hl.$a().backgroundBottomColor())}))},t.prototype.Hi=function(t,i){if(this.Hl.Ll().timeScale.borderVisible){t.save(),t.fillStyle=this.Gf();var n=Math.max(1,Math.floor(this.Zf().borderSize*i));t.fillRect(0,0,Math.ceil(this.Pa.J*i),n),t.restore()}},t.prototype.Nl=function(t,i){var n=this,s=this.Hl.$a().timeScale().marks();if(s&&0!==s.length){var h=s.reduce(Un,s[0]).weight;h>30&&h<50&&(h=30),t.save(),t.strokeStyle=this.Gf();var r=this.Zf(),e=r.borderSize+r.tickLength+r.paddingTop+r.fontSize-r.baselineOffset;t.textAlign="center",t.fillStyle=this.Gf();var u=Math.floor(this.Zf().borderSize*i),o=Math.max(1,Math.floor(i)),a=Math.floor(.5*i);if(this.Hl.$a().timeScale().options().borderVisible){t.beginPath();for(var l=Math.round(r.tickLength*i),f=s.length;f--;){var c=Math.round(s[f].coord*i);t.rect(c-a,u,o,l)}t.fill()}t.fillStyle=this.N(),q(t,i,(function(){t.font=n.Qf();for(var i=0,r=s;i<r.length;i++){if((l=r[i]).weight<h){var u=l.needAlignCoordinate?n.tc(t,l.coord,l.label):l.coord;t.fillText(l.label,u,e)}}t.font=n.ic();for(var o=0,a=s;o<a.length;o++){var l;if((l=a[o]).weight>=h){u=l.needAlignCoordinate?n.tc(t,l.coord,l.label):l.coord;t.fillText(l.label,u,e)}}})),t.restore()}},t.prototype.tc=function(t,i,n){var s=this.Ia.measureText(t,n),h=s/2,r=Math.floor(i-h)+.5;return r<0?i+=Math.abs(0-r):r+s>this.Pa.J&&(i-=Math.abs(this.Pa.J-(r+s))),i},t.prototype.Jf=function(t,i,n){for(var s=this.Zf(),h=0,r=t;h<r.length;h++)for(var e=0,u=r[h].timeAxisViews();e<u.length;e++){var o=u[e];i.save(),o.renderer().draw(i,s,n),i.restore()}},t.prototype.Gf=function(){return this.Hl.Ll().timeScale.borderColor},t.prototype.N=function(){return this.Ot.textColor},t.prototype.g=function(){return this.Ot.fontSize},t.prototype.Qf=function(){return L(this.g(),this.Ot.fontFamily)},t.prototype.ic=function(){return L(this.g(),this.Ot.fontFamily,"bold")},t.prototype.Zf=function(){null===this.m&&(this.m={borderSize:1,baselineOffset:NaN,paddingTop:NaN,paddingBottom:NaN,paddingHorizontal:NaN,tickLength:3,fontSize:NaN,font:"",widthCache:new Rt});var t=this.m,i=this.Qf();if(t.font!==i){var n=this.g();t.fontSize=n,t.font=i,t.paddingTop=Math.ceil(n/2.5),t.paddingBottom=t.paddingTop,t.paddingHorizontal=Math.ceil(n/2),t.baselineOffset=Math.round(this.g()/5),t.widthCache.reset()}return this.m},t.prototype.Bl=function(t){this.Ja.style.cursor=1===t?"ew-resize":"default"},t.prototype.Uf=function(){var t=this.Hl.$a(),i=t.options();i.leftPriceScale.visible||null===this.Vf||(this.If.removeChild(this.Vf.al()),this.Vf.destroy(),this.Vf=null),i.rightPriceScale.visible||null===this.Pf||(this.jf.removeChild(this.Pf.al()),this.Pf.destroy(),this.Pf=null);var n={Ef:this.Hl.$a().rendererOptionsProvider()},s=function(){return i.leftPriceScale.borderVisible&&t.timeScale().options().borderVisible},h=function(){return t.backgroundBottomColor()};i.leftPriceScale.visible&&null===this.Vf&&(this.Vf=new qn("left",i,n,s,h),this.If.appendChild(this.Vf.al())),i.rightPriceScale.visible&&null===this.Pf&&(this.Pf=new qn("right",i,n,s,h),this.jf.appendChild(this.Pf.al()))},t}(),Yn=function(){function t(t,i){var n;this.nc=[],this.sc=0,this.Vh=0,this.ln=0,this.hc=0,this.rc=0,this.ec=null,this.uc=!1,this.Pl=new y,this.au=new y,this.lu=new y,this.Ot=i,this.Rf=document.createElement("div"),this.Rf.classList.add("tv-lightweight-charts"),this.Rf.style.overflow="hidden",this.Rf.style.width="100%",this.Rf.style.height="100%",(n=this.Rf).style.userSelect="none",n.style.webkitUserSelect="none",n.style.msUserSelect="none",n.style.MozUserSelect="none",n.style.webkitTapHighlightColor="transparent",this.oc=document.createElement("table"),this.oc.setAttribute("cellspacing","0"),this.Rf.appendChild(this.oc),this.ac=this.lc.bind(this),this.Rf.addEventListener("wheel",this.ac,{passive:!1}),this.yt=new dn(this.cu.bind(this),this.Ot),this.$a().crosshairMoved().subscribe(this.fc.bind(this),this),this.$a().customPriceLineDragged().subscribe(this.cc.bind(this),this),this.vc=new Hn(this),this.oc.appendChild(this.vc.al());var s=this.Ot.width,h=this.Ot.height;if(0===s||0===h){var r=t.getBoundingClientRect();0===s&&(s=Math.floor(r.width),s-=s%2),0===h&&(h=Math.floor(r.height),h-=h%2)}this.dc(s,h),this._c(),t.appendChild(this.Rf),this.wc(),this.yt.timeScale().optionsApplied().subscribe(this.yt.fullUpdate.bind(this.yt),this),this.yt.priceScalesOptionsChanged().subscribe(this.yt.fullUpdate.bind(this.yt),this)}return t.prototype.$a=function(){return this.yt},t.prototype.Ll=function(){return this.Ot},t.prototype.Mc=function(){return this.nc},t.prototype.bc=function(){return this.vc},t.prototype.destroy=function(){this.Rf.removeEventListener("wheel",this.ac),0!==this.sc&&window.cancelAnimationFrame(this.sc),this.yt.crosshairMoved().unsubscribeAll(this),this.yt.customPriceLineDragged().unsubscribeAll(this),this.yt.timeScale().optionsApplied().unsubscribeAll(this),this.yt.priceScalesOptionsChanged().unsubscribeAll(this),this.yt.destroy();for(var t=0,i=this.nc;t<i.length;t++){var n=i[t];this.oc.removeChild(n.al()),n.df().unsubscribeAll(this),n.destroy()}this.nc=[],u(this.vc).destroy(),null!==this.Rf.parentElement&&this.Rf.parentElement.removeChild(this.Rf),this.au.M(),this.Pl.M()},t.prototype.dc=function(t,i,n){if(void 0===n&&(n=!1),this.Vh!==i||this.ln!==t){this.Vh=i,this.ln=t;var s=i+"px",h=t+"px";u(this.Rf).style.height=s,u(this.Rf).style.width=h,this.oc.style.height=s,this.oc.style.width=h,n?this.mc(new nt(3)):this.yt.fullUpdate()}},t.prototype.yl=function(t){void 0===t&&(t=new nt(3));for(var i=0;i<this.nc.length;i++)this.nc[i].yl(t.invalidateForPane(i).level);this.Ot.timeScale.visible&&this.vc.yl(t.fullInvalidation())},t.prototype.gc=function(t){this.yt.applyOptions(t),this.wc();var i=t.width||this.ln,n=t.height||this.Vh;this.dc(i,n)},t.prototype.df=function(){return this.Pl},t.prototype.yc=function(){return this.au},t.prototype.kc=function(){return this.lu},t.prototype.xc=function(){var t=this;null!==this.ec&&(this.mc(this.ec),this.ec=null);var i=this.nc[0],n=gn(document,new bn(this.ln,this.Vh)),s=pn(n),h=mn(n);return q(s,h,(function(){var n=0,h=0,r=function(i){for(var r=0;r<t.nc.length;r++){var e=t.nc[r],o=e.mf().G,a=u("left"===i?e.Nf():e.Cf()),l=a.Tl();s.drawImage(l,n,h,a.Ml(),o),h+=o}};t.Nc()&&(r("left"),n=u(i.Nf()).Ml()),h=0;for(var e=0;e<t.nc.length;e++){var o=t.nc[e],a=o.mf(),l=o.Tl();s.drawImage(l,n,h,a.J,a.G),h+=a.G}n+=i.mf().J,t.Cc()&&(h=0,r("right"));var f=function(i){var r=u("left"===i?t.vc.Hf():t.vc.Yf()),e=r.mf(),o=r.Tl();s.drawImage(o,n,h,e.J,e.G)};if(t.Ot.timeScale.visible){n=0,t.Nc()&&(f("left"),n=u(i.Nf()).Ml());var c=t.vc.mf();l=t.vc.Tl();s.drawImage(l,n,h,c.J,c.G),t.Cc()&&(n+=i.mf().J,f("right"),s.restore())}})),n},t.prototype.Sc=function(t){return"none"===t?0:("left"!==t||this.Nc())&&("right"!==t||this.Cc())?0===this.nc.length?0:u("left"===t?this.nc[0].Nf():this.nc[0].Cf()).Ml():0},t.prototype.Tc=function(){for(var t=0,i=0,n=0,s=0,h=this.nc;s<h.length;s++){var r=h[s];this.Nc()&&(i=Math.max(i,u(r.Nf()).dl())),this.Cc()&&(n=Math.max(n,u(r.Cf()).dl())),t+=r.if()}var e=this.ln,o=this.Vh,a=Math.max(e-i-n,0),l=this.Ot.timeScale.visible,f=l?this.vc.Xf():0;f%2&&(f+=1);for(var c=0+f,v=o<c?0:o-c,d=v/t,_=0,w=0;w<this.nc.length;++w){(r=this.nc[w]).Gl(this.yt.panes()[w]);var M,b=0;b=w===this.nc.length-1?v-_:Math.round(r.if()*d),_+=M=Math.max(b,2),r.wl(new bn(a,M)),this.Nc()&&r.bf(i,"left"),this.Cc()&&r.bf(n,"right"),r.gl()&&this.yt.setPaneHeight(r.gl(),M)}this.vc.Kf(new bn(l?a:0,f),l?i:0,l?n:0),this.yt.setWidth(a),this.hc!==i&&(this.hc=i),this.rc!==n&&(this.rc=n)},t.prototype.lc=function(t){var i=t.deltaX/100,n=-t.deltaY/100;if(0!==i&&this.Ot.handleScroll.mouseWheel||0!==n&&this.Ot.handleScale.mouseWheel){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:i*=120,n*=120;break;case t.DOM_DELTA_LINE:i*=32,n*=32}if(0!==n&&this.Ot.handleScale.mouseWheel){var s=Math.sign(n)*Math.min(1,Math.abs(n)),h=t.clientX-this.Rf.getBoundingClientRect().left;this.$a().zoomTime(h,s)}0!==i&&this.Ot.handleScroll.mouseWheel&&this.$a().scrollChart(-80*i)}},t.prototype.mc=function(t){var i,n=t.fullInvalidation();3===n&&this.Dc(),3!==n&&2!==n||(this.Ac(t),this.Bc(t),this.vc.et(),this.nc.forEach((function(t){t.tf()})),3===(null===(i=this.ec)||void 0===i?void 0:i.fullInvalidation())&&(this.ec.merge(t),this.Dc(),this.Ac(this.ec),this.Bc(this.ec),t=this.ec,this.ec=null)),this.yl(t)},t.prototype.Bc=function(t){for(var i=0,n=t.timeScaleInvalidations();i<n.length;i++){var s=n[i];this.Kt(s)}},t.prototype.Ac=function(t){for(var i=this.yt.panes(),n=0;n<i.length;n++)t.invalidateForPane(n).autoScale&&i[n].momentaryAutoScale()},t.prototype.Kt=function(t){var i=this.yt.timeScale();switch(t.type){case 0:i.fitContent();break;case 1:i.setLogicalRange(t.value);break;case 2:i.setBarSpacing(t.value);break;case 3:i.setRightOffset(t.value);break;case 4:i.restoreDefault()}},t.prototype.cu=function(t){var i=this;null!==this.ec?this.ec.merge(t):this.ec=t,this.uc||(this.uc=!0,this.sc=window.requestAnimationFrame((function(){if(i.uc=!1,i.sc=0,null!==i.ec){var t=i.ec;i.ec=null,i.mc(t)}})))},t.prototype.Dc=function(){this._c()},t.prototype._c=function(){for(var t=this.yt.panes(),i=t.length,n=this.nc.length,s=i;s<n;s++){var h=e(this.nc.pop());this.oc.removeChild(h.al()),h.df().unsubscribeAll(this),h.destroy()}for(s=n;s<i;s++){(h=new jn(this,t[s])).df().subscribe(this.Lc.bind(this),this),this.nc.push(h),this.oc.insertBefore(h.al(),this.vc.al())}for(s=0;s<i;s++){var r=t[s];(h=this.nc[s]).gl()!==r?h.Gl(r):h.Jl()}this.wc(),this.Tc()},t.prototype.Ec=function(t,i){var n,s=new Map;null!==t&&this.yt.serieses().forEach((function(i){var n=i.dataAt(t);null!==n&&s.set(i,n)}));if(null!==t){var h=this.yt.timeScale().indexToTime(t);null!==h&&(n=h)}var r=this.$a().hoveredSource(),e=null!==r&&r.source instanceof xi?r.source:void 0,u=null!==r&&void 0!==r.object?r.object.externalId:void 0;return{kt:n,Fc:i||void 0,Oc:e,Vc:s,Pc:u}},t.prototype.Wc=function(t,i){return{zc:t,Rc:i}},t.prototype.Lc=function(t,i){var n=this;this.Pl.v((function(){return n.Ec(t,i)}))},t.prototype.fc=function(t,i){var n=this;this.au.v((function(){return n.Ec(t,i)}))},t.prototype.cc=function(t,i){var n=this;this.lu.v((function(){return n.Wc(t,i)}))},t.prototype.wc=function(){var t=this.Ot.timeScale.visible?"":"none";this.vc.al().style.display=t},t.prototype.Nc=function(){return this.nc[0].gl().leftPriceScale().options().visible},t.prototype.Cc=function(){return this.nc[0].gl().rightPriceScale().options().visible},t}();function $n(t,i,n){var s=n.value;return{index:i,time:t,value:[s,s,s,s]}}function Kn(t,i,n){var s=n.value,h={index:i,time:t,value:[s,s,s,s]};return"color"in n&&void 0!==n.color&&(h.color=n.color),h}function Xn(t){return void 0!==t.value}function Zn(t){return function(i,n,s){return void 0===(h=s).open&&void 0===h.value?{time:i,index:n}:t(i,n,s);var h}}var Jn={Candlestick:Zn((function(t,i,n){var s={index:i,time:t,value:[n.open,n.high,n.low,n.close]};return"color"in n&&void 0!==n.color&&(s.color=n.color),"borderColor"in n&&void 0!==n.borderColor&&(s.borderColor=n.borderColor),"wickColor"in n&&void 0!==n.wickColor&&(s.wickColor=n.wickColor),s})),Bar:Zn((function(t,i,n){var s={index:i,time:t,value:[n.open,n.high,n.low,n.close]};return"color"in n&&void 0!==n.color&&(s.color=n.color),s})),Area:Zn($n),Baseline:Zn($n),Histogram:Zn(Kn),Line:Zn(Kn)};function Gn(t){return Jn[t]}function Qn(t){return 60*t*60*1e3}function ts(t){return 60*t*1e3}var is,ns=[{Ic:(is=1,1e3*is),ne:10},{Ic:ts(1),ne:20},{Ic:ts(5),ne:21},{Ic:ts(30),ne:22},{Ic:Qn(1),ne:30},{Ic:Qn(3),ne:31},{Ic:Qn(6),ne:32},{Ic:Qn(12),ne:33}];function ss(t,i){if(t.getUTCFullYear()!==i.getUTCFullYear())return 70;if(t.getUTCMonth()!==i.getUTCMonth())return 60;if(t.getUTCDate()!==i.getUTCDate())return 50;for(var n=ns.length-1;n>=0;--n)if(Math.floor(i.getTime()/ns[n].Ic)!==Math.floor(t.getTime()/ns[n].Ic))return ns[n].ne;return 0}function hs(t,i){if(void 0===i&&(i=0),0!==t.length){for(var n=0===i?null:t[i-1].time.timestamp,s=null!==n?new Date(1e3*n):null,h=0,r=i;r<t.length;++r){var e=t[r],u=new Date(1e3*e.time.timestamp);null!==s&&(e.timeWeight=ss(u,s)),h+=e.time.timestamp-(n||e.time.timestamp),n=e.time.timestamp,s=u}if(0===i&&t.length>1){var o=Math.ceil(h/(t.length-1)),a=new Date(1e3*(t[0].time.timestamp-o));t[0].timeWeight=ss(new Date(1e3*t[0].time.timestamp),a)}}}function rs(t){if(!wn(t))throw new Error("time must be of type BusinessDay");var i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{timestamp:Math.round(i.getTime()/1e3),businessDay:t}}function es(t){if(!Mn(t))throw new Error("time must be of type isUTCTimestamp");return{timestamp:t}}function us(t){return 0===t.length?null:wn(t[0].time)?rs:es}function os(t){return Mn(t)?es(t):wn(t)?rs(t):rs(as(t))}function as(t){var i=new Date(t);if(isNaN(i.getTime()))throw new Error("Invalid date string=".concat(t,", expected format=yyyy-mm-dd"));return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function ls(t){C(t.time)&&(t.time=as(t.time))}function fs(t){return{ie:0,jc:new Map,qc:t}}function cs(t){if(void 0!==t&&0!==t.length)return{Uc:t[0].time.timestamp,Hc:t[t.length-1].time.timestamp}}var vs=function(){function t(){this.Yc=new Map,this.$c=new Map,this.Kc=new Map,this.Xc=[]}return t.prototype.M=function(){this.Yc.clear(),this.$c.clear(),this.Kc.clear(),this.Xc=[]},t.prototype.Zc=function(t,i){var n=this,s=0!==this.Yc.size,h=!1,r=this.$c.get(t);if(void 0!==r)if(1===this.$c.size)s=!1,h=!0,this.Yc.clear();else for(var e=0,o=this.Xc;e<o.length;e++){o[e].pointData.jc.delete(t)&&(h=!0)}var a=[];if(0!==i.length){!function(t){t.forEach(ls)}(i);var l=u(us(i)),f=Gn(t.seriesType());a=i.map((function(i){var s=l(i.time),r=n.Yc.get(s.timestamp);void 0===r&&(r=fs(s),n.Yc.set(s.timestamp,r),h=!0);var e=f(s,r.ie,i);return r.jc.set(t,e),e}))}s&&this.Jc(),this.Gc(t,a);var c=-1;if(h){var v=[];this.Yc.forEach((function(t){v.push({timeWeight:0,time:t.qc,pointData:t})})),v.sort((function(t,i){return t.time.timestamp-i.time.timestamp})),c=this.Qc(v)}return this.tv(t,c,function(t,i){var n=cs(t),s=cs(i);if(void 0!==n&&void 0!==s)return{lastBarUpdatedOrNewBarsAddedToTheRight:n.Hc>=s.Hc&&n.Uc>=s.Uc}}(this.$c.get(t),r))},t.prototype.iv=function(t){return this.Zc(t,[])},t.prototype.nv=function(t,i){ls(i);var n=u(us([i]))(i.time),s=this.Kc.get(t);if(void 0!==s&&n.timestamp<s.timestamp)throw new Error("Cannot update oldest data, last time=".concat(s.timestamp,", new time=").concat(n.timestamp));var h=this.Yc.get(n.timestamp),r=void 0===h;void 0===h&&(h=fs(n),this.Yc.set(n.timestamp,h));var e=Gn(t.seriesType())(n,h.ie,i);h.jc.set(t,e),this.sv(t,e);var o={lastBarUpdatedOrNewBarsAddedToTheRight:Xn(e)};if(!r)return this.tv(t,-1,o);var a={timeWeight:0,time:h.qc,pointData:h},l=vt(this.Xc,a.time.timestamp,(function(t,i){return t.time.timestamp<i}));this.Xc.splice(l,0,a);for(var f=l;f<this.Xc.length;++f)ds(this.Xc[f].pointData,f);return hs(this.Xc,l),this.tv(t,l,o)},t.prototype.sv=function(t,i){var n=this.$c.get(t);void 0===n&&(n=[],this.$c.set(t,n));var s=0!==n.length?n[n.length-1]:null;null===s||i.time.timestamp>s.time.timestamp?Xn(i)&&n.push(i):Xn(i)?n[n.length-1]=i:n.splice(-1,1),this.Kc.set(t,i.time)},t.prototype.Gc=function(t,i){0!==i.length?(this.$c.set(t,i.filter(Xn)),this.Kc.set(t,i[i.length-1].time)):(this.$c.delete(t),this.Kc.delete(t))},t.prototype.Jc=function(){for(var t=0,i=this.Xc;t<i.length;t++){var n=i[t];0===n.pointData.jc.size&&this.Yc.delete(n.time.timestamp)}},t.prototype.Qc=function(t){for(var i=-1,n=0;n<this.Xc.length&&n<t.length;++n){var s=this.Xc[n],h=t[n];if(s.time.timestamp!==h.time.timestamp){i=n;break}h.timeWeight=s.timeWeight,ds(h.pointData,n)}if(-1===i&&this.Xc.length!==t.length&&(i=Math.min(this.Xc.length,t.length)),-1===i)return-1;for(n=i;n<t.length;++n)ds(t[n].pointData,n);return hs(t,i),this.Xc=t,i},t.prototype.hv=function(){if(0===this.$c.size)return null;var t=0;return this.$c.forEach((function(i){0!==i.length&&(t=Math.max(t,i[i.length-1].index))})),t},t.prototype.tv=function(t,i,n){var s={rv:new Map,ev:{uv:this.hv()}};if(-1!==i)this.$c.forEach((function(i,h){s.rv.set(h,{pn:i,ov:h===t?n:void 0})})),this.$c.has(t)||s.rv.set(t,{pn:[],ov:n}),s.ev.av=this.Xc,s.ev.lv=i;else{var h=this.$c.get(t);s.rv.set(t,{pn:h||[],ov:n})}return s},t}();function ds(t,i){t.ie=i,t.jc.forEach((function(t){t.index=i}))}var _s={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:"",draggable:!1},ws=function(){function t(t){this.ls=t}return t.prototype.applyOptions=function(t){this.ls.applyOptions(t)},t.prototype.options=function(){return this.ls.options()},t.prototype.fv=function(){return this.ls},t}(),Ms=function(){function t(t){this.qs=t}return t.prototype.applyOptions=function(t){this.qs.applyOptions(t)},t.prototype.options=function(){return this.qs.options()},t.prototype.cv=function(){return this.qs},t}(),bs={corners:[],lowPrice:0,highPrice:0,earlyTime:0,lateTime:0,borderColor:"#0FF",borderWidth:1,borderStyle:0,fillColor:"#0FF",fillOpacity:1,borderVisible:!0,axisLabelVisible:!1,title:""};function ms(t){var i=t.overlay,n=function(t,i){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&i.indexOf(s)<0&&(n[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var h=0;for(s=Object.getOwnPropertySymbols(t);h<s.length;h++)i.indexOf(s[h])<0&&Object.prototype.propertyIsEnumerable.call(t,s[h])&&(n[s[h]]=t[s[h]])}return n}(t,["overlay"]);return i&&(n.priceScaleId=""),n}var ps=function(){function t(t,i,n){this._i=t,this.vv=i,this.dv=n}return t.prototype.priceFormatter=function(){return this._i.formatter()},t.prototype.priceToCoordinate=function(t){var i=this._i.firstValue();return null===i?null:this._i.priceScale().priceToCoordinate(t,i.value)},t.prototype.coordinateToPrice=function(t){var i=this._i.firstValue();return null===i?null:this._i.priceScale().coordinateToPrice(t,i.value)},t.prototype.barsInLogicalRange=function(t){if(null===t)return null;var i=new rn(new tn(t.from,t.to)).ue(),n=this._i.bars();if(n.isEmpty())return null;var s=n.search(i.left(),1),h=n.search(i.right(),-1),r=u(n.firstIndex()),e=u(n.lastIndex());if(null!==s&&null!==h&&s.index>h.index)return{barsBefore:t.from-r,barsAfter:e-t.to};var o={barsBefore:null===s||s.index===r?t.from-r:s.index-r,barsAfter:null===h||h.index===e?e-t.to:e-h.index};return null!==s&&null!==h&&(o.from=s.time.businessDay||s.time.timestamp,o.to=h.time.businessDay||h.time.timestamp),o},t.prototype.setData=function(t){this._i.seriesType(),this.vv._v(this._i,t)},t.prototype.update=function(t){this._i.seriesType(),this.vv.wv(this._i,t)},t.prototype.setMarkers=function(t){var i=t.map((function(t){return p(p({},t),{time:os(t.time)})}));this._i.setMarkers(i)},t.prototype.applyOptions=function(t){var i=ms(t);this._i.applyOptions(i)},t.prototype.options=function(){return T(this._i.options())},t.prototype.priceScale=function(){return this.dv.priceScale(this._i.priceScale().id())},t.prototype.createPriceLine=function(t){var i=k(T(_s),t),n=this._i.createPriceLine(i);return new ws(n)},t.prototype.removePriceLine=function(t){this._i.removePriceLine(t.fv())},t.prototype.createBox=function(t){var i=k(T(bs),t),n=this._i.createBox(i);return new Ms(n)},t.prototype.removeBox=function(t){this._i.removeBox(t.cv())},t.prototype.seriesType=function(){return this._i.seriesType()},t}(),gs=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return m(i,t),i.prototype.applyOptions=function(i){_n(i),t.prototype.applyOptions.call(this,i)},i}(ps),ys={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,drawTicks:!0,scaleMargins:{bottom:.1,top:.2}},ks={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:B,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},xs={width:0,height:0,layout:{background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:11,fontFamily:B},crosshair:{vertLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},horzLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:p({},ys),leftPriceScale:p(p({},ys),{visible:!1}),rightPriceScale:p(p({},ys),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0},watermark:ks,localization:{locale:Cn?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:!0,mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}},Ns={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},Cs={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},Ss={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Ts={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Ds={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},As={color:"#26a69a",base:0},Bs={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}},Ls=function(){function t(t,i){this.Mv=t,this.bv=i}return t.prototype.applyOptions=function(t){this.Mv.$a().applyPriceScaleOptions(this.bv,t)},t.prototype.options=function(){return this.wt().options()},t.prototype.width=function(){return it(this.bv)?this.Mv.Sc("left"===this.bv?"left":"right"):0},t.prototype.formatPrice=function(t,i){return void 0===i&&(i=0),this.wt().formatPrice(t,i)},t.prototype.wt=function(){return u(this.Mv.$a().findPriceScale(this.bv)).priceScale},t}(),Es=function(){function t(t,i){this.mv=new y,this.Me=new y,this.zf=new y,this.yt=t,this.mr=t.timeScale(),this.vc=i,this.mr.visibleBarsChanged().subscribe(this.pv.bind(this)),this.mr.logicalRangeChanged().subscribe(this.gv.bind(this)),this.vc.$f().subscribe(this.yv.bind(this))}return t.prototype.destroy=function(){this.mr.visibleBarsChanged().unsubscribeAll(this),this.mr.logicalRangeChanged().unsubscribeAll(this),this.vc.$f().unsubscribeAll(this),this.mv.M(),this.Me.M(),this.zf.M()},t.prototype.scrollPosition=function(){return this.mr.rightOffset()},t.prototype.scrollToPosition=function(t,i){i?this.mr.scrollToOffsetAnimated(t,1e3):this.yt.setRightOffset(t)},t.prototype.scrollToRealTime=function(){this.mr.scrollToRealTime()},t.prototype.getVisibleRange=function(){var t,i,n=this.mr.visibleTimeRange();return null===n?null:{from:null!==(t=n.from.businessDay)&&void 0!==t?t:n.from.timestamp,to:null!==(i=n.to.businessDay)&&void 0!==i?i:n.to.timestamp}},t.prototype.setVisibleRange=function(t){var i={from:os(t.from),to:os(t.to)},n=this.mr.logicalRangeForTimeRange(i);this.yt.setTargetLogicalRange(n)},t.prototype.getVisibleLogicalRange=function(){var t=this.mr.visibleLogicalRange();return null===t?null:{from:t.left(),to:t.right()}},t.prototype.setVisibleLogicalRange=function(t){r(t.from<=t.to,"The from index cannot be after the to index."),this.yt.setTargetLogicalRange(t)},t.prototype.resetTimeScale=function(){this.yt.resetTimeScale()},t.prototype.fitContent=function(){this.yt.fitContent()},t.prototype.logicalToCoordinate=function(t){var i=this.yt.timeScale();return i.isEmpty()?null:i.indexToCoordinate(t)},t.prototype.coordinateToLogical=function(t){return this.mr.isEmpty()?null:this.mr.coordinateToIndex(t)},t.prototype.timeToCoordinate=function(t){var i=os(t),n=this.mr.timeToIndex(i,!1);return null===n?null:this.mr.indexToCoordinate(n)},t.prototype.coordinateToTime=function(t){var i,n=this.yt.timeScale(),s=n.coordinateToIndex(t),h=n.indexToTime(s);return null===h?null:null!==(i=h.businessDay)&&void 0!==i?i:h.timestamp},t.prototype.width=function(){return this.vc.mf().J},t.prototype.height=function(){return this.vc.mf().G},t.prototype.subscribeVisibleTimeRangeChange=function(t){this.mv.subscribe(t)},t.prototype.unsubscribeVisibleTimeRangeChange=function(t){this.mv.unsubscribe(t)},t.prototype.subscribeVisibleLogicalRangeChange=function(t){this.Me.subscribe(t)},t.prototype.unsubscribeVisibleLogicalRangeChange=function(t){this.Me.unsubscribe(t)},t.prototype.subscribeSizeChange=function(t){this.zf.subscribe(t)},t.prototype.unsubscribeSizeChange=function(t){this.zf.unsubscribe(t)},t.prototype.applyOptions=function(t){this.mr.applyOptions(t)},t.prototype.options=function(){return T(this.mr.options())},t.prototype.pv=function(){this.mv._()&&this.mv.v(this.getVisibleRange())},t.prototype.gv=function(){this.Me._()&&this.Me.v(this.getVisibleLogicalRange())},t.prototype.yv=function(t){this.zf.v(t.J,t.G)},t}();function Fs(t){if(void 0!==t&&"custom"!==t.type){var i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;for(var i=0;i<8;i++){var n=Math.round(t);if(Math.abs(n-t)<1e-8)return i;t*=10}return i}(i.minMove))}}function Os(t){return function(t){if(S(t.handleScale)){var i=t.handleScale;t.handleScale={axisDoubleClickReset:i,axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale&&S(t.handleScale.axisPressedMouseMove)){var n=t.handleScale.axisPressedMouseMove;t.handleScale.axisPressedMouseMove={time:n,price:n}}var s=t.handleScroll;S(s)&&(t.handleScroll={horzTouchDrag:s,vertTouchDrag:s,mouseWheel:s,pressedMouseMove:s})}(t),function(t){if(t.priceScale){t.leftPriceScale=t.leftPriceScale||{},t.rightPriceScale=t.rightPriceScale||{};var i=t.priceScale.position;delete t.priceScale.position,t.leftPriceScale=k(t.leftPriceScale,t.priceScale),t.rightPriceScale=k(t.rightPriceScale,t.priceScale),"left"===i&&(t.leftPriceScale.visible=!0,t.rightPriceScale.visible=!1),"right"===i&&(t.leftPriceScale.visible=!1,t.rightPriceScale.visible=!0),"none"===i&&(t.leftPriceScale.visible=!1,t.rightPriceScale.visible=!1),t.overlayPriceScales=t.overlayPriceScales||{},void 0!==t.priceScale.invertScale&&(t.overlayPriceScales.invertScale=t.priceScale.invertScale),void 0!==t.priceScale.scaleMargins&&(t.overlayPriceScales.scaleMargins=t.priceScale.scaleMargins)}}(t),function(t){t.layout&&t.layout.backgroundColor&&!t.layout.background&&(t.layout.background={type:"solid",color:t.layout.backgroundColor})}(t),t}var Vs=function(){function t(t,i){var n=this;this.kv=new vs,this.xv=new Map,this.Nv=new Map,this.Cv=new y,this.Sv=new y,this.Tv=new y;var s=void 0===i?T(xs):k(T(xs),Os(i));this.Mv=new Yn(t,s),this.Mv.df().subscribe((function(t){n.Cv._()&&n.Cv.v(n.Dv(t()))}),this),this.Mv.yc().subscribe((function(t){n.Sv._()&&n.Sv.v(n.Dv(t()))}),this),this.Mv.kc().subscribe((function(t){n.Tv._()&&n.Tv.v(n.Av(t()))}),this);var h=this.Mv.$a();this.Bv=new Es(h,this.Mv.bc())}return t.prototype.remove=function(){this.Mv.df().unsubscribeAll(this),this.Mv.yc().unsubscribeAll(this),this.Mv.kc().unsubscribeAll(this),this.Bv.destroy(),this.Mv.destroy(),this.xv.clear(),this.Nv.clear(),this.Cv.M(),this.Sv.M(),this.Tv.M(),this.kv.M()},t.prototype.resize=function(t,i,n){this.Mv.dc(t,i,n)},t.prototype.addAreaSeries=function(t){void 0===t&&(t={}),Fs((t=ms(t)).priceFormat);var i=k(T(Bs),Ts,t),n=this.Mv.$a().createSeries("Area",i),s=new ps(n,this,this);return this.xv.set(s,n),this.Nv.set(n,s),s},t.prototype.addBaselineSeries=function(t){void 0===t&&(t={}),Fs((t=ms(t)).priceFormat);var i=k(T(Bs),T(Ds),t),n=this.Mv.$a().createSeries("Baseline",i),s=new ps(n,this,this);return this.xv.set(s,n),this.Nv.set(n,s),s},t.prototype.addBarSeries=function(t){void 0===t&&(t={}),Fs((t=ms(t)).priceFormat);var i=k(T(Bs),Cs,t),n=this.Mv.$a().createSeries("Bar",i),s=new ps(n,this,this);return this.xv.set(s,n),this.Nv.set(n,s),s},t.prototype.addCandlestickSeries=function(t){void 0===t&&(t={}),_n(t=ms(t)),Fs(t.priceFormat);var i=k(T(Bs),Ns,t),n=this.Mv.$a().createSeries("Candlestick",i),s=new gs(n,this,this);return this.xv.set(s,n),this.Nv.set(n,s),s},t.prototype.addHistogramSeries=function(t){void 0===t&&(t={}),Fs((t=ms(t)).priceFormat);var i=k(T(Bs),As,t),n=this.Mv.$a().createSeries("Histogram",i),s=new ps(n,this,this);return this.xv.set(s,n),this.Nv.set(n,s),s},t.prototype.addLineSeries=function(t){void 0===t&&(t={}),Fs((t=ms(t)).priceFormat);var i=k(T(Bs),Ss,t),n=this.Mv.$a().createSeries("Line",i),s=new ps(n,this,this);return this.xv.set(s,n),this.Nv.set(n,s),s},t.prototype.removeSeries=function(t){var i=e(this.xv.get(t)),n=this.kv.iv(i);this.Mv.$a().removeSeries(i),this.Lv(n),this.xv.delete(t),this.Nv.delete(i)},t.prototype._v=function(t,i){this.Lv(this.kv.Zc(t,i))},t.prototype.wv=function(t,i){this.Lv(this.kv.nv(t,i))},t.prototype.subscribeClick=function(t){this.Cv.subscribe(t)},t.prototype.unsubscribeClick=function(t){this.Cv.unsubscribe(t)},t.prototype.subscribeCrosshairMove=function(t){this.Sv.subscribe(t)},t.prototype.unsubscribeCrosshairMove=function(t){this.Sv.unsubscribe(t)},t.prototype.subscribeCustomPriceLineDragged=function(t){this.Tv.subscribe(t)},t.prototype.unsubscribeCustomPriceLineDragged=function(t){this.Tv.unsubscribe(t)},t.prototype.priceScale=function(t){return void 0===t&&(t=this.Mv.$a().defaultVisiblePriceScaleId()),new Ls(this.Mv,t)},t.prototype.timeScale=function(){return this.Bv},t.prototype.applyOptions=function(t){this.Mv.gc(Os(t))},t.prototype.options=function(){return this.Mv.Ll()},t.prototype.takeScreenshot=function(){return this.Mv.xc()},t.prototype.Lv=function(t){var i=this.Mv.$a();i.updateTimeScale(t.ev.uv,t.ev.av,t.ev.lv),t.rv.forEach((function(t,i){return i.setData(t.pn,t.ov)})),i.recalculateAllPanes()},t.prototype.Ev=function(t){return e(this.Nv.get(t))},t.prototype.Dv=function(t){var i=this,n=new Map;t.Vc.forEach((function(t,s){n.set(i.Ev(s),t)}));var s=void 0===t.Oc?void 0:this.Ev(t.Oc);return{time:t.kt&&(t.kt.businessDay||t.kt.timestamp),point:t.Fc,hoveredSeries:s,hoveredMarkerId:t.Pc,seriesPrices:n}},t.prototype.Av=function(t){return{customPriceLine:t.zc,fromPriceString:t.Rc}},t}();function Ps(t,i){var n;if(C(t)){var s=document.getElementById(t);r(null!==s,"Cannot find element in DOM with id=".concat(t)),n=s}else n=t;return new Vs(n,i)}function Ws(){return"3.8.0-dev+202211241619"}export{vn as ColorType,Y as CrosshairMode,fn as LasPriceAnimationMode,fn as LastPriceAnimationMode,n as LineStyle,i as LineType,cn as PriceLineSource,zi as PriceScaleMode,sn as TickMarkType,un as TrackingModeExitMode,Ps as createChart,wn as isBusinessDay,Mn as isUTCTimestamp,Ws as version};
